var t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m,b,y,g,x,_,w,v,M,S,A,I,B,T,z,C,P,F,L,k,O,V,E,R,D,U,N,q,G,W,H,j,Z,Y,X,J,Q,$,K,tt,et,st,it=Object.defineProperty,nt=(t,e,s)=>(((t,e,s)=>{e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),rt=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},ot=(t,e,s)=>(rt(t,e,"read from private field"),s?s.call(t):e.get(t)),at=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},ht=(t,e,s,i)=>(rt(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),lt=(t,e,s,i)=>({set _(i){ht(t,e,i,s)},get _(){return ot(t,e,i)}}),ct=(t,e,s)=>(rt(t,e,"access private method"),s);const ut=1001,dt="srgb",pt="srgb-linear",ft="linear",mt="srgb",bt=7680,yt=2e3,gt=2001;class xt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[t]&&(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[t]&&-1!==s[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const s=e.slice(0);for(let e=0,i=s.length;e<i;e++)s[e].call(this,t);t.target=null}}}const _t=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const wt=Math.PI/180;Math.PI;function vt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(_t[255&t]+_t[t>>8&255]+_t[t>>16&255]+_t[t>>24&255]+"-"+_t[255&e]+_t[e>>8&255]+"-"+_t[e>>16&15|64]+_t[e>>24&255]+"-"+_t[63&s|128]+_t[s>>8&255]+"-"+_t[s>>16&255]+_t[s>>24&255]+_t[255&i]+_t[i>>8&255]+_t[i>>16&255]+_t[i>>24&255]).toLowerCase()}function Mt(t,e,s){return Math.max(e,Math.min(s,t))}function St(t,e){return(t%e+e)%e}function At(t,e,s){return(1-s)*t+s*e}function It(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Bt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Tt=wt;class zt{constructor(t=0,e=0){zt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(Mt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ct{constructor(t,e,s,i,n,r,o,a,h){Ct.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h)}set(t,e,s,i,n,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=s,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[3],a=s[6],h=s[1],l=s[4],c=s[7],u=s[2],d=s[5],p=s[8],f=i[0],m=i[3],b=i[6],y=i[1],g=i[4],x=i[7],_=i[2],w=i[5],v=i[8];return n[0]=r*f+o*y+a*_,n[3]=r*m+o*g+a*w,n[6]=r*b+o*x+a*v,n[1]=h*f+l*y+c*_,n[4]=h*m+l*g+c*w,n[7]=h*b+l*x+c*v,n[2]=u*f+d*y+p*_,n[5]=u*m+d*g+p*w,n[8]=u*b+d*x+p*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-s*n*l+s*o*a+i*n*h-i*r*a}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*r-o*h,u=o*a-l*n,d=h*n-r*a,p=e*c+s*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*h-l*s)*f,t[2]=(o*s-i*r)*f,t[3]=u*f,t[4]=(l*e-i*a)*f,t[5]=(i*n-o*e)*f,t[6]=d*f,t[7]=(s*a-h*e)*f,t[8]=(r*e-s*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,o){const a=Math.cos(n),h=Math.sin(n);return this.set(s*a,s*h,-s*(a*r+h*o)+r+t,-i*h,i*a,-i*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Pt.makeScale(t,e)),this}rotate(t){return this.premultiply(Pt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Pt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<9;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Pt=new Ct;function Ft(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const Lt={enabled:!0,workingColorSpace:pt,spaces:{},convert:function(t,e,s){return!1!==this.enabled&&e!==s&&e&&s?(this.spaces[e].transfer===mt&&(t.r=kt(t.r),t.g=kt(t.g),t.b=kt(t.b)),this.spaces[e].primaries!==this.spaces[s].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===mt&&(t.r=Ot(t.r),t.g=Ot(t.g),t.b=Ot(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?ft:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,s){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function kt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ot(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Vt=[.64,.33,.3,.6,.15,.06],Et=[.2126,.7152,.0722],Rt=[.3127,.329],Dt=(new Ct).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Ut=(new Ct).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let Nt;Lt.define({[pt]:{primaries:Vt,whitePoint:Rt,transfer:ft,toXYZ:Dt,fromXYZ:Ut,luminanceCoefficients:Et,workingColorSpaceConfig:{unpackColorSpace:dt},outputColorSpaceConfig:{drawingBufferColorSpace:dt}},[dt]:{primaries:Vt,whitePoint:Rt,transfer:mt,toXYZ:Dt,fromXYZ:Ut,luminanceCoefficients:Et,outputColorSpaceConfig:{drawingBufferColorSpace:dt}}});class qt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Nt&&(Nt=Ft("canvas")),Nt.width=t.width,Nt.height=t.height;const s=Nt.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Nt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Ft("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let t=0;t<n.length;t++)n[t]=255*kt(n[t]/255);return s.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*kt(e[t]/255)):e[t]=kt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Gt=0;class Wt{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Gt++}),this.uuid=vt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,s=i.length;e<s;e++)i[e].isDataTexture?t.push(Ht(i[e].image)):t.push(Ht(i[e]))}else t=Ht(i);s.url=t}return e||(t.images[this.uuid]=s),s}}function Ht(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?qt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let jt=0;class Zt extends xt{constructor(t=Zt.DEFAULT_IMAGE,e=Zt.DEFAULT_MAPPING,s=1001,i=1001,n=1006,r=1008,o=1023,a=1009,h=Zt.DEFAULT_ANISOTROPY,l=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:jt++}),this.uuid=vt(),this.name="",this.source=new Wt(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new zt(0,0),this.repeat=new zt(1,1),this.center=new zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case ut:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case ut:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Zt.DEFAULT_IMAGE=null,Zt.DEFAULT_MAPPING=300,Zt.DEFAULT_ANISOTROPY=1;class Yt{constructor(t=0,e=0,s=0,i=1){Yt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*n,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*n,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*n,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const r=.01,o=.1,a=t.elements,h=a[0],l=a[4],c=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],b=a[10];if(Math.abs(l-u)<r&&Math.abs(c-f)<r&&Math.abs(p-m)<r){if(Math.abs(l+u)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(h+d+b-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(d+1)/2,y=(b+1)/2,g=(l+u)/4,x=(c+f)/4,_=(p+m)/4;return t>a&&t>y?t<r?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(t),i=g/s,n=x/s):a>y?a<r?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(a),s=g/i,n=_/i):y<r?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(y),s=x/n,i=_/n),this.set(s,i,n,e),this}let y=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-l)*(u-l));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(c-f)/y,this.z=(u-l)/y,this.w=Math.acos((h+d+b-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Xt{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,o){let a=s[i+0],h=s[i+1],l=s[i+2],c=s[i+3];const u=n[r+0],d=n[r+1],p=n[r+2],f=n[r+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==u||h!==d||l!==p){let t=1-o;const e=a*u+h*d+l*p+c*f,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),r=Math.atan2(n,e*s);t=Math.sin(t*r)/n,o=Math.sin(o*r)/n}const n=o*s;if(a=a*t+u*n,h=h*t+d*n,l=l*t+p*n,c=c*t+f*n,t===1-o){const t=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=t,h*=t,l*=t,c*=t}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,n,r){const o=s[i],a=s[i+1],h=s[i+2],l=s[i+3],c=n[r],u=n[r+1],d=n[r+2],p=n[r+3];return t[e]=o*p+l*c+a*d-h*u,t[e+1]=a*p+l*u+h*c-o*d,t[e+2]=h*p+l*d+o*u-a*c,t[e+3]=l*p-o*c-a*u-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(s/2),l=o(i/2),c=o(n/2),u=a(s/2),d=a(i/2),p=a(n/2);switch(r){case"XYZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"YXZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"ZXY":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"ZYX":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"YZX":this._x=u*l*c+h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c-u*d*p;break;case"XZY":this._x=u*l*c-h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],u=s+o+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(n-h)*t,this._z=(r-i)*t}else if(s>o&&s>c){const t=2*Math.sqrt(1+s-o-c);this._w=(l-a)/t,this._x=.25*t,this._y=(i+r)/t,this._z=(n+h)/t}else if(o>c){const t=2*Math.sqrt(1+o-s-c);this._w=(n-h)/t,this._x=(i+r)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-s-o);this._w=(r-i)/t,this._x=(n+h)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Mt(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=s*l+r*o+i*h-n*a,this._y=i*l+r*a+n*o-s*h,this._z=n*l+r*h+s*a-i*o,this._w=r*l-s*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*t._w+s*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=r*c+this._w*u,this._x=s*c+this._x*u,this._y=i*c+this._y*u,this._z=n*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Jt{constructor(t=0,e=0,s=0){Jt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return void 0===s&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion($t.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion($t.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*i-o*s),l=2*(o*e-n*i),c=2*(n*s-r*e);return this.x=e+a*h+r*c-o*l,this.y=s+a*l+o*h-n*c,this.z=i+a*c+n*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return Qt.copy(this).projectOnVector(t),this.sub(Qt)}reflect(t){return this.sub(Qt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(Mt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Qt=new Jt,$t=new Xt;class Kt{constructor(t=new Jt(1/0,1/0,1/0),e=new Jt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(ee.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(ee.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=ee.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(void 0!==s){const i=s.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,s=i.count;e<s;e++)!0===t.isMesh?t.getVertexPosition(e,ee):ee.fromBufferAttribute(i,e),ee.applyMatrix4(t.matrixWorld),this.expandByPoint(ee);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),se.copy(t.boundingBox)):(null===s.boundingBox&&s.computeBoundingBox(),se.copy(s.boundingBox)),se.applyMatrix4(t.matrixWorld),this.union(se)}const i=t.children;for(let t=0,s=i.length;t<s;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,ee),ee.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(le),ce.subVectors(this.max,le),ie.subVectors(t.a,le),ne.subVectors(t.b,le),re.subVectors(t.c,le),oe.subVectors(ne,ie),ae.subVectors(re,ne),he.subVectors(ie,re);let e=[0,-oe.z,oe.y,0,-ae.z,ae.y,0,-he.z,he.y,oe.z,0,-oe.x,ae.z,0,-ae.x,he.z,0,-he.x,-oe.y,oe.x,0,-ae.y,ae.x,0,-he.y,he.x,0];return!!pe(e,ie,ne,re,ce)&&(e=[1,0,0,0,1,0,0,0,1],!!pe(e,ie,ne,re,ce)&&(ue.crossVectors(oe,ae),e=[ue.x,ue.y,ue.z],pe(e,ie,ne,re,ce)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,ee).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(ee).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(te[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),te[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),te[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),te[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),te[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),te[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),te[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),te[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(te)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const te=[new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt],ee=new Jt,se=new Kt,ie=new Jt,ne=new Jt,re=new Jt,oe=new Jt,ae=new Jt,he=new Jt,le=new Jt,ce=new Jt,ue=new Jt,de=new Jt;function pe(t,e,s,i,n){for(let r=0,o=t.length-3;r<=o;r+=3){de.fromArray(t,r);const o=n.x*Math.abs(de.x)+n.y*Math.abs(de.y)+n.z*Math.abs(de.z),a=e.dot(de),h=s.dot(de),l=i.dot(de);if(Math.max(-Math.max(a,h,l),Math.min(a,h,l))>o)return!1}return!0}const fe=new Kt,me=new Jt,be=new Jt;class ye{constructor(t=new Jt,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;void 0!==e?s.copy(e):fe.setFromPoints(t).getCenter(s);let i=0;for(let e=0,n=t.length;e<n;e++)i=Math.max(i,s.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;me.subVectors(t,this.center);const e=me.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),s=.5*(t-this.radius);this.center.addScaledVector(me,s/t),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(be.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(me.copy(t.center).add(be)),this.expandByPoint(me.copy(t.center).sub(be))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ge=new Jt,xe=new Jt,_e=new Jt,we=new Jt,ve=new Jt,Me=new Jt,Se=new Jt;class Ae{constructor(t=new Jt,e=new Jt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ge)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ge.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ge.copy(this.origin).addScaledVector(this.direction,e),ge.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){xe.copy(t).add(e).multiplyScalar(.5),_e.copy(e).sub(t).normalize(),we.copy(this.origin).sub(xe);const n=.5*t.distanceTo(e),r=-this.direction.dot(_e),o=we.dot(this.direction),a=-we.dot(_e),h=we.lengthSq(),l=Math.abs(1-r*r);let c,u,d,p;if(l>0)if(c=r*a-o,u=r*o-a,p=n*l,c>=0)if(u>=-p)if(u<=p){const t=1/l;c*=t,u*=t,d=c*(c+r*u+2*o)+u*(r*c+u+2*a)+h}else u=n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u=-n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u<=-p?(c=Math.max(0,-(-r*n+o)),u=c>0?-n:Math.min(Math.max(-n,-a),n),d=-c*c+u*(u+2*a)+h):u<=p?(c=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+h):(c=Math.max(0,-(r*n+o)),u=c>0?n:Math.min(Math.max(-n,-a),n),d=-c*c+u*(u+2*a)+h);else u=r>0?-n:n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(xe).addScaledVector(_e,u),d}intersectSphere(t,e){ge.subVectors(t.center,this.origin);const s=ge.dot(this.direction),i=ge.dot(ge)-s*s,n=t.radius*t.radius;if(i>n)return null;const r=Math.sqrt(n-i),o=s-r,a=s+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return null===s?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,r,o,a;const h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(s=(t.min.x-u.x)*h,i=(t.max.x-u.x)*h):(s=(t.max.x-u.x)*h,i=(t.min.x-u.x)*h),l>=0?(n=(t.min.y-u.y)*l,r=(t.max.y-u.y)*l):(n=(t.max.y-u.y)*l,r=(t.min.y-u.y)*l),s>r||n>i?null:((n>s||isNaN(s))&&(s=n),(r<i||isNaN(i))&&(i=r),c>=0?(o=(t.min.z-u.z)*c,a=(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,a=(t.min.z-u.z)*c),s>a||o>i?null:((o>s||s!=s)&&(s=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(s>=0?s:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,ge)}intersectTriangle(t,e,s,i,n){ve.subVectors(e,t),Me.subVectors(s,t),Se.crossVectors(ve,Me);let r,o=this.direction.dot(Se);if(o>0){if(i)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}we.subVectors(this.origin,t);const a=r*this.direction.dot(Me.crossVectors(we,Me));if(a<0)return null;const h=r*this.direction.dot(ve.cross(we));if(h<0)return null;if(a+h>o)return null;const l=-r*we.dot(Se);return l<0?null:this.at(l/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ie{constructor(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m){Ie.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m)}set(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m){const b=this.elements;return b[0]=t,b[4]=e,b[8]=s,b[12]=i,b[1]=n,b[5]=r,b[9]=o,b[13]=a,b[2]=h,b[6]=l,b[10]=c,b[14]=u,b[3]=d,b[7]=p,b[11]=f,b[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ie).fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Be.setFromMatrixColumn(t,0).length(),n=1/Be.setFromMatrixColumn(t,1).length(),r=1/Be.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),h=Math.sin(i),l=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){const t=r*l,s=r*c,i=o*l,n=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=s+i*h,e[5]=t-n*h,e[9]=-o*a,e[2]=n-t*h,e[6]=i+s*h,e[10]=r*a}else if("YXZ"===t.order){const t=a*l,s=a*c,i=h*l,n=h*c;e[0]=t+n*o,e[4]=i*o-s,e[8]=r*h,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=s*o-i,e[6]=n+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*l,s=a*c,i=h*l,n=h*c;e[0]=t-n*o,e[4]=-r*c,e[8]=i+s*o,e[1]=s+i*o,e[5]=r*l,e[9]=n-t*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*l,s=r*c,i=o*l,n=o*c;e[0]=a*l,e[4]=i*h-s,e[8]=t*h+n,e[1]=a*c,e[5]=n*h+t,e[9]=s*h-i,e[2]=-h,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*l,e[4]=n-t*c,e[8]=i*c+s,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=s*c+i,e[10]=t-n*c}else if("XZY"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=t*c+n,e[5]=r*l,e[9]=s*c-i,e[2]=i*c-s,e[6]=o*l,e[10]=n*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ze,t,Ce)}lookAt(t,e,s){const i=this.elements;return Le.subVectors(t,e),0===Le.lengthSq()&&(Le.z=1),Le.normalize(),Pe.crossVectors(s,Le),0===Pe.lengthSq()&&(1===Math.abs(s.z)?Le.x+=1e-4:Le.z+=1e-4,Le.normalize(),Pe.crossVectors(s,Le)),Pe.normalize(),Fe.crossVectors(Le,Pe),i[0]=Pe.x,i[4]=Fe.x,i[8]=Le.x,i[1]=Pe.y,i[5]=Fe.y,i[9]=Le.y,i[2]=Pe.z,i[6]=Fe.z,i[10]=Le.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[4],a=s[8],h=s[12],l=s[1],c=s[5],u=s[9],d=s[13],p=s[2],f=s[6],m=s[10],b=s[14],y=s[3],g=s[7],x=s[11],_=s[15],w=i[0],v=i[4],M=i[8],S=i[12],A=i[1],I=i[5],B=i[9],T=i[13],z=i[2],C=i[6],P=i[10],F=i[14],L=i[3],k=i[7],O=i[11],V=i[15];return n[0]=r*w+o*A+a*z+h*L,n[4]=r*v+o*I+a*C+h*k,n[8]=r*M+o*B+a*P+h*O,n[12]=r*S+o*T+a*F+h*V,n[1]=l*w+c*A+u*z+d*L,n[5]=l*v+c*I+u*C+d*k,n[9]=l*M+c*B+u*P+d*O,n[13]=l*S+c*T+u*F+d*V,n[2]=p*w+f*A+m*z+b*L,n[6]=p*v+f*I+m*C+b*k,n[10]=p*M+f*B+m*P+b*O,n[14]=p*S+f*T+m*F+b*V,n[3]=y*w+g*A+x*z+_*L,n[7]=y*v+g*I+x*C+_*k,n[11]=y*M+g*B+x*P+_*O,n[15]=y*S+g*T+x*F+_*V,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+n*a*c-i*h*c-n*o*u+s*h*u+i*o*d-s*a*d)+t[7]*(+e*a*d-e*h*u+n*r*u-i*r*d+i*h*l-n*a*l)+t[11]*(+e*h*c-e*o*d-n*r*c+s*r*d+n*o*l-s*h*l)+t[15]*(-i*o*l-e*a*c+e*o*u+i*r*c-s*r*u+s*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],b=t[15],y=c*m*h-f*u*h+f*a*d-o*m*d-c*a*b+o*u*b,g=p*u*h-l*m*h-p*a*d+r*m*d+l*a*b-r*u*b,x=l*f*h-p*c*h+p*o*d-r*f*d-l*o*b+r*c*b,_=p*c*a-l*f*a-p*o*u+r*f*u+l*o*m-r*c*m,w=e*y+s*g+i*x+n*_;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/w;return t[0]=y*v,t[1]=(f*u*n-c*m*n-f*i*d+s*m*d+c*i*b-s*u*b)*v,t[2]=(o*m*n-f*a*n+f*i*h-s*m*h-o*i*b+s*a*b)*v,t[3]=(c*a*n-o*u*n-c*i*h+s*u*h+o*i*d-s*a*d)*v,t[4]=g*v,t[5]=(l*m*n-p*u*n+p*i*d-e*m*d-l*i*b+e*u*b)*v,t[6]=(p*a*n-r*m*n-p*i*h+e*m*h+r*i*b-e*a*b)*v,t[7]=(r*u*n-l*a*n+l*i*h-e*u*h-r*i*d+e*a*d)*v,t[8]=x*v,t[9]=(p*c*n-l*f*n-p*s*d+e*f*d+l*s*b-e*c*b)*v,t[10]=(r*f*n-p*o*n+p*s*h-e*f*h-r*s*b+e*o*b)*v,t[11]=(l*o*n-r*c*n-l*s*h+e*c*h+r*s*d-e*o*d)*v,t[12]=_*v,t[13]=(l*f*i-p*c*i+p*s*u-e*f*u-l*s*m+e*c*m)*v,t[14]=(p*o*i-r*f*i-p*s*a+e*f*a+r*s*m-e*o*m)*v,t[15]=(r*c*i-l*o*i+l*s*a-e*c*a-r*s*u+e*o*u)*v,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,o=t.y,a=t.z,h=n*r,l=n*o;return this.set(h*r+s,h*o-i*a,h*a+i*o,0,h*o+i*a,l*o+s,l*a-i*r,0,h*a-i*o,l*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,o=e._z,a=e._w,h=n+n,l=r+r,c=o+o,u=n*h,d=n*l,p=n*c,f=r*l,m=r*c,b=o*c,y=a*h,g=a*l,x=a*c,_=s.x,w=s.y,v=s.z;return i[0]=(1-(f+b))*_,i[1]=(d+x)*_,i[2]=(p-g)*_,i[3]=0,i[4]=(d-x)*w,i[5]=(1-(u+b))*w,i[6]=(m+y)*w,i[7]=0,i[8]=(p+g)*v,i[9]=(m-y)*v,i[10]=(1-(u+f))*v,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=Be.set(i[0],i[1],i[2]).length();const r=Be.set(i[4],i[5],i[6]).length(),o=Be.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],Te.copy(this);const a=1/n,h=1/r,l=1/o;return Te.elements[0]*=a,Te.elements[1]*=a,Te.elements[2]*=a,Te.elements[4]*=h,Te.elements[5]*=h,Te.elements[6]*=h,Te.elements[8]*=l,Te.elements[9]*=l,Te.elements[10]*=l,e.setFromRotationMatrix(Te),s.x=n,s.y=r,s.z=o,this}makePerspective(t,e,s,i,n,r,o=2e3){const a=this.elements,h=2*n/(e-t),l=2*n/(s-i),c=(e+t)/(e-t),u=(s+i)/(s-i);let d,p;if(o===yt)d=-(r+n)/(r-n),p=-2*r*n/(r-n);else{if(o!==gt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-r/(r-n),p=-r*n/(r-n)}return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,i,n,r,o=2e3){const a=this.elements,h=1/(e-t),l=1/(s-i),c=1/(r-n),u=(e+t)*h,d=(s+i)*l;let p,f;if(o===yt)p=(r+n)*c,f=-2*c;else{if(o!==gt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=n*c,f=-1*c}return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<16;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Be=new Jt,Te=new Ie,ze=new Jt(0,0,0),Ce=new Jt(1,1,1),Pe=new Jt,Fe=new Jt,Le=new Jt,ke=new Ie,Oe=new Xt;class Ve{constructor(t=0,e=0,s=0,i=Ve.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],h=i[5],l=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Mt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Mt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(Mt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-Mt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(Mt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Mt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===s&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ke.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ke,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Oe.setFromEuler(this),this.setFromQuaternion(Oe,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ve.DEFAULT_ORDER="XYZ";class Ee{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Re=0;const De=new Jt,Ue=new Xt,Ne=new Ie,qe=new Jt,Ge=new Jt,We=new Jt,He=new Xt,je=new Jt(1,0,0),Ze=new Jt(0,1,0),Ye=new Jt(0,0,1),Xe={type:"added"},Je={type:"removed"},Qe={type:"childadded",child:null},$e={type:"childremoved",child:null};class Ke extends xt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Re++}),this.uuid=vt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ke.DEFAULT_UP.clone();const t=new Jt,e=new Ve,s=new Xt,i=new Jt(1,1,1);e._onChange((function(){s.setFromEuler(e,!1)})),s._onChange((function(){e.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ie},normalMatrix:{value:new Ct}}),this.matrix=new Ie,this.matrixWorld=new Ie,this.matrixAutoUpdate=Ke.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ke.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ee,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ue.setFromAxisAngle(t,e),this.quaternion.multiply(Ue),this}rotateOnWorldAxis(t,e){return Ue.setFromAxisAngle(t,e),this.quaternion.premultiply(Ue),this}rotateX(t){return this.rotateOnAxis(je,t)}rotateY(t){return this.rotateOnAxis(Ze,t)}rotateZ(t){return this.rotateOnAxis(Ye,t)}translateOnAxis(t,e){return De.copy(t).applyQuaternion(this.quaternion),this.position.add(De.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(je,t)}translateY(t){return this.translateOnAxis(Ze,t)}translateZ(t){return this.translateOnAxis(Ye,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ne.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?qe.copy(t):qe.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Ge.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ne.lookAt(Ge,qe,this.up):Ne.lookAt(qe,Ge,this.up),this.quaternion.setFromRotationMatrix(Ne),i&&(Ne.extractRotation(i.matrixWorld),Ue.setFromRotationMatrix(Ne),this.quaternion.premultiply(Ue.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Xe),Qe.child=t,this.dispatchEvent(Qe),Qe.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Je),$e.child=t,this.dispatchEvent($e),$e.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ne.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ne.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ne),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Xe),Qe.child=t,this.dispatchEvent(Qe),Qe.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const i=this.children[s].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ge,t,We),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ge,He,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){e[s].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(!0===t&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,s=t.length;e<s;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function n(e,s){return void 0===e[s.uuid]&&(e[s.uuid]=s.toJSON(t)),s.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const s=e.shapes;if(Array.isArray(s))for(let e=0,i=s.length;e<i;e++){const i=s[e];n(t.shapes,i)}else n(t.shapes,s)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let s=0,i=this.material.length;s<i;s++)e.push(n(t.materials,this.material[s]));i.material=e}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const s=this.animations[e];i.animations.push(n(t.animations,s))}}if(e){const e=r(t.geometries),i=r(t.materials),n=r(t.textures),o=r(t.images),a=r(t.shapes),h=r(t.skeletons),l=r(t.animations),c=r(t.nodes);e.length>0&&(s.geometries=e),i.length>0&&(s.materials=i),n.length>0&&(s.textures=n),o.length>0&&(s.images=o),a.length>0&&(s.shapes=a),h.length>0&&(s.skeletons=h),l.length>0&&(s.animations=l),c.length>0&&(s.nodes=c)}return s.object=i,s;function r(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const s=t.children[e];this.add(s.clone())}return this}}Ke.DEFAULT_UP=new Jt(0,1,0),Ke.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ke.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ts=new Jt,es=new Jt,ss=new Jt,is=new Jt,ns=new Jt,rs=new Jt,os=new Jt,as=new Jt,hs=new Jt,ls=new Jt,cs=new Yt,us=new Yt,ds=new Yt;class ps{constructor(t=new Jt,e=new Jt,s=new Jt){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),ts.subVectors(t,e),i.cross(ts);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){ts.subVectors(i,e),es.subVectors(s,e),ss.subVectors(t,e);const r=ts.dot(ts),o=ts.dot(es),a=ts.dot(ss),h=es.dot(es),l=es.dot(ss),c=r*h-o*o;if(0===c)return n.set(0,0,0),null;const u=1/c,d=(h*a-o*l)*u,p=(r*l-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(t,e,s,i){return null!==this.getBarycoord(t,e,s,i,is)&&(is.x>=0&&is.y>=0&&is.x+is.y<=1)}static getInterpolation(t,e,s,i,n,r,o,a){return null===this.getBarycoord(t,e,s,i,is)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(n,is.x),a.addScaledVector(r,is.y),a.addScaledVector(o,is.z),a)}static getInterpolatedAttribute(t,e,s,i,n,r){return cs.setScalar(0),us.setScalar(0),ds.setScalar(0),cs.fromBufferAttribute(t,e),us.fromBufferAttribute(t,s),ds.fromBufferAttribute(t,i),r.setScalar(0),r.addScaledVector(cs,n.x),r.addScaledVector(us,n.y),r.addScaledVector(ds,n.z),r}static isFrontFacing(t,e,s,i){return ts.subVectors(s,e),es.subVectors(t,e),ts.cross(es).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ts.subVectors(this.c,this.b),es.subVectors(this.a,this.b),.5*ts.cross(es).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ps.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ps.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return ps.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return ps.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ps.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let r,o;ns.subVectors(i,s),rs.subVectors(n,s),as.subVectors(t,s);const a=ns.dot(as),h=rs.dot(as);if(a<=0&&h<=0)return e.copy(s);hs.subVectors(t,i);const l=ns.dot(hs),c=rs.dot(hs);if(l>=0&&c<=l)return e.copy(i);const u=a*c-l*h;if(u<=0&&a>=0&&l<=0)return r=a/(a-l),e.copy(s).addScaledVector(ns,r);ls.subVectors(t,n);const d=ns.dot(ls),p=rs.dot(ls);if(p>=0&&d<=p)return e.copy(n);const f=d*h-a*p;if(f<=0&&h>=0&&p<=0)return o=h/(h-p),e.copy(s).addScaledVector(rs,o);const m=l*p-d*c;if(m<=0&&c-l>=0&&d-p>=0)return os.subVectors(n,i),o=(c-l)/(c-l+(d-p)),e.copy(i).addScaledVector(os,o);const b=1/(m+f+u);return r=f*b,o=u*b,e.copy(s).addScaledVector(ns,r).addScaledVector(rs,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const fs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ms={h:0,s:0,l:0},bs={h:0,s:0,l:0};function ys(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+6*(e-t)*(2/3-s):t}class gs{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(void 0===e&&void 0===s){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=dt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Lt.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=Lt.workingColorSpace){return this.r=t,this.g=e,this.b=s,Lt.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=Lt.workingColorSpace){if(t=St(t,1),e=Mt(e,0,1),s=Mt(s,0,1),0===e)this.r=this.g=this.b=s;else{const i=s<=.5?s*(1+e):s+e-s*e,n=2*s-i;this.r=ys(n,i,t+1/3),this.g=ys(n,i,t),this.b=ys(n,i,t-1/3)}return Lt.toWorkingColorSpace(this,i),this}setStyle(t,e=dt){function s(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],n=s.length;if(3===n)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=dt){const s=fs[t.toLowerCase()];return void 0!==s?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=kt(t.r),this.g=kt(t.g),this.b=kt(t.b),this}copyLinearToSRGB(t){return this.r=Ot(t.r),this.g=Ot(t.g),this.b=Ot(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=dt){return Lt.fromWorkingColorSpace(xs.copy(this),t),65536*Math.round(Mt(255*xs.r,0,255))+256*Math.round(Mt(255*xs.g,0,255))+Math.round(Mt(255*xs.b,0,255))}getHexString(t=dt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Lt.workingColorSpace){Lt.fromWorkingColorSpace(xs.copy(this),e);const s=xs.r,i=xs.g,n=xs.b,r=Math.max(s,i,n),o=Math.min(s,i,n);let a,h;const l=(o+r)/2;if(o===r)a=0,h=0;else{const t=r-o;switch(h=l<=.5?t/(r+o):t/(2-r-o),r){case s:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-s)/t+2;break;case n:a=(s-i)/t+4}a/=6}return t.h=a,t.s=h,t.l=l,t}getRGB(t,e=Lt.workingColorSpace){return Lt.fromWorkingColorSpace(xs.copy(this),e),t.r=xs.r,t.g=xs.g,t.b=xs.b,t}getStyle(t=dt){Lt.fromWorkingColorSpace(xs.copy(this),t);const e=xs.r,s=xs.g,i=xs.b;return t!==dt?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*i)})`}offsetHSL(t,e,s){return this.getHSL(ms),this.setHSL(ms.h+t,ms.s+e,ms.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(ms),t.getHSL(bs);const s=At(ms.h,bs.h,e),i=At(ms.s,bs.s,e),n=At(ms.l,bs.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xs=new gs;gs.NAMES=fs;let _s=0,ws=class extends xt{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_s++}),this.uuid=vt(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new gs(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bt,this.stencilZFail=bt,this.stencilZPass=bt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const s=t[e];if(void 0===s){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),void 0!==this.roughness&&(s.roughness=this.roughness),void 0!==this.metalness&&(s.metalness=this.metalness),void 0!==this.sheen&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(s.shininess=this.shininess),void 0!==this.clearcoat&&(s.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(s.dispersion=this.dispersion),void 0!==this.iridescence&&(s.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(s.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(s.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(s.combine=this.combine)),void 0!==this.envMapRotation&&(s.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(s.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(s.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(s.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(s.size=this.size),null!==this.shadowSide&&(s.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(s.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(s.blending=this.blending),0!==this.side&&(s.side=this.side),!0===this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),!0===this.transparent&&(s.transparent=!0),204!==this.blendSrc&&(s.blendSrc=this.blendSrc),205!==this.blendDst&&(s.blendDst=this.blendDst),100!==this.blendEquation&&(s.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(s.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(s.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(s.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(s.depthFunc=this.depthFunc),!1===this.depthTest&&(s.depthTest=this.depthTest),!1===this.depthWrite&&(s.depthWrite=this.depthWrite),!1===this.colorWrite&&(s.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(s.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(s.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(s.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==bt&&(s.stencilFail=this.stencilFail),this.stencilZFail!==bt&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==bt&&(s.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(s.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(s.rotation=this.rotation),!0===this.polygonOffset&&(s.polygonOffset=!0),0!==this.polygonOffsetFactor&&(s.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(s.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(s.linewidth=this.linewidth),void 0!==this.dashSize&&(s.dashSize=this.dashSize),void 0!==this.gapSize&&(s.gapSize=this.gapSize),void 0!==this.scale&&(s.scale=this.scale),!0===this.dithering&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),!0===this.alphaHash&&(s.alphaHash=!0),!0===this.alphaToCoverage&&(s.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(s.premultipliedAlpha=!0),!0===this.forceSinglePass&&(s.forceSinglePass=!0),!0===this.wireframe&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(s.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(s.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(s.flatShading=!0),!1===this.visible&&(s.visible=!1),!1===this.toneMapped&&(s.toneMapped=!1),!1===this.fog&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData),e){const e=i(t.textures),n=i(t.images);e.length>0&&(s.textures=e),n.length>0&&(s.images=n)}return s}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(null!==e){const t=e.length;s=new Array(t);for(let i=0;i!==t;++i)s[i]=e[i].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}};class vs extends ws{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new gs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ve,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ms=new Jt,Ss=new zt;class As{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=s,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,s=this.count;e<s;e++)Ss.fromBufferAttribute(this,e),Ss.applyMatrix3(t),this.setXY(e,Ss.x,Ss.y);else if(3===this.itemSize)for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyMatrix3(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyMatrix4(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyNormalMatrix(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.transformDirection(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=It(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=Bt(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=It(e,this.array)),e}setX(t,e){return this.normalized&&(e=Bt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=It(e,this.array)),e}setY(t,e){return this.normalized&&(e=Bt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=It(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Bt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=It(e,this.array)),e}setW(t,e){return this.normalized&&(e=Bt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=Bt(e,this.array),s=Bt(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=Bt(e,this.array),s=Bt(s,this.array),i=Bt(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=Bt(e,this.array),s=Bt(s,this.array),i=Bt(i,this.array),n=Bt(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}}class Is extends As{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Bs extends As{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class Ts extends As{constructor(t,e,s){super(new Float32Array(t),e,s)}}let zs=0;const Cs=new Ie,Ps=new Ke,Fs=new Jt,Ls=new Kt,ks=new Kt,Os=new Jt;class Vs extends xt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:zs++}),this.uuid=vt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?Bs:Is)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(void 0!==s){const e=(new Ct).getNormalMatrix(t);s.applyNormalMatrix(e),s.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Cs.makeRotationFromQuaternion(t),this.applyMatrix4(Cs),this}rotateX(t){return Cs.makeRotationX(t),this.applyMatrix4(Cs),this}rotateY(t){return Cs.makeRotationY(t),this.applyMatrix4(Cs),this}rotateZ(t){return Cs.makeRotationZ(t),this.applyMatrix4(Cs),this}translate(t,e,s){return Cs.makeTranslation(t,e,s),this.applyMatrix4(Cs),this}scale(t,e,s){return Cs.makeScale(t,e,s),this.applyMatrix4(Cs),this}lookAt(t){return Ps.lookAt(t),Ps.updateMatrix(),this.applyMatrix4(Ps.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fs).negate(),this.translate(Fs.x,Fs.y,Fs.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let s=0,i=t.length;s<i;s++){const i=t[s];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Ts(e,3))}else{for(let s=0,i=e.count;s<i;s++){const i=t[s];e.setXYZ(s,i.x,i.y,i.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Kt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Jt(-1/0,-1/0,-1/0),new Jt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];Ls.setFromBufferAttribute(s),this.morphTargetsRelative?(Os.addVectors(this.boundingBox.min,Ls.min),this.boundingBox.expandByPoint(Os),Os.addVectors(this.boundingBox.max,Ls.max),this.boundingBox.expandByPoint(Os)):(this.boundingBox.expandByPoint(Ls.min),this.boundingBox.expandByPoint(Ls.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ye);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Jt,1/0);if(t){const s=this.boundingSphere.center;if(Ls.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];ks.setFromBufferAttribute(s),this.morphTargetsRelative?(Os.addVectors(Ls.min,ks.min),Ls.expandByPoint(Os),Os.addVectors(Ls.max,ks.max),Ls.expandByPoint(Os)):(Ls.expandByPoint(ks.min),Ls.expandByPoint(ks.max))}Ls.getCenter(s);let i=0;for(let e=0,n=t.count;e<n;e++)Os.fromBufferAttribute(t,e),i=Math.max(i,s.distanceToSquared(Os));if(e)for(let n=0,r=e.length;n<r;n++){const r=e[n],o=this.morphTargetsRelative;for(let e=0,n=r.count;e<n;e++)Os.fromBufferAttribute(r,e),o&&(Fs.fromBufferAttribute(t,e),Os.add(Fs)),i=Math.max(i,s.distanceToSquared(Os))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const s=e.position,i=e.normal,n=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new As(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<s.count;t++)o[t]=new Jt,a[t]=new Jt;const h=new Jt,l=new Jt,c=new Jt,u=new zt,d=new zt,p=new zt,f=new Jt,m=new Jt;function b(t,e,i){h.fromBufferAttribute(s,t),l.fromBufferAttribute(s,e),c.fromBufferAttribute(s,i),u.fromBufferAttribute(n,t),d.fromBufferAttribute(n,e),p.fromBufferAttribute(n,i),l.sub(h),c.sub(h),d.sub(u),p.sub(u);const r=1/(d.x*p.y-p.x*d.y);isFinite(r)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(r),m.copy(c).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(r),o[t].add(f),o[e].add(f),o[i].add(f),a[t].add(m),a[e].add(m),a[i].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)b(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const g=new Jt,x=new Jt,_=new Jt,w=new Jt;function v(t){_.fromBufferAttribute(i,t),w.copy(_);const e=o[t];g.copy(e),g.sub(_.multiplyScalar(_.dot(e))).normalize(),x.crossVectors(w,e);const s=x.dot(a[t])<0?-1:1;r.setXYZW(t,g.x,g.y,g.z,s)}for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)v(t.getX(e+0)),v(t.getX(e+1)),v(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let s=this.getAttribute("normal");if(void 0===s)s=new As(new Float32Array(3*e.count),3),this.setAttribute("normal",s);else for(let t=0,e=s.count;t<e;t++)s.setXYZ(t,0,0,0);const i=new Jt,n=new Jt,r=new Jt,o=new Jt,a=new Jt,h=new Jt,l=new Jt,c=new Jt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),n.fromBufferAttribute(e,p),r.fromBufferAttribute(e,f),l.subVectors(r,n),c.subVectors(i,n),l.cross(c),o.fromBufferAttribute(s,d),a.fromBufferAttribute(s,p),h.fromBufferAttribute(s,f),o.add(l),a.add(l),h.add(l),s.setXYZ(d,o.x,o.y,o.z),s.setXYZ(p,a.x,a.y,a.z),s.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),l.subVectors(r,n),c.subVectors(i,n),l.cross(c),s.setXYZ(t+0,l.x,l.y,l.z),s.setXYZ(t+1,l.x,l.y,l.z),s.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)Os.fromBufferAttribute(t,e),Os.normalize(),t.setXYZ(e,Os.x,Os.y,Os.z)}toNonIndexed(){function t(t,e){const s=t.array,i=t.itemSize,n=t.normalized,r=new s.constructor(e.length*i);let o=0,a=0;for(let n=0,h=e.length;n<h;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*i;for(let t=0;t<i;t++)r[a++]=s[o++]}return new As(r,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Vs,s=this.index.array,i=this.attributes;for(const n in i){const r=t(i[n],s);e.setAttribute(n,r)}const n=this.morphAttributes;for(const i in n){const r=[],o=n[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],s);r.push(i)}e.morphAttributes[i]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,s=r.length;t<s;t++){const s=r[t];e.addGroup(s.start,s.count,s.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const s in e)void 0!==e[s]&&(t[s]=e[s]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const e in s){const i=s[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let n=!1;for(const e in this.morphAttributes){const s=this.morphAttributes[e],r=[];for(let e=0,i=s.length;e<i;e++){const i=s[e];r.push(i.toJSON(t.data))}r.length>0&&(i[e]=r,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;null!==s&&this.setIndex(s.clone(e));const i=t.attributes;for(const t in i){const s=i[t];this.setAttribute(t,s.clone(e))}const n=t.morphAttributes;for(const t in n){const s=[],i=n[t];for(let t=0,n=i.length;t<n;t++)s.push(i[t].clone(e));this.morphAttributes[t]=s}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Es=new Ie,Rs=new Ae,Ds=new ye,Us=new Jt,Ns=new Jt,qs=new Jt,Gs=new Jt,Ws=new Jt,Hs=new Jt,js=new Jt,Zs=new Jt;class Ys extends Ke{constructor(t=new Vs,e=new vs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const s=t[e[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=s.length;t<e;t++){const e=s[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(n&&o){Hs.set(0,0,0);for(let s=0,i=n.length;s<i;s++){const i=o[s],a=n[s];0!==i&&(Ws.fromBufferAttribute(a,t),r?Hs.addScaledVector(Ws,i):Hs.addScaledVector(Ws.sub(e),i))}e.add(Hs)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;if(void 0!==i){if(null===s.boundingSphere&&s.computeBoundingSphere(),Ds.copy(s.boundingSphere),Ds.applyMatrix4(n),Rs.copy(t.ray).recast(t.near),!1===Ds.containsPoint(Rs.origin)){if(null===Rs.intersectSphere(Ds,Us))return;if(Rs.origin.distanceToSquared(Us)>(t.far-t.near)**2)return}Es.copy(n).invert(),Rs.copy(t.ray).applyMatrix4(Es),null!==s.boundingBox&&!1===Rs.intersectsBox(s.boundingBox)||this._computeIntersections(t,e,Rs)}}_computeIntersections(t,e,s){let i;const n=this.geometry,r=this.material,o=n.index,a=n.attributes.position,h=n.attributes.uv,l=n.attributes.uv1,c=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(r))for(let n=0,a=u.length;n<a;n++){const a=u[n],p=r[a.materialIndex];for(let n=Math.max(a.start,d.start),r=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));n<r;n+=3){i=Xs(this,p,t,s,h,l,c,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);n<a;n+=3){i=Xs(this,r,t,s,h,l,c,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,o=u.length;n<o;n++){const o=u[n],p=r[o.materialIndex];for(let n=Math.max(o.start,d.start),r=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));n<r;n+=3){i=Xs(this,p,t,s,h,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);n<o;n+=3){i=Xs(this,r,t,s,h,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}}}function Xs(t,e,s,i,n,r,o,a,h,l){t.getVertexPosition(a,Ns),t.getVertexPosition(h,qs),t.getVertexPosition(l,Gs);const c=function(t,e,s,i,n,r,o,a){let h;if(h=1===e.side?i.intersectTriangle(o,r,n,!0,a):i.intersectTriangle(n,r,o,0===e.side,a),null===h)return null;Zs.copy(a),Zs.applyMatrix4(t.matrixWorld);const l=s.ray.origin.distanceTo(Zs);return l<s.near||l>s.far?null:{distance:l,point:Zs.clone(),object:t}}(t,e,s,i,Ns,qs,Gs,js);if(c){const t=new Jt;ps.getBarycoord(js,Ns,qs,Gs,t),n&&(c.uv=ps.getInterpolatedAttribute(n,a,h,l,t,new zt)),r&&(c.uv1=ps.getInterpolatedAttribute(r,a,h,l,t,new zt)),o&&(c.normal=ps.getInterpolatedAttribute(o,a,h,l,t,new Jt),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const e={a:a,b:h,c:l,normal:new Jt,materialIndex:0};ps.getNormal(Ns,qs,Gs,e.normal),c.face=e,c.barycoord=t}return c}const Js=new Jt,Qs=new Jt,$s=new Ct;class Ks{constructor(t=new Jt(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=Js.subVectors(s,e).cross(Qs.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(Js),i=this.normal.dot(s);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||$s.getNormalMatrix(t),i=this.coplanarPoint(Js).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ti=new ye,ei=new Jt;class si{constructor(t=new Ks,e=new Ks,s=new Ks,i=new Ks,n=new Ks,r=new Ks){this.planes=[t,e,s,i,n,r]}set(t,e,s,i,n,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(s),o[3].copy(i),o[4].copy(n),o[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=2e3){const s=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],a=i[3],h=i[4],l=i[5],c=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],b=i[12],y=i[13],g=i[14],x=i[15];if(s[0].setComponents(a-n,u-h,m-d,x-b).normalize(),s[1].setComponents(a+n,u+h,m+d,x+b).normalize(),s[2].setComponents(a+r,u+l,m+p,x+y).normalize(),s[3].setComponents(a-r,u-l,m-p,x-y).normalize(),s[4].setComponents(a-o,u-c,m-f,x-g).normalize(),e===yt)s[5].setComponents(a+o,u+c,m+f,x+g).normalize();else{if(e!==gt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);s[5].setComponents(o,c,f,g).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ti.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ti.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ti)}intersectsSprite(t){return ti.center.set(0,0,0),ti.radius=.7071067811865476,ti.applyMatrix4(t.matrixWorld),this.intersectsSphere(ti)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(s)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(ei.x=i.normal.x>0?t.max.x:t.min.x,ei.y=i.normal.y>0?t.max.y:t.min.y,ei.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ei)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class ii extends Zt{constructor(t=null,e=1,s=1,i,n,r,o,a,h=1003,l=1003,c,u){super(null,r,o,a,h,l,i,n,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ni extends As{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const ri=new Ie,oi=new Ie,ai=[],hi=new Kt,li=new Ie,ci=new Ys,ui=new ye;class di extends Ys{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new ni(new Float32Array(16*s),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<s;t++)this.setMatrixAt(t,li)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Kt),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,ri),hi.copy(t.boundingBox).applyMatrix4(ri),this.boundingBox.union(hi)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new ye),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,ri),ui.copy(t.boundingSphere).applyMatrix4(ri),this.boundingSphere.union(ui)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=t*(s.length+1)+1;for(let t=0;t<s.length;t++)s[t]=i[n+t]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(ci.geometry=this.geometry,ci.material=this.material,void 0!==ci.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ui.copy(this.boundingSphere),ui.applyMatrix4(s),!1!==t.ray.intersectsSphere(ui)))for(let n=0;n<i;n++){this.getMatrixAt(n,ri),oi.multiplyMatrices(s,ri),ci.matrixWorld=oi,ci.raycast(t,ai);for(let t=0,s=ai.length;t<s;t++){const s=ai[t];s.instanceId=n,s.object=this,e.push(s)}ai.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new ni(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;null===this.morphTexture&&(this.morphTexture=new ii(new Float32Array(i*this.count),i,this.count,1028,1015));const n=this.morphTexture.source.data.data;let r=0;for(let t=0;t<s.length;t++)r+=s[t];const o=this.geometry.morphTargetsRelative?1:1-r,a=i*t;n[a]=o,n.set(s,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const pi=new Ie;function fi(t,e){return t.distance-e.distance}function mi(t,e,s,i){let n=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,s)&&(n=!1)}if(!0===n&&!0===i){const i=t.children;for(let t=0,n=i.length;t<n;t++)mi(i[t],e,s,!0)}}const bi=new Jt,yi=new Jt;class gi{constructor(t=new Jt,e=new Jt){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){bi.subVectors(t,this.start),yi.subVectors(this.end,this.start);const s=yi.dot(yi);let i=yi.dot(bi)/s;return e&&(i=Mt(i,0,1)),i}closestPointToPoint(t,e,s){const i=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"170"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="170");const xi=65536;var _i=(t=>(t[t.IGNORE=0]="IGNORE",t[t.NORMAL=1]="NORMAL",t[t.HIGH=2]="HIGH",t))(_i||{}),wi=(t=>(t[t.FACE=0]="FACE",t[t.LINE=1]="LINE",t[t.POINT=2]="POINT",t))(wi||{}),vi=(t=>(t[t.LINE=0]="LINE",t[t.MESH=1]="MESH",t))(vi||{}),Mi=(t=>(t[t.SET_BATCH_STATE=0]="SET_BATCH_STATE",t[t.ADD_BATCH=1]="ADD_BATCH",t[t.REMOVE_BATCH=2]="REMOVE_BATCH",t[t.UPDATE_FINISHED=3]="UPDATE_FINISHED",t))(Mi||{}),Si=(t=>(t[t.Full=0]="Full",t[t.Line=1]="Line",t[t.Hidden=2]="Hidden",t))(Si||{}),Ai=(t=>(t[t.LOAD=0]="LOAD",t[t.UNLOAD=1]="UNLOAD",t[t.PICK=2]="PICK",t[t.CAMERA_UPDATE=3]="CAMERA_UPDATE",t[t.GET_BOUNDINGBOXES=4]="GET_BOUNDINGBOXES",t[t.PROPERTY_GETSETNAMES=5]="PROPERTY_GETSETNAMES",t[t.PROPERTY_GETPROPERTYDEFINITIONS=6]="PROPERTY_GETPROPERTYDEFINITIONS",t[t.PROPERTY_GETPROPERTYVALUES=7]="PROPERTY_GETPROPERTYVALUES",t[t.GUIDS_TO_ITEMIDS=8]="GUIDS_TO_ITEMIDS",t[t.AGGREGATE_PROPERTIES=9]="AGGREGATE_PROPERTIES",t[t.CALL=10]="CALL",t[t.UPDATE_GEOMETRY=11]="UPDATE_GEOMETRY",t[t.ADD_MATERIAL=12]="ADD_MATERIAL",t[t.ERROR=13]="ERROR",t))(Ai||{}),Ii=(t=>(t[t.PICK_PRIORITY=0]="PICK_PRIORITY",t[t.VISIBILITY=1]="VISIBILITY",t[t.SELECTION=2]="SELECTION",t[t.HOVER=3]="HOVER",t))(Ii||{});const Bi=new Int32Array(2),Ti=new Float32Array(Bi.buffer),zi=new Float64Array(Bi.buffer),Ci=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var Pi,Fi;(Fi=Pi||(Pi={}))[Fi.UTF8_BYTES=1]="UTF8_BYTES",Fi[Fi.UTF16_STRING=2]="UTF16_STRING";class Li{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Li(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Bi[0]=this.readInt32(t),Ti[0]}readFloat64(t){return Bi[Ci?0:1]=this.readInt32(t),Bi[Ci?1:0]=this.readInt32(t+4),zi[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Ti[0]=e,this.writeInt32(t,Bi[0])}writeFloat64(t,e){zi[0]=e,this.writeInt32(t,Bi[Ci?0:1]),this.writeInt32(t+4,Bi[Ci?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const s=t-this.readInt32(t);return e<this.readInt16(s)?this.readInt16(s+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const s=this.readInt32(t);t+=4;const i=this.bytes_.subarray(t,t+s);return e===Pi.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e)}return s}createObjList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e.unpack())}return s}}const ki=1.25,Oi=65535,Vi=Math.pow(2,-24),Ei=Symbol("SKIP_GENERATION");function Ri(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function Di(t,e){if(!t.index){const s=t.attributes.position.count,i=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(s,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new As(i,1));for(let t=0;t<s;t++)i[t]=t}}function Ui(t){const e=Ri(t),s=t.drawRange,i=s.start/3,n=(s.start+s.count)/3,r=Math.max(0,i),o=Math.min(e,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function Ni(t){if(!t.groups||!t.groups.length)return Ui(t);const e=[],s=new Set,i=t.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const e of t.groups){const t=e.start/3,i=(e.start+e.count)/3;s.add(Math.max(n,t)),s.add(Math.min(r,i))}const o=Array.from(s.values()).sort(((t,e)=>t-e));for(let t=0;t<o.length-1;t++){const s=o[t],i=o[t+1];e.push({offset:Math.floor(s),count:Math.floor(i-s)})}return e}function qi(t,e,s){return s.min.x=e[t],s.min.y=e[t+1],s.min.z=e[t+2],s.max.x=e[t+3],s.max.y=e[t+4],s.max.z=e[t+5],s}function Gi(t){let e=-1,s=-1/0;for(let i=0;i<3;i++){const n=t[i+3]-t[i];n>s&&(s=n,e=i)}return e}function Wi(t,e){e.set(t)}function Hi(t,e,s){let i,n;for(let r=0;r<3;r++){const o=r+3;i=t[r],n=e[r],s[r]=i<n?i:n,i=t[o],n=e[o],s[o]=i>n?i:n}}function ji(t,e,s){for(let i=0;i<3;i++){const n=e[t+2*i],r=e[t+2*i+1],o=n-r,a=n+r;o<s[i]&&(s[i]=o),a>s[i+3]&&(s[i+3]=a)}}function Zi(t){const e=t[3]-t[0],s=t[4]-t[1],i=t[5]-t[2];return 2*(e*s+s*i+i*e)}function Yi(t,e,s,i,n=null){let r=1/0,o=1/0,a=1/0,h=-1/0,l=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,b=-1/0;const y=null!==n;for(let i=6*e,n=6*(e+s);i<n;i+=6){const e=t[i+0],s=t[i+1],n=e-s,g=e+s;n<r&&(r=n),g>h&&(h=g),y&&e<u&&(u=e),y&&e>f&&(f=e);const x=t[i+2],_=t[i+3],w=x-_,v=x+_;w<o&&(o=w),v>l&&(l=v),y&&x<d&&(d=x),y&&x>m&&(m=x);const M=t[i+4],S=t[i+5],A=M-S,I=M+S;A<a&&(a=A),I>c&&(c=I),y&&M<p&&(p=M),y&&M>b&&(b=M)}i[0]=r,i[1]=o,i[2]=a,i[3]=h,i[4]=l,i[5]=c,y&&(n[0]=u,n[1]=d,n[2]=p,n[3]=f,n[4]=m,n[5]=b)}const Xi=32,Ji=(t,e)=>t.candidate-e.candidate,Qi=new Array(Xi).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),$i=new Float32Array(6);class Ki{constructor(){}}function tn(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,l=2*r.axis;for(;;){for(;o<=a&&s[6*o+l]<h;)o++;for(;o<=a&&s[6*a+l]>=h;)a--;if(!(o<a))return o;for(let t=0;t<3;t++){let s=e[3*o+t];e[3*o+t]=e[3*a+t],e[3*a+t]=s}for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}function en(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,l=2*r.axis;for(;;){for(;o<=a&&s[6*o+l]<h;)o++;for(;o<=a&&s[6*a+l]>=h;)a--;if(!(o<a))return o;{let e=t[o];t[o]=t[a],t[a]=e;for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}}function sn(t,e){const s=t.geometry,i=s.index?s.index.array:null,n=e.maxDepth,r=e.verbose,o=e.maxLeafTris,a=e.strategy,h=e.onProgress,l=Ri(s),c=t._indirectBuffer;let u=!1;const d=new Float32Array(6),p=new Float32Array(6),f=function(t,e){var s;(s=e)[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0;const i=t.attributes.position,n=t.index?t.index.array:null,r=Ri(t),o=new Float32Array(6*r),a=i.normalized,h=i.array,l=i.offset||0;let c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);const u=["getX","getY","getZ"];for(let t=0;t<r;t++){const s=3*t,r=6*t;let d=s+0,p=s+1,f=s+2;n&&(d=n[d],p=n[p],f=n[f]),a||(d=d*c+l,p=p*c+l,f=f*c+l);for(let t=0;t<3;t++){let s,n,l;a?(s=i[u[t]](d),n=i[u[t]](p),l=i[u[t]](f)):(s=h[d+t],n=h[p+t],l=h[f+t]);let c=s;n<c&&(c=n),l<c&&(c=l);let m=s;n>m&&(m=n),l>m&&(m=l);const b=(m-c)/2,y=2*t;o[r+y+0]=c+b,o[r+y+1]=b+(Math.abs(c)+b)*Vi,c<e[t]&&(e[t]=c),m>e[t+3]&&(e[t+3]=m)}}return o}(s,d),m=e.indirect?en:tn,b=[],y=e.indirect?Ui(s):Ni(s);if(1===y.length){const t=y[0],e=new Ki;e.boundingData=d,function(t,e,s,i){let n=1/0,r=1/0,o=1/0,a=-1/0,h=-1/0,l=-1/0;for(let i=6*e,c=6*(e+s);i<c;i+=6){const e=t[i+0];e<n&&(n=e),e>a&&(a=e);const s=t[i+2];s<r&&(r=s),s>h&&(h=s);const c=t[i+4];c<o&&(o=c),c>l&&(l=c)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=h,i[5]=l}(f,t.offset,t.count,p),x(e,t.offset,t.count,p),b.push(e)}else for(let t of y){const e=new Ki;e.boundingData=new Float32Array(6),Yi(f,t.offset,t.count,e.boundingData,p),x(e,t.offset,t.count,p),b.push(e)}return b;function g(t){h&&h(t/l)}function x(t,e,h,l=null,d=0){if(!u&&d>=n&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(s))),h<=o||d>=n)return g(e+h),t.offset=e,t.count=h,t;const b=function(t,e,s,i,n,r){let o=-1,a=0;if(0===r)o=Gi(e),-1!==o&&(a=(e[o]+e[o+3])/2);else if(1===r)o=Gi(t),-1!==o&&(a=function(t,e,s,i){let n=0;for(let r=e,o=e+s;r<o;r++)n+=t[6*r+2*i];return n/s}(s,i,n,o));else if(2===r){const r=Zi(t);let h=ki*n;const l=6*i,c=6*(i+n);for(let t=0;t<3;t++){const i=e[t],u=(e[t+3]-i)/Xi;if(n<8){const e=[...Qi];e.length=n;let i=0;for(let n=l;n<c;n+=6,i++){const r=e[i];r.candidate=s[n+2*t],r.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:h}=r;for(let t=0;t<3;t++)h[t]=1/0,h[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0;ji(n,s,o)}e.sort(Ji);let u=n;for(let t=0;t<u;t++){const s=e[t];for(;t+1<u&&e[t+1].candidate===s.candidate;)e.splice(t+1,1),u--}for(let i=l;i<c;i+=6){const n=s[i+2*t];for(let t=0;t<u;t++){const r=e[t];n>=r.candidate?ji(i,s,r.rightCacheBounds):(ji(i,s,r.leftCacheBounds),r.count++)}}for(let s=0;s<u;s++){const i=e[s],l=i.count,c=n-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==l&&(p=Zi(u)/r);let f=0;0!==c&&(f=Zi(d)/r);const m=1+ki*(p*l+f*c);m<h&&(o=t,h=m,a=i.candidate)}}else{for(let t=0;t<Xi;t++){const e=Qi[t];e.count=0,e.candidate=i+u+t*u;const s=e.bounds;for(let t=0;t<3;t++)s[t]=1/0,s[t+3]=-1/0}for(let e=l;e<c;e+=6){let n=~~((s[e+2*t]-i)/u);n>=Xi&&(n=31);const r=Qi[n];r.count++,ji(e,s,r.bounds)}const e=Qi[31];Wi(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){const e=Qi[t],s=Qi[t+1];Hi(e.bounds,s.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let e=0;e<31;e++){const s=Qi[e],i=s.count,l=s.bounds,c=Qi[e+1].rightCacheBounds;0!==i&&(0===d?Wi(l,$i):Hi(l,$i,$i)),d+=i;let u=0,p=0;0!==d&&(u=Zi($i)/r);const f=n-d;0!==f&&(p=Zi(c)/r);const m=1+ki*(u*d+p*f);m<h&&(o=t,h=m,a=s.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}(t.boundingData,l,f,e,h,a);if(-1===b.axis)return g(e+h),t.offset=e,t.count=h,t;const y=m(c,i,f,e,h,b);if(y===e||y===e+h)g(e+h),t.offset=e,t.count=h;else{t.splitAxis=b.axis;const s=new Ki,i=e,n=y-e;t.left=s,s.boundingData=new Float32Array(6),Yi(f,i,n,s.boundingData,p),x(s,i,n,p,d+1);const r=new Ki,o=y,a=h-n;t.right=r,r.boundingData=new Float32Array(6),Yi(f,o,a,r.boundingData,p),x(r,o,a,p,d+1)}return t}}function nn(t,e){const s=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){const s=(t.index?t.index.count:t.attributes.position.count)/3,i=s>65536,n=i?4:2,r=e?new SharedArrayBuffer(s*n):new ArrayBuffer(s*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let t=0,e=o.length;t<e;t++)o[t]=t;return o}(s,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;const e=Ri(t),s=Ni(t).sort(((t,e)=>t.offset-e.offset)),i=s[s.length-1];i.count=Math.min(e-i.offset,i.count);let n=0;return s.forEach((({count:t})=>n+=t)),e!==n}(s)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||Di(s,e);const i=sn(t,e);let n,r,o;const a=[],h=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let t=0;t<i.length;t++){const e=i[t];const s=new h(32*l(e));n=new Float32Array(s),r=new Uint32Array(s),o=new Uint16Array(s),c(0,e),a.push(s)}return void(t._roots=a);function l(t){return t.count?1:1+l(t.left)+l(t.right)}function c(t,e){const s=t/4,i=t/2,a=!!e.count,h=e.boundingData;for(let t=0;t<6;t++)n[s+t]=h[t];if(a){const n=e.offset,a=e.count;return r[s+6]=n,o[i+14]=a,o[i+15]=Oi,t+32}{const i=e.left,n=e.right,o=e.splitAxis;let a;if(a=c(t+32,i),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[s+6]=a/4,a=c(a,n),r[s+7]=o,a}}}class rn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const r=t[n][e];s=r<s?r:s,i=r>i?r:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const r=e[n],o=t.dot(r);s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}rn.prototype.setFromBox=function(){const t=new Jt;return function(e,s){const i=s.min,n=s.max;let r=1/0,o=-1/0;for(let s=0;s<=1;s++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){t.x=i.x*s+n.x*(1-s),t.y=i.y*a+n.y*(1-a),t.z=i.z*h+n.z*(1-h);const l=e.dot(t);r=Math.min(l,r),o=Math.max(l,o)}this.min=r,this.max=o}}();const on=function(){const t=new Jt,e=new Jt,s=new Jt;return function(i,n,r){const o=i.start,a=t,h=n.start,l=e;s.subVectors(o,h),t.subVectors(i.end,i.start),e.subVectors(n.end,n.start);const c=s.dot(l),u=l.dot(a),d=l.dot(l),p=s.dot(a),f=a.dot(a)*d-u*u;let m,b;m=0!==f?(c*u-p*d)/f:0,b=(c+m*u)/d,r.x=m,r.y=b}}(),an=function(){const t=new zt,e=new Jt,s=new Jt;return function(i,n,r,o){on(i,n,t);let a=t.x,h=t.y;if(a>=0&&a<=1&&h>=0&&h<=1)return i.at(a,r),void n.at(h,o);if(a>=0&&a<=1)return h<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,r);if(h>=0&&h<=1)return a<0?i.at(0,r):i.at(1,r),void n.closestPointToPoint(r,!0,o);{let t,l;t=a<0?i.start:i.end,l=h<0?n.start:n.end;const c=e,u=s;return i.closestPointToPoint(l,!0,e),n.closestPointToPoint(t,!0,s),c.distanceToSquared(l)<=u.distanceToSquared(t)?(r.copy(c),void o.copy(l)):(r.copy(t),void o.copy(u))}}}(),hn=function(){const t=new Jt,e=new Jt,s=new Ks,i=new gi;return function(n,r){const{radius:o,center:a}=n,{a:h,b:l,c:c}=r;i.start=h,i.end=l;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=h,i.end=c;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=l,i.end=c;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;const u=r.getPlane(s);if(Math.abs(u.distanceToPoint(a))<=o){const t=u.projectPoint(a,e);if(r.containsPoint(t))return!0}return!1}}();function ln(t){return Math.abs(t)<1e-15}class cn extends ps{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Jt)),this.satBounds=new Array(4).fill().map((()=>new rn)),this.points=[this.a,this.b,this.c],this.sphere=new ye,this.plane=new Ks,this.needsUpdate=!0}intersectsSphere(t){return hn(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],l=r[1];h.subVectors(t,e),l.setFromPoints(h,i);const c=n[2],u=r[2];c.subVectors(e,s),u.setFromPoints(c,i);const d=n[3],p=r[3];d.subVectors(s,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}cn.prototype.closestPointToSegment=function(){const t=new Jt,e=new Jt,s=new gi;return function(i,n=null,r=null){const{start:o,end:a}=i,h=this.points;let l,c=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;s.start.copy(h[o]),s.end.copy(h[a]),an(s,i,t,e),l=t.distanceToSquared(e),l<c&&(c=l,n&&n.copy(t),r&&r.copy(e))}return this.closestPointToPoint(o,t),l=o.distanceToSquared(t),l<c&&(c=l,n&&n.copy(t),r&&r.copy(o)),this.closestPointToPoint(a,t),l=a.distanceToSquared(t),l<c&&(c=l,n&&n.copy(t),r&&r.copy(a)),Math.sqrt(c)}}(),cn.prototype.intersectsTriangle=function(){const t=new cn,e=new Array(3),s=new Array(3),i=new rn,n=new rn,r=new Jt,o=new Jt,a=new Jt,h=new Jt,l=new Jt,c=new gi,u=new gi,d=new gi,p=new Jt;function f(t,e,s){const i=t.points;let n=0,r=-1;for(let t=0;t<3;t++){const{start:a,end:h}=c;a.copy(i[t]),h.copy(i[(t+1)%3]),c.delta(o);const l=ln(e.distanceToPoint(a));if(ln(e.normal.dot(o))&&l){s.copy(c),n=2;break}const u=e.intersectLine(c,p);if(!u&&l&&p.copy(a),(u||l)&&!ln(p.distanceTo(h))){if(n<=1){(1===n?s.start:s.end).copy(p),l&&(r=n)}else if(n>=2){(1===r?s.start:s.end).copy(p),n=2;break}if(n++,2===n&&-1===r)break}}return n}return function(o,c=null,p=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const m=this.plane,b=o.plane;if(Math.abs(m.normal.dot(b.normal))>1-1e-10){const t=this.satBounds,a=this.satAxes;s[0]=o.a,s[1]=o.b,s[2]=o.c;for(let e=0;e<4;e++){const n=t[e],r=a[e];if(i.setFromPoints(r,s),n.isSeparated(i))return!1}const h=o.satBounds,l=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const s=h[t],n=l[t];if(i.setFromPoints(n,e),s.isSeparated(i))return!1}for(let t=0;t<4;t++){const o=a[t];for(let t=0;t<4;t++){const a=l[t];if(r.crossVectors(o,a),i.setFromPoints(r,e),n.setFromPoints(r,s),i.isSeparated(n))return!1}}return c&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{const t=f(this,b,u);if(1===t&&o.containsPoint(u.end))return c&&(c.start.copy(u.end),c.end.copy(u.end)),!0;if(2!==t)return!1;const e=f(o,m,d);if(1===e&&this.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(a),d.delta(h),a.dot(h)<0){let t=d.start;d.start=d.end,d.end=t}const s=u.start.dot(a),i=u.end.dot(a),n=d.start.dot(a),r=d.end.dot(a);return(s===r||n===i||i<n!==s<r)&&(c&&(l.subVectors(u.start,d.start),l.dot(a)>0?c.start.copy(u.start):c.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(a)<0?c.end.copy(u.end):c.end.copy(d.end)),!0)}}}(),cn.prototype.distanceToPoint=function(){const t=new Jt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),cn.prototype.distanceToTriangle=function(){const t=new Jt,e=new Jt,s=["a","b","c"],i=new gi,n=new gi;return function(r,o=null,a=null){const h=o||a?i:null;if(this.intersectsTriangle(r,h))return(o||a)&&(o&&h.getCenter(o),a&&h.getCenter(a)),0;let l=1/0;for(let e=0;e<3;e++){let i;const n=s[e],h=r[n];this.closestPointToPoint(h,t),i=h.distanceToSquared(t),i<l&&(l=i,o&&o.copy(t),a&&a.copy(h));const c=this[n];r.closestPointToPoint(c,t),i=c.distanceToSquared(t),i<l&&(l=i,o&&o.copy(c),a&&a.copy(t))}for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];i.set(this[c],this[u]);for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];n.set(r[c],r[u]),an(i,n,t,e);const d=t.distanceToSquared(e);d<l&&(l=d,o&&o.copy(t),a&&a.copy(e))}}return Math.sqrt(l)}}();class un{constructor(t,e,s){this.isOrientedBox=!0,this.min=new Jt,this.max=new Jt,this.matrix=new Ie,this.invMatrix=new Ie,this.points=new Array(8).fill().map((()=>new Jt)),this.satAxes=new Array(3).fill().map((()=>new Jt)),this.satBounds=new Array(3).fill().map((()=>new rn)),this.alignedSatBounds=new Array(3).fill().map((()=>new rn)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}un.prototype.update=function(){return function(){const t=this.matrix,e=this.min,s=this.max,i=this.points;for(let n=0;n<=1;n++)for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){const a=i[1*n|2*r|4*o];a.x=n?s.x:e.x,a.y=r?s.y:e.y,a.z=o?s.z:e.z,a.applyMatrix4(t)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let t=0;t<3;t++){const e=r[t],s=n[t],a=i[1<<t];e.subVectors(o,a),s.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),un.prototype.intersectsBox=function(){const t=new rn;return function(e){this.needsUpdate&&this.update();const s=e.min,i=e.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(t.min=s.x,t.max=i.x,o[0].isSeparated(t))return!1;if(t.min=s.y,t.max=i.y,o[1].isSeparated(t))return!1;if(t.min=s.z,t.max=i.z,o[2].isSeparated(t))return!1;for(let s=0;s<3;s++){const i=r[s],o=n[s];if(t.setFromBox(i,e),o.isSeparated(t))return!1}return!0}}(),un.prototype.intersectsTriangle=function(){const t=new cn,e=new Array(3),s=new rn,i=new rn,n=new Jt;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(t.copy(r),t.update(),r=t);const o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let t=0;t<3;t++){const i=o[t],n=a[t];if(s.setFromPoints(n,e),i.isSeparated(s))return!1}const h=r.satBounds,l=r.satAxes,c=this.points;for(let t=0;t<3;t++){const e=h[t],i=l[t];if(s.setFromPoints(i,c),e.isSeparated(s))return!1}for(let t=0;t<3;t++){const r=a[t];for(let t=0;t<4;t++){const o=l[t];if(n.crossVectors(r,o),s.setFromPoints(n,e),i.setFromPoints(n,c),s.isSeparated(i))return!1}}return!0}}(),un.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),un.prototype.distanceToPoint=function(){const t=new Jt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),un.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new gi)),s=new Array(12).fill().map((()=>new gi)),i=new Jt,n=new Jt;return function(r,o=0,a=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||h)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),h&&h.copy(n)),0;const l=o*o,c=r.min,u=r.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];n.copy(e).clamp(c,u);const s=e.distanceToSquared(n);if(s<p&&(p=s,a&&a.copy(e),h&&h.copy(n),s<l))return Math.sqrt(s)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){const o=(i+1)%3,a=(i+2)%3,h=1<<i|n<<o|r<<a,l=d[n<<o|r<<a],p=d[h];e[f].set(l,p);const m=t[i],b=t[o],y=t[a],g=s[f],x=g.start,_=g.end;x[m]=c[m],x[b]=n?c[b]:u[b],x[y]=r?c[y]:u[b],_[m]=u[m],_[b]=n?c[b]:u[b],_[y]=r?c[y]:u[b],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){n.x=t?u.x:c.x,n.y=e?u.y:c.y,n.z=s?u.z:c.z,this.closestPointToPoint(n,i);const r=n.distanceToSquared(i);if(r<p&&(p=r,a&&a.copy(i),h&&h.copy(n),r<l))return Math.sqrt(r)}for(let t=0;t<12;t++){const r=e[t];for(let t=0;t<12;t++){const e=s[t];an(r,e,i,n);const o=i.distanceToSquared(n);if(o<p&&(p=o,a&&a.copy(i),h&&h.copy(n),o<l))return Math.sqrt(o)}}return Math.sqrt(p)}}();class dn{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class pn extends dn{constructor(){super((()=>new cn))}}const fn=new pn;function mn(t,e){return 65535===e[t+15]}function bn(t,e){return e[t+6]}function yn(t,e){return e[t+14]}function gn(t){return t+8}function xn(t,e){return e[t+6]}function _n(t,e){return e[t+7]}const wn=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}};let vn,Mn;const Sn=[],An=new dn((()=>new Kt));function In(t,e,s,i,n,r){vn=An.getPrimitive(),Mn=An.getPrimitive(),Sn.push(vn,Mn),wn.setBuffer(t._roots[e]);const o=Bn(0,t.geometry,s,i,n,r);wn.clearBuffer(),An.releasePrimitive(vn),An.releasePrimitive(Mn),Sn.pop(),Sn.pop();const a=Sn.length;return a>0&&(Mn=Sn[a-1],vn=Sn[a-2]),o}function Bn(t,e,s,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:h,uint32Array:l}=wn;let c=2*t;if(mn(c,h)){const e=bn(t,l),s=yn(c,h);return qi(t,a,vn),i(e,s,!1,o,r+t,vn)}{let c=function(t){const{uint16Array:e,uint32Array:s}=wn;let i=2*t;for(;!mn(i,e);)i=2*(t=gn(t));return bn(t,s)},u=function(t){const{uint16Array:e,uint32Array:s}=wn;let i=2*t;for(;!mn(i,e);)i=2*(t=xn(t,s));return bn(t,s)+yn(i,e)};const d=gn(t),p=xn(t,l);let f,m,b,y,g=d,x=p;if(n&&(b=vn,y=Mn,qi(g,a,b),qi(x,a,y),f=n(b),m=n(y),m<f)){g=p,x=d;const t=f;f=m,m=t,b=y}b||(b=vn,qi(g,a,b));const _=s(b,mn(2*g,h),f,o+1,r+g);let w;if(2===_){const t=c(g);w=i(t,u(g)-t,!0,o+1,r+g,b)}else w=_&&Bn(g,e,s,i,n,r,o+1);if(w)return!0;y=Mn,qi(x,a,y);const v=s(y,mn(2*x,h),m,o+1,r+x);let M;if(2===v){const t=c(x);M=i(t,u(x)-t,!0,o+1,r+x,y)}else M=v&&Bn(x,e,s,i,n,r,o+1);return!!M}}const Tn=new Jt,zn=new Jt;const Cn=new Jt,Pn=new Jt,Fn=new Jt,Ln=new zt,kn=new zt,On=new zt,Vn=new Jt,En=new Jt,Rn=new Jt,Dn=new Jt;function Un(t,e,s,i,n){const r=3*i;let o=r+0,a=r+1,h=r+2;const l=t.index;t.index&&(o=l.getX(o),a=l.getX(a),h=l.getX(h));const{position:c,normal:u,uv:d,uv1:p}=t.attributes,f=function(t,e,s,i,n,r,o,a,h){Cn.fromBufferAttribute(e,r),Pn.fromBufferAttribute(e,o),Fn.fromBufferAttribute(e,a);const l=function(t,e,s,i,n,r){let o;return o=1===r?t.intersectTriangle(i,s,e,!0,n):t.intersectTriangle(e,s,i,2!==r,n),null===o?null:{distance:t.origin.distanceTo(n),point:n.clone()}}(t,Cn,Pn,Fn,Dn,h);if(l){i&&(Ln.fromBufferAttribute(i,r),kn.fromBufferAttribute(i,o),On.fromBufferAttribute(i,a),l.uv=ps.getInterpolation(Dn,Cn,Pn,Fn,Ln,kn,On,new zt)),n&&(Ln.fromBufferAttribute(n,r),kn.fromBufferAttribute(n,o),On.fromBufferAttribute(n,a),l.uv1=ps.getInterpolation(Dn,Cn,Pn,Fn,Ln,kn,On,new zt)),s&&(Vn.fromBufferAttribute(s,r),En.fromBufferAttribute(s,o),Rn.fromBufferAttribute(s,a),l.normal=ps.getInterpolation(Dn,Cn,Pn,Fn,Vn,En,Rn,new Jt),l.normal.dot(t.direction)>0&&l.normal.multiplyScalar(-1));const e={a:r,b:o,c:a,normal:new Jt,materialIndex:0};ps.getNormal(Cn,Pn,Fn,e.normal),l.face=e,l.faceIndex=r}return l}(s,c,u,d,p,o,a,h,e);return f?(f.faceIndex=i,n&&n.push(f),f):null}function Nn(t,e,s,i){const n=t.a,r=t.b,o=t.c;let a=e,h=e+1,l=e+2;s&&(a=s.getX(a),h=s.getX(h),l=s.getX(l)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(h),r.y=i.getY(h),r.z=i.getZ(h),o.x=i.getX(l),o.y=i.getY(l),o.z=i.getZ(l)}function qn(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,l=a.attributes.position;for(let s=t,a=e+t;s<a;s++){let t;if(t=s,Nn(o,3*t,h,l),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}function Gn(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,l=0;const c=t._roots;for(let t=0,e=c.length;t<e;t++)r=c[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,l),l+=r.byteLength;function u(t,s,r=!1){const l=2*t;if(a[l+15]===Oi){const e=o[t+6];let s=1/0,r=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,o=3*(e+a[l+14]);t<o;t++){let e=i[t];const o=n.getX(e),a=n.getY(e),h=n.getZ(e);o<s&&(s=o),o>u&&(u=o),a<r&&(r=a),a>d&&(d=a),h<c&&(c=h),h>p&&(p=h)}return(h[t+0]!==s||h[t+1]!==r||h[t+2]!==c||h[t+3]!==u||h[t+4]!==d||h[t+5]!==p)&&(h[t+0]=s,h[t+1]=r,h[t+2]=c,h[t+3]=u,h[t+4]=d,h[t+5]=p,!0)}{const i=t+8,n=o[t+6],a=i+s,l=n+s;let c=r,d=!1,p=!1;e?c||(d=e.has(a),p=e.has(l),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(i,s,c));let b=!1;f&&(b=u(n,s,c));const y=m||b;if(y)for(let e=0;e<3;e++){const s=i+e,r=n+e,o=h[s],a=h[s+3],l=h[r],c=h[r+3];h[t+e]=o<l?o:l,h[t+e+3]=a>c?a:c}return y}}}const Wn=new Kt;function Hn(t,e,s,i){return qi(t,e,Wn),s.intersectBox(Wn,i)}function jn(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,l=a.attributes.position;for(let a=t,c=e+t;a<c;a++){let t;if(t=s.resolveTriangleIndex(a),Nn(o,3*t,h,l),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}const Zn=new Jt;function Yn(t,e,s,i,n){wn.setBuffer(t._roots[e]),Xn(0,t,s,i,n),wn.clearBuffer()}function Xn(t,e,s,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=wn,h=2*t;if(mn(h,o)){!function(t,e,s,i,n,r){const{geometry:o,_indirectBuffer:a}=t;for(let t=i,a=i+n;t<a;t++)Un(o,e,s,t,r)}(e,s,i,bn(t,a),yn(h,o),n)}else{const o=gn(t);Hn(o,r,i,Zn)&&Xn(o,e,s,i,n);const h=xn(t,a);Hn(h,r,i,Zn)&&Xn(h,e,s,i,n)}}const Jn=new Jt,Qn=["x","y","z"];function $n(t,e,s,i){wn.setBuffer(t._roots[e]);const n=Kn(0,t,s,i);return wn.clearBuffer(),n}function Kn(t,e,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=wn;let a=2*t;if(mn(a,r)){return function(t,e,s,i,n){const{geometry:r,_indirectBuffer:o}=t;let a=1/0,h=null;for(let t=i,o=i+n;t<o;t++){let i;i=Un(r,e,s,t),i&&i.distance<a&&(h=i,a=i.distance)}return h}(e,s,i,bn(t,o),yn(a,r))}{const r=_n(t,o),a=Qn[r],h=i.direction[a]>=0;let l,c;h?(l=gn(t),c=xn(t,o)):(l=xn(t,o),c=gn(t));const u=Hn(l,n,i,Jn)?Kn(l,e,s,i):null;if(u){const t=u.point[a];if(h?t<=n[c+r]:t>=n[c+r+3])return u}const d=Hn(c,n,i,Jn)?Kn(c,e,s,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const tr=new Kt,er=new cn,sr=new cn,ir=new Ie,nr=new un,rr=new un;function or(t,e,s,i){wn.setBuffer(t._roots[e]);const n=ar(0,t,s,i);return wn.clearBuffer(),n}function ar(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=wn;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),nr.set(s.boundingBox.min,s.boundingBox.max,i),n=nr);if(!mn(h,o)){const o=t+8,h=a[t+6];qi(o,r,tr);if(n.intersectsBox(tr)&&ar(o,e,s,i,n))return!0;qi(h,r,tr);return!!(n.intersectsBox(tr)&&ar(h,e,s,i,n))}{const n=e.geometry,l=n.index,c=n.attributes.position,u=s.index,d=s.attributes.position,p=bn(t,a),f=yn(h,o);if(ir.copy(i).invert(),s.boundsTree){qi(t,r,rr),rr.matrix.copy(ir),rr.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>rr.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let e=3*p,s=3*(f+p);e<s;e+=3)if(Nn(sr,e,l,c),sr.needsUpdate=!0,t.intersectsTriangle(sr))return!0;return!1}})}for(let t=3*p,e=3*(f+p);t<e;t+=3){Nn(er,t,l,c),er.a.applyMatrix4(ir),er.b.applyMatrix4(ir),er.c.applyMatrix4(ir),er.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(Nn(sr,t,u,d),sr.needsUpdate=!0,er.intersectsTriangle(sr))return!0}}}const hr=new Ie,lr=new un,cr=new un,ur=new Jt,dr=new Jt,pr=new Jt,fr=new Jt;function mr(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),lr.set(e.boundingBox.min,e.boundingBox.max,s),lr.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,d=fn.getPrimitive(),p=fn.getPrimitive();let f=ur,m=dr,b=null,y=null;n&&(b=pr,y=fr);let g=1/0,x=null,_=null;return hr.copy(s).invert(),cr.matrix.copy(hr),t.shapecast({boundsTraverseOrder:t=>lr.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o&&(e&&(cr.min.copy(t.min),cr.max.copy(t.max),cr.needsUpdate=!0),!0),intersectsRange:(t,i)=>{if(e.boundsTree){return e.boundsTree.shapecast({boundsTraverseOrder:t=>cr.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o,intersectsRange:(e,n)=>{for(let o=e,a=e+n;o<a;o++){Nn(p,3*o,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){Nn(d,3*e,l,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,b);if(t<g&&(m.copy(f),y&&y.copy(b),g=t,x=e,_=o),t<r)return!0}}}})}for(let n=0,o=Ri(e);n<o;n++){Nn(p,3*n,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){Nn(d,3*e,l,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,b);if(t<g&&(m.copy(f),y&&y.copy(b),g=t,x=e,_=n),t<r)return!0}}}}),fn.releasePrimitive(d),fn.releasePrimitive(p),g===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=g,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(hr),m.applyMatrix4(hr),n.distance=m.sub(n.point).length(),n.faceIndex=_),i)}function br(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,l=0;const c=t._roots;for(let t=0,e=c.length;t<e;t++)r=c[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,l),l+=r.byteLength;function u(s,r,l=!1){const c=2*s;if(a[c+15]===Oi){const e=o[s+6];let r=1/0,l=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0;for(let s=e,o=e+a[c+14];s<o;s++){const e=3*t.resolveTriangleIndex(s);for(let t=0;t<3;t++){let s=e+t;s=i?i[s]:s;const o=n.getX(s),a=n.getY(s),h=n.getZ(s);o<r&&(r=o),o>d&&(d=o),a<l&&(l=a),a>p&&(p=a),h<u&&(u=h),h>f&&(f=h)}}return(h[s+0]!==r||h[s+1]!==l||h[s+2]!==u||h[s+3]!==d||h[s+4]!==p||h[s+5]!==f)&&(h[s+0]=r,h[s+1]=l,h[s+2]=u,h[s+3]=d,h[s+4]=p,h[s+5]=f,!0)}{const t=s+8,i=o[s+6],n=t+r,a=i+r;let c=l,d=!1,p=!1;e?c||(d=e.has(n),p=e.has(a),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(t,r,c));let b=!1;f&&(b=u(i,r,c));const y=m||b;if(y)for(let e=0;e<3;e++){const n=t+e,r=i+e,o=h[n],a=h[n+3],l=h[r],c=h[r+3];h[s+e]=o<l?o:l,h[s+e+3]=a>c?a:c}return y}}}const yr=new Jt;function gr(t,e,s,i,n){wn.setBuffer(t._roots[e]),xr(0,t,s,i,n),wn.clearBuffer()}function xr(t,e,s,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=wn,h=2*t;if(mn(h,o)){!function(t,e,s,i,n,r){const{geometry:o,_indirectBuffer:a}=t;for(let t=i,h=i+n;t<h;t++)Un(o,e,s,a?a[t]:t,r)}(e,s,i,bn(t,a),yn(h,o),n)}else{const o=gn(t);Hn(o,r,i,yr)&&xr(o,e,s,i,n);const h=xn(t,a);Hn(h,r,i,yr)&&xr(h,e,s,i,n)}}const _r=new Jt,wr=["x","y","z"];function vr(t,e,s,i){wn.setBuffer(t._roots[e]);const n=Mr(0,t,s,i);return wn.clearBuffer(),n}function Mr(t,e,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=wn;let a=2*t;if(mn(a,r)){return function(t,e,s,i,n){const{geometry:r,_indirectBuffer:o}=t;let a=1/0,h=null;for(let t=i,l=i+n;t<l;t++){let i;i=Un(r,e,s,o?o[t]:t),i&&i.distance<a&&(h=i,a=i.distance)}return h}(e,s,i,bn(t,o),yn(a,r))}{const r=_n(t,o),a=wr[r],h=i.direction[a]>=0;let l,c;h?(l=gn(t),c=xn(t,o)):(l=xn(t,o),c=gn(t));const u=Hn(l,n,i,_r)?Mr(l,e,s,i):null;if(u){const t=u.point[a];if(h?t<=n[c+r]:t>=n[c+r+3])return u}const d=Hn(c,n,i,_r)?Mr(c,e,s,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const Sr=new Kt,Ar=new cn,Ir=new cn,Br=new Ie,Tr=new un,zr=new un;function Cr(t,e,s,i){wn.setBuffer(t._roots[e]);const n=Pr(0,t,s,i);return wn.clearBuffer(),n}function Pr(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=wn;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),Tr.set(s.boundingBox.min,s.boundingBox.max,i),n=Tr);if(!mn(h,o)){const o=t+8,h=a[t+6];qi(o,r,Sr);if(n.intersectsBox(Sr)&&Pr(o,e,s,i,n))return!0;qi(h,r,Sr);return!!(n.intersectsBox(Sr)&&Pr(h,e,s,i,n))}{const n=e.geometry,l=n.index,c=n.attributes.position,u=s.index,d=s.attributes.position,p=bn(t,a),f=yn(h,o);if(Br.copy(i).invert(),s.boundsTree){qi(t,r,zr),zr.matrix.copy(Br),zr.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>zr.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let s=p,i=f+p;s<i;s++)if(Nn(Ir,3*e.resolveTriangleIndex(s),l,c),Ir.needsUpdate=!0,t.intersectsTriangle(Ir))return!0;return!1}})}for(let t=p,s=f+p;t<s;t++){const s=e.resolveTriangleIndex(t);Nn(Ar,3*s,l,c),Ar.a.applyMatrix4(Br),Ar.b.applyMatrix4(Br),Ar.c.applyMatrix4(Br),Ar.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(Nn(Ir,t,u,d),Ir.needsUpdate=!0,Ar.intersectsTriangle(Ir))return!0}}}const Fr=new Ie,Lr=new un,kr=new un,Or=new Jt,Vr=new Jt,Er=new Jt,Rr=new Jt;function Dr(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Lr.set(e.boundingBox.min,e.boundingBox.max,s),Lr.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,d=fn.getPrimitive(),p=fn.getPrimitive();let f=Or,m=Vr,b=null,y=null;n&&(b=Er,y=Rr);let g=1/0,x=null,_=null;return Fr.copy(s).invert(),kr.matrix.copy(Fr),t.shapecast({boundsTraverseOrder:t=>Lr.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o&&(e&&(kr.min.copy(t.min),kr.max.copy(t.max),kr.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(e.boundsTree){const a=e.boundsTree;return a.shapecast({boundsTraverseOrder:t=>kr.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o,intersectsRange:(e,o)=>{for(let w=e,v=e+o;w<v;w++){const e=a.resolveTriangleIndex(w);Nn(p,3*e,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);Nn(d,3*s,l,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,b);if(i<g&&(m.copy(f),y&&y.copy(b),g=i,x=e,_=w),i<r)return!0}}}})}for(let o=0,a=Ri(e);o<a;o++){Nn(p,3*o,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);Nn(d,3*s,l,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,b);if(i<g&&(m.copy(f),y&&y.copy(b),g=i,x=e,_=o),i<r)return!0}}}}),fn.releasePrimitive(d),fn.releasePrimitive(p),g===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=g,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(Fr),m.applyMatrix4(Fr),n.distance=m.sub(n.point).length(),n.faceIndex=_),i)}const Ur=new wn.constructor,Nr=new wn.constructor,qr=new dn((()=>new Kt)),Gr=new Kt,Wr=new Kt,Hr=new Kt,jr=new Kt;let Zr=!1;function Yr(t,e,s,i,n,r=0,o=0,a=0,h=0,l=null,c=!1){let u,d;c?(u=Nr,d=Ur):(u=Ur,d=Nr);const p=u.float32Array,f=u.uint32Array,m=u.uint16Array,b=d.float32Array,y=d.uint32Array,g=d.uint16Array,x=2*e,_=mn(2*t,m),w=mn(x,g);let v=!1;if(w&&_)v=c?n(bn(e,y),yn(2*e,g),bn(t,f),yn(2*t,m),h,o+e,a,r+t):n(bn(t,f),yn(2*t,m),bn(e,y),yn(2*e,g),a,r+t,h,o+e);else if(w){const l=qr.getPrimitive();qi(e,b,l),l.applyMatrix4(s);const u=gn(t),d=xn(t,f);qi(u,p,Gr),qi(d,p,Wr);const m=l.intersectsBox(Gr),y=l.intersectsBox(Wr);v=m&&Yr(e,u,i,s,n,o,r,h,a+1,l,!c)||y&&Yr(e,d,i,s,n,o,r,h,a+1,l,!c),qr.releasePrimitive(l)}else{const u=gn(e),d=xn(e,y);qi(u,b,Hr),qi(d,b,jr);const m=l.intersectsBox(Hr),g=l.intersectsBox(jr);if(m&&g)v=Yr(t,u,s,i,n,r,o,a,h+1,l,c)||Yr(t,d,s,i,n,r,o,a,h+1,l,c);else if(m)if(_)v=Yr(t,u,s,i,n,r,o,a,h+1,l,c);else{const e=qr.getPrimitive();e.copy(Hr).applyMatrix4(s);const l=gn(t),d=xn(t,f);qi(l,p,Gr),qi(d,p,Wr);const m=e.intersectsBox(Gr),b=e.intersectsBox(Wr);v=m&&Yr(u,l,i,s,n,o,r,h,a+1,e,!c)||b&&Yr(u,d,i,s,n,o,r,h,a+1,e,!c),qr.releasePrimitive(e)}else if(g)if(_)v=Yr(t,d,s,i,n,r,o,a,h+1,l,c);else{const e=qr.getPrimitive();e.copy(jr).applyMatrix4(s);const l=gn(t),u=xn(t,f);qi(l,p,Gr),qi(u,p,Wr);const m=e.intersectsBox(Gr),b=e.intersectsBox(Wr);v=m&&Yr(d,l,i,s,n,o,r,h,a+1,e,!c)||b&&Yr(d,u,i,s,n,o,r,h,a+1,e,!c),qr.releasePrimitive(e)}}return v}const Xr=new un,Jr=new Kt;class Qr{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,n=t._indirectBuffer,r=s.getIndex();let o;return o=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:r.array.slice(),indirectBuffer:n?n.slice():null}:{roots:i,index:r.array,indirectBuffer:n},o}static deserialize(t,e,s={}){s={setIndex:!0,indirect:Boolean(t.indirectBuffer),...s};const{index:i,roots:n,indirectBuffer:r}=t,o=new Qr(e,{...s,[Ei]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const s=e.getIndex();if(null===s){const s=new As(t.index,1,!1);e.setIndex(s)}else s.array!==i&&(s.array.set(i),s.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ei]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Ei]||(nn(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Kt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?t=>s[t]:t=>t}refit(t=null){return(this.indirect?br:Gn)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),n=new Uint16Array(s);!function e(r,o=0){const a=2*r,h=n[a+15]===Oi;if(h){const e=i[r+6],l=n[a+14];t(o,h,new Float32Array(s,4*r,6),e,l)}else{const n=r+8,a=i[r+6],l=i[r+7];t(o,h,new Float32Array(s,4*r,6),l)||(e(n,o+1),e(a,o+1))}}(0)}raycast(t,e=0){const s=this._roots,i=this.geometry,n=[],r=e.isMaterial,o=Array.isArray(e),a=i.groups,h=r?e.side:e,l=this.indirect?gr:Yn;for(let i=0,r=s.length;i<r;i++){const s=o?e[a[i].materialIndex].side:h,r=n.length;if(l(this,i,s,t,n),o){const t=a[i].materialIndex;for(let e=r,s=n.length;e<s;e++)n[e].face.materialIndex=t}}return n}raycastFirst(t,e=0){const s=this._roots,i=this.geometry,n=e.isMaterial,r=Array.isArray(e);let o=null;const a=i.groups,h=n?e.side:e,l=this.indirect?vr:$n;for(let i=0,n=s.length;i<n;i++){const s=l(this,i,r?e[a[i].materialIndex].side:h,t);null!=s&&(null==o||s.distance<o.distance)&&(o=s,r&&(s.face.materialIndex=a[i].materialIndex))}return o}intersectsGeometry(t,e){let s=!1;const i=this._roots,n=this.indirect?Cr:or;for(let r=0,o=i.length;r<o&&(s=n(this,r,t,e),!s);r++);return s}shapecast(t){const e=fn.getPrimitive(),s=this.indirect?jn:qn;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=t;if(r&&o){const t=r;r=(i,n,r,a,h)=>!!t(i,n,r,a,h)||s(i,n,this,o,r,a,e)}else r||(r=o?(t,i,n,r)=>s(t,i,this,o,n,r,e):(t,e,s)=>s);let a=!1,h=0;const l=this._roots;for(let t=0,e=l.length;t<e;t++){const e=l[t];if(a=In(this,t,n,r,i,h),a)break;h+=e.byteLength}return fn.releasePrimitive(e),a}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=fn.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?t=>{const e=this.resolveTriangleIndex(t);Nn(r,3*e,o,a)}:t=>{Nn(r,3*t,o,a)},l=fn.getPrimitive(),c=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?e=>{const s=t.resolveTriangleIndex(e);Nn(l,3*s,c,u)}:t=>{Nn(l,3*t,c,u)};if(n){const t=(t,s,i,o,a,c,u,p)=>{for(let f=i,m=i+o;f<m;f++){d(f),l.a.applyMatrix4(e),l.b.applyMatrix4(e),l.c.applyMatrix4(e),l.needsUpdate=!0;for(let e=t,i=t+s;e<i;e++)if(h(e),r.needsUpdate=!0,n(r,l,e,f,a,c,u,p))return!0}return!1};if(i){const e=i;i=function(s,i,n,r,o,a,h,l){return!!e(s,i,n,r,o,a,h,l)||t(s,i,n,r,o,a,h,l)}}else i=t}return function(t,e,s,i){if(Zr)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Zr=!0;const n=t._roots,r=e._roots;let o,a=0,h=0;const l=(new Ie).copy(s).invert();for(let t=0,e=n.length;t<e;t++){Ur.setBuffer(n[t]),h=0;const e=qr.getPrimitive();qi(0,Ur.float32Array,e),e.applyMatrix4(l);for(let n=0,c=r.length;n<c&&(Nr.setBuffer(r[t]),o=Yr(0,0,s,l,i,a,h,0,0,e),Nr.clearBuffer(),h+=r[n].length,!o);n++);if(qr.releasePrimitive(e),Ur.clearBuffer(),a+=n[t].length,o)break}return Zr=!1,o}(this,t,e,i)}intersectsBox(t,e){return Xr.set(t.min,t.max,e),Xr.needsUpdate=!0,this.shapecast({intersectsBounds:t=>Xr.intersectsBox(t),intersectsTriangle:t=>Xr.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},n=0,r=1/0){return(this.indirect?Dr:mr)(this,t,e,s,i,n,r)}closestPointToPoint(t,e={},s=0,i=1/0){return function(t,e,s={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,h=null;if(t.shapecast({boundsTraverseOrder:t=>(Tn.copy(e).clamp(t.min,t.max),Tn.distanceToSquared(e)),intersectsBounds:(t,e,s)=>s<a&&s<o,intersectsTriangle:(t,s)=>{t.closestPointToPoint(e,Tn);const i=e.distanceToSquared(Tn);return i<a&&(zn.copy(Tn),a=i,h=s),i<r}}),a===1/0)return null;const l=Math.sqrt(a);return s.point?s.point.copy(zn):s.point=zn.clone(),s.distance=l,s.faceIndex=h,s}(this,t,e,s,i)}getBoundingBox(t){t.makeEmpty();return this._roots.forEach((e=>{qi(0,new Float32Array(e),Jr),t.union(Jr)})),t}}function $r(t,e,s){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(s.ray.origin),t.object=e,t.distance<s.near||t.distance>s.far?null:t)}const Kr=new Ae,to=new Ie,eo=Ys.prototype.raycast;function so(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;to.copy(this.matrixWorld).invert(),Kr.copy(t.ray).applyMatrix4(to);const s=this.geometry.boundsTree;if(!0===t.firstHitOnly){const i=$r(s.raycastFirst(Kr,this.material),this,t);i&&e.push(i)}else{const i=s.raycast(Kr,this.material);for(let s=0,n=i.length;s<n;s++){const n=$r(i[s],this,t);n&&e.push(n)}}}else eo.call(this,t,e)}function io(t){return this.boundsTree=new Qr(this,t),this.boundsTree}function no(){this.boundsTree=null}const ro=class t{static transform(t,e,s=new si){for(let i=0;i<s.planes.length;i++)s.planes[i].copy(t.planes[i]).applyMatrix4(e);return s}static isHitting(e,s){return t.hits(e,s,!1)}static isIncluded(e,s){return t.hits(e,s,!0)}static containedInIndependentPlanes(t,e){let s=!0;for(const i of e)s=s&&i.distanceToPoint(t)>=0;return s}};nt(ro,"hits",(()=>{const t=new Jt;return(e,s,i)=>{for(let n=0,r=e.length;n<r;n++){const r=e[n].normal;if(t.set(r.x>=0!==i?s.max.x:s.min.x,r.y>=0!==i?s.max.y:s.min.y,r.z>=0!==i?s.max.z:s.min.z),e[n].distanceToPoint(t)<0)return!1}return!0}})());let oo=ro;function ao(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ho={exports:{}};function lo(t,e,s){s=s||2;var i,n,r,o,a,h,l,c=e&&e.length,u=c?e[0]*s:t.length,d=co(t,0,u,s,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(t,e,s,i){var n,r,o,a=[];for(n=0,r=e.length;n<r;n++)(o=co(t,e[n]*i,n<r-1?e[n+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),a.push(vo(o));for(a.sort(go),n=0;n<a.length;n++)s=xo(a[n],s);return s}(t,e,d,s)),t.length>80*s){i=r=t[0],n=o=t[1];for(var f=s;f<u;f+=s)(a=t[f])<i&&(i=a),(h=t[f+1])<n&&(n=h),a>r&&(r=a),h>o&&(o=h);l=0!==(l=Math.max(r-i,o-n))?32767/l:0}return po(d,p,s,i,n,l,0),p}function co(t,e,s,i,n){var r,o;if(n===Oo(t,e,s,i)>0)for(r=e;r<s;r+=i)o=Fo(r,t[r],t[r+1],o);else for(r=s-i;r>=e;r-=i)o=Fo(r,t[r],t[r+1],o);return o&&Io(o,o.next)&&(Lo(o),o=o.next),o}function uo(t,e){if(!t)return t;e||(e=t);var s,i=t;do{if(s=!1,i.steiner||!Io(i,i.next)&&0!==Ao(i.prev,i,i.next))i=i.next;else{if(Lo(i),(i=e=i.prev)===i.next)break;s=!0}}while(s||i!==e);return e}function po(t,e,s,i,n,r,o){if(t){!o&&r&&function(t,e,s,i){var n=t;do{0===n.z&&(n.z=wo(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,o,a,h,l=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,i=s,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,a--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,r);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?mo(t,i,n,r):fo(t))e.push(a.i/s|0),e.push(t.i/s|0),e.push(h.i/s|0),Lo(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?po(t=bo(uo(t),e,s),e,s,i,n,r,2):2===o&&yo(t,e,s,i,n,r):po(uo(t),e,s,i,n,r,1);break}}}function fo(t){var e=t.prev,s=t,i=t.next;if(Ao(e,s,i)>=0)return!1;for(var n=e.x,r=s.x,o=i.x,a=e.y,h=s.y,l=i.y,c=n<r?n<o?n:o:r<o?r:o,u=a<h?a<l?a:l:h<l?h:l,d=n>r?n>o?n:o:r>o?r:o,p=a>h?a>l?a:l:h>l?h:l,f=i.next;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Mo(n,a,r,h,o,l,f.x,f.y)&&Ao(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function mo(t,e,s,i){var n=t.prev,r=t,o=t.next;if(Ao(n,r,o)>=0)return!1;for(var a=n.x,h=r.x,l=o.x,c=n.y,u=r.y,d=o.y,p=a<h?a<l?a:l:h<l?h:l,f=c<u?c<d?c:d:u<d?u:d,m=a>h?a>l?a:l:h>l?h:l,b=c>u?c>d?c:d:u>d?u:d,y=wo(p,f,e,s,i),g=wo(m,b,e,s,i),x=t.prevZ,_=t.nextZ;x&&x.z>=y&&_&&_.z<=g;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=b&&x!==n&&x!==o&&Mo(a,c,h,u,l,d,x.x,x.y)&&Ao(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==n&&_!==o&&Mo(a,c,h,u,l,d,_.x,_.y)&&Ao(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=b&&x!==n&&x!==o&&Mo(a,c,h,u,l,d,x.x,x.y)&&Ao(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=g;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==n&&_!==o&&Mo(a,c,h,u,l,d,_.x,_.y)&&Ao(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function bo(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!Io(n,r)&&Bo(n,i,i.next,r)&&Co(n,r)&&Co(r,n)&&(e.push(n.i/s|0),e.push(i.i/s|0),e.push(r.i/s|0),Lo(i),Lo(i.next),i=t=r),i=i.next}while(i!==t);return uo(i)}function yo(t,e,s,i,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&So(o,a)){var h=Po(o,a);return o=uo(o,o.next),h=uo(h,h.next),po(o,e,s,i,n,r,0),void po(h,e,s,i,n,r,0)}a=a.next}o=o.next}while(o!==t)}function go(t,e){return t.x-e.x}function xo(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o&&(o=a,s=i.x<i.next.x?i:i.next,a===n))return s}i=i.next}while(i!==e);if(!s)return null;var h,l=s,c=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=c&&n!==i.x&&Mo(r<u?n:o,r,c,u,r<u?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),Co(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&_o(s,i)))&&(s=i,d=h)),i=i.next}while(i!==l);return s}(t,e);if(!s)return e;var i=Po(s,t);return uo(i,i.next),uo(s,s.next)}function _o(t,e){return Ao(t.prev,t,e.prev)<0&&Ao(e.next,t,t.next)<0}function wo(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vo(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function Mo(t,e,s,i,n,r,o,a){return(n-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(i-a)>=(s-o)*(e-a)&&(s-o)*(r-a)>=(n-o)*(i-a)}function So(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&Bo(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(Co(t,e)&&Co(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(Ao(t.prev,t,e.prev)||Ao(t,e.prev,e))||Io(t,e)&&Ao(t.prev,t,t.next)>0&&Ao(e.prev,e,e.next)>0)}function Ao(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function Io(t,e){return t.x===e.x&&t.y===e.y}function Bo(t,e,s,i){var n=zo(Ao(t,e,s)),r=zo(Ao(t,e,i)),o=zo(Ao(s,i,t)),a=zo(Ao(s,i,e));return n!==r&&o!==a||(!(0!==n||!To(t,s,e))||(!(0!==r||!To(t,i,e))||(!(0!==o||!To(s,t,i))||!(0!==a||!To(s,e,i)))))}function To(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function zo(t){return t>0?1:t<0?-1:0}function Co(t,e){return Ao(t.prev,t,t.next)<0?Ao(t,e,t.next)>=0&&Ao(t,t.prev,e)>=0:Ao(t,e,t.prev)<0||Ao(t,t.next,e)<0}function Po(t,e){var s=new ko(t.i,t.x,t.y),i=new ko(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function Fo(t,e,s,i){var n=new ko(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Lo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ko(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Oo(t,e,s,i){for(var n=0,r=e,o=s-i;r<s;r+=i)n+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return n}ho.exports=lo,ho.exports.default=lo,lo.deviation=function(t,e,s,i){var n=e&&e.length,r=n?e[0]*s:t.length,o=Math.abs(Oo(t,0,r,s));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*s,c=a<h-1?e[a+1]*s:t.length;o-=Math.abs(Oo(t,l,c,s))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*s,p=i[a+1]*s,f=i[a+2]*s;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},lo.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++)for(var o=0;o<e;o++)s.vertices.push(t[n][r][o]);n>0&&(i+=t[n-1].length,s.holes.push(i))}return s};const Vo=ao(ho.exports);class Eo{constructor(){nt(this,"_inverseMatrix",new Ie),nt(this,"_localPlane",new Ks),nt(this,"_tempLine",new gi),nt(this,"_tempVector",new Jt),nt(this,"_plane"),nt(this,"_plane2DCoordinateSystem",new Ie),nt(this,"_precission",1e4),nt(this,"_planeAxis")}get plane(){if(!this._plane)throw new Error("Plane not set");return this._plane}set plane(t){this._plane=t}createEdges(t){const{meshes:e,posAttr:s}=t;let i=0;s.array.fill(0);const n=[];let r=0;const o=new Ys;for(const t of e)if(t.geometry){if(t.geometry.boundsTree||t.geometry.computeBoundsTree(),!t.geometry.boundsTree)throw new Error("Bounds tree not found for edges generation.");if(t instanceof di){if(0===t.count)continue;const e=t;for(let a=0;a<e.count;a++){o.geometry=t.geometry,o.matrix.copy(t.matrix);const h=new Ie;e.getMatrixAt(a,h),o.applyMatrix4(h),o.applyMatrix4(t.matrixWorld),o.updateMatrix(),o.updateMatrixWorld(),this._inverseMatrix.copy(o.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(o,s,i),i!==r&&(n.push(i),r=i)}}else this._inverseMatrix.copy(t.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(t,s,i),i!==r&&(n.push(i),r=i)}return{indexes:n,index:i}}createFills(t,e){this.updatePlane2DCoordinateSystem();const s=[];let i=0;for(let n=0;n<e.length;n++){const r=e[n],o=[];for(let t=i;t<r;t+=2)o.push(3*t);const a=this.computeFill(o,t);for(const t of a)s.push(t);i=r}return s}computeFill(t,e){const s=new Map,i={},n=new Map;let r=0;const o=new Map,a=new Map,h=new Set,l=this._precission;for(let c=0;c<t.length;c++){const u=t[c];let d=0,p=0,f=0,m=0;const b=e[u],y=e[u+1],g=e[u+2],x=e[u+3],_=e[u+4],w=e[u+5];if(this._tempVector.set(b,y,g),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),d=Math.trunc(this._tempVector.x*l)/l,p=Math.trunc(this._tempVector.y*l)/l,this._tempVector.set(x,_,w),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),f=Math.trunc(this._tempVector.x*l)/l,m=Math.trunc(this._tempVector.y*l)/l,d===f&&p===m)continue;const v=`${d}|${p}`,M=`${f}|${m}`;s.has(v)||s.set(v,u/3),s.has(M)||s.set(M,u/3+1);const S=s.get(v),A=s.get(M);i[S]=[d,p],i[A]=[f,m];const I=a.has(S),B=o.has(S),T=a.has(A),z=o.has(A);if(!(I||B||T||z))a.set(S,r),o.set(A,r),h.add(r),n.set(r,[S,A]),r++;else if(I&&z){const t=a.get(S),e=o.get(A);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(S),o.delete(A)}else if(B&&T){const t=a.get(A),e=o.get(S);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(A),o.delete(S)}else if(I&&T){const t=a.get(A),e=a.get(S),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),a.delete(s[0]),a.delete(i[0]),o.delete(i[i.length-1]),a.set(i[i.length-1],e),i.reverse(),s.splice(0,0,...i)}else if(B&&z){const t=o.get(A),e=o.get(S),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.delete(s[s.length-1]),o.delete(i[i.length-1]),a.delete(i[0]),o.set(i[0],e),i.reverse(),s.push(...i)}else if(I){const t=a.get(S),e=n.get(t);if(!e)continue;e.unshift(A),a.delete(S),a.set(A,t)}else if(B){const t=o.get(S),e=n.get(t);if(!e)continue;e.push(A),o.delete(S),o.set(A,t)}else if(T){const t=a.get(A),e=n.get(t);if(!e)continue;e.unshift(S),a.delete(A),a.set(S,t)}else if(z){const t=o.get(A),e=n.get(t);if(!e)continue;e.push(S),o.delete(A),o.set(S,t)}}const c=[];for(const[t,e]of n){if(h.has(t))continue;const s=[],n=new Map;let r=0;for(const t of e){const e=i[t];s.push(e[0],e[1]),n.set(r++,t)}const o=Vo(s);for(const t of o){const e=n.get(t);if(void 0===e)throw new Error("Map error!");c.push(e)}}return c}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new Ie;const t=new Jt(1,0,0),e=new Jt(0,1,0),s=this.plane.normal,i=new Jt;this.plane.coplanarPoint(i),"x"===this._planeAxis?t.crossVectors(e,s):"y"===this._planeAxis?e.crossVectors(s,t):"z"===this._planeAxis||(t.crossVectors(e,s).normalize(),e.crossVectors(s,t)),this._plane2DCoordinateSystem.fromArray([t.x,t.y,t.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,1]),this._plane2DCoordinateSystem.invert()}shapecast(t,e,s){return t.geometry.boundsTree.shapecast({intersectsBounds:t=>this._localPlane.intersectsBox(t),intersectsTriangle:i=>{let n=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}2!==n&&(s-=n)}}),s}}class Ro{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}mutate_x(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}y(){return this.bb.readFloat32(this.bb_pos+4)}mutate_y(t){return this.bb.writeFloat32(this.bb_pos+4,t),!0}z(){return this.bb.readFloat32(this.bb_pos+8)}mutate_z(t){return this.bb.writeFloat32(this.bb_pos+8,t),!0}static sizeOf(){return 12}static createVecf(t,e,s,i){return t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}let Do=class{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}min(t){return(t||new Ro).__init(this.bb_pos,this.bb)}max(t){return(t||new Ro).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createAABB(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}};class Uo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}center(t){return(t||new Ro).__init(this.bb_pos,this.bb)}axis(t){return(t||new Ro).__init(this.bb_pos+12,this.bb)}refDirection(t){return(t||new Ro).__init(this.bb_pos+24,this.bb)}radius(){return this.bb.readFloat32(this.bb_pos+36)}mutate_radius(t){return this.bb.writeFloat32(this.bb_pos+36,t),!0}angle(){return this.bb.readFloat32(this.bb_pos+40)}mutate_angle(t){return this.bb.writeFloat32(this.bb_pos+40,t),!0}static sizeOf(){return 44}static createArc(t,e,s,i,n,r,o,a,h,l,c,u){return t.prep(4,44),t.writeFloat32(u),t.writeFloat32(c),t.prep(4,12),t.writeFloat32(l),t.writeFloat32(h),t.writeFloat32(a),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class No{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new No).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+4),(e||new No).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endAttribute(t){const e=t.endObject();return t.requiredField(e,4),e}static createAttribute(t,e){return No.startAttribute(t),No.addData(t,e),No.endAttribute(t)}}class qo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}start(t){return(t||new Ro).__init(this.bb_pos,this.bb)}end(t){return(t||new Ro).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createLine(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class Go{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsPolyline(t,e){return(e||new Go).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsPolyline(t,e){return t.setPosition(t.position()+4),(e||new Go).__init(t.readInt32(t.position())+t.position(),t)}points(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Ro).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}pointsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startPolyline(t){t.startObject(1)}static addPoints(t,e){t.addFieldOffset(0,e,0)}static startPointsVector(t,e){t.startVector(12,e,4)}static endPolyline(t){return t.endObject()}static createPolyline(t,e){return Go.startPolyline(t),Go.addPoints(t,e),Go.endPolyline(t)}}class Wo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAxis(t,e){return(e||new Wo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAxis(t,e){return t.setPosition(t.position()+4),(e||new Wo).__init(t.readInt32(t.position())+t.position(),t)}types(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t):0}typesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}typesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}indexes(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indexesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}indexesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}lines(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new qo).__init(this.bb.__vector(this.bb_pos+s)+24*t,this.bb):null}linesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}polyLines(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new Go).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}polyLinesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}arcs(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Uo).__init(this.bb.__vector(this.bb_pos+s)+44*t,this.bb):null}arcsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAxis(t){t.startObject(5)}static addTypes(t,e){t.addFieldOffset(0,e,0)}static createTypesVector(t,e){t.startVector(1,e.length,1);for(let s=e.length-1;s>=0;s--)t.addInt8(e[s]);return t.endVector()}static startTypesVector(t,e){t.startVector(1,e,1)}static addIndexes(t,e){t.addFieldOffset(1,e,0)}static createIndexesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startIndexesVector(t,e){t.startVector(4,e,4)}static addLines(t,e){t.addFieldOffset(2,e,0)}static startLinesVector(t,e){t.startVector(24,e,4)}static addPolyLines(t,e){t.addFieldOffset(3,e,0)}static createPolyLinesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startPolyLinesVector(t,e){t.startVector(4,e,4)}static addArcs(t,e){t.addFieldOffset(4,e,0)}static startArcsVector(t,e){t.startVector(44,e,4)}static endAxis(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createAxis(t,e,s,i,n,r){return Wo.startAxis(t),Wo.addTypes(t,e),Wo.addIndexes(t,s),Wo.addLines(t,i),Wo.addPolyLines(t,n),Wo.addArcs(t,r),Wo.endAxis(t)}}class Ho{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}localTransformId(){return this.bb.readUint32(this.bb_pos)}mutate_local_transform_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}itemId(){return this.bb.readUint32(this.bb_pos+4)}mutate_item_id(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}representationId(){return this.bb.readUint32(this.bb_pos+8)}mutate_representation_id(t){return this.bb.writeUint32(this.bb_pos+8,t),!0}materialId(){return this.bb.readUint32(this.bb_pos+12)}mutate_material_id(t){return this.bb.writeUint32(this.bb_pos+12,t),!0}static sizeOf(){return 16}static createInstance(t,e,s,i,n){return t.prep(4,16),t.writeInt32(n),t.writeInt32(i),t.writeInt32(s),t.writeInt32(e),t.offset()}}class jo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}r(){return this.bb.readUint8(this.bb_pos)}mutate_r(t){return this.bb.writeUint8(this.bb_pos+0,t),!0}g(){return this.bb.readUint8(this.bb_pos+1)}mutate_g(t){return this.bb.writeUint8(this.bb_pos+1,t),!0}b(){return this.bb.readUint8(this.bb_pos+2)}mutate_b(t){return this.bb.writeUint8(this.bb_pos+2,t),!0}a(){return this.bb.readUint8(this.bb_pos+3)}mutate_a(t){return this.bb.writeUint8(this.bb_pos+3,t),!0}sidedness(){return this.bb.readInt8(this.bb_pos+4)}mutate_sidedness(t){return this.bb.writeInt8(this.bb_pos+4,t),!0}lineType(){return this.bb.readInt8(this.bb_pos+5)}mutate_line_type(t){return this.bb.writeInt8(this.bb_pos+5,t),!0}static sizeOf(){return 6}static createMaterial(t,e,s,i,n,r,o){return t.prep(1,6),t.writeInt8(o),t.writeInt8(r),t.writeInt8(n),t.writeInt8(i),t.writeInt8(s),t.writeInt8(e),t.offset()}}class Zo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}type(){return this.bb.readInt8(this.bb_pos)}mutate_type(t){return this.bb.writeInt8(this.bb_pos+0,t),!0}index(){return this.bb.readUint32(this.bb_pos+4)}mutate_index(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}boundingBox(t){return(t||new Do).__init(this.bb_pos+8,this.bb)}static sizeOf(){return 32}static createRepresentation(t,e,s,i,n,r,o,a,h){return t.prep(4,32),t.prep(4,24),t.prep(4,12),t.writeFloat32(h),t.writeFloat32(a),t.writeFloat32(o),t.prep(4,12),t.writeFloat32(r),t.writeFloat32(n),t.writeFloat32(i),t.writeInt32(s),t.pad(3),t.writeInt8(e),t.offset()}}class Yo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellHole(t,e){return(e||new Yo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellHole(t,e){return t.setPosition(t.position()+4),(e||new Yo).__init(t.readInt32(t.position())+t.position(),t)}profile(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile(t){const e=this.bb.__offset(this.bb_pos,4);return 0!==e&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}indices(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellHole(t){t.startObject(2)}static addProfile(t,e){t.addFieldInt16(0,e,0)}static addIndices(t,e){t.addFieldOffset(1,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellHole(t){const e=t.endObject();return t.requiredField(e,6),e}static createShellHole(t,e,s){return Yo.startShellHole(t),Yo.addProfile(t,e),Yo.addIndices(t,s),Yo.endShellHole(t)}}class Xo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellProfile(t,e){return(e||new Xo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellProfile(t,e){return t.setPosition(t.position()+4),(e||new Xo).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellProfile(t,e){return Xo.startShellProfile(t),Xo.addIndices(t,e),Xo.endShellProfile(t)}}class Jo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShell(t,e){return(e||new Jo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShell(t,e){return t.setPosition(t.position()+4),(e||new Jo).__init(t.readInt32(t.position())+t.position(),t)}profiles(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Xo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}profilesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}holes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new Yo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}holesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}vertices(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Ro).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}verticesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startShell(t){t.startObject(3)}static addProfiles(t,e){t.addFieldOffset(0,e,0)}static createProfilesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startProfilesVector(t,e){t.startVector(4,e,4)}static addHoles(t,e){t.addFieldOffset(1,e,0)}static createHolesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startHolesVector(t,e){t.startVector(4,e,4)}static addVertices(t,e){t.addFieldOffset(2,e,0)}static startVerticesVector(t,e){t.startVector(12,e,4)}static endShell(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),e}static createShell(t,e,s,i){return Jo.startShell(t),Jo.addProfiles(t,e),Jo.addHoles(t,s),Jo.addVertices(t,i),Jo.endShell(t)}}class Qo{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSweptDisk(t,e){return(e||new Qo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSweptDisk(t,e){return t.setPosition(t.position()+4),(e||new Qo).__init(t.readInt32(t.position())+t.position(),t)}axes(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Wo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}axesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}radius(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}radiusLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}radiusArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startSweptDisk(t){t.startObject(2)}static addAxes(t,e){t.addFieldOffset(0,e,0)}static createAxesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAxesVector(t,e){t.startVector(4,e,4)}static addRadius(t,e){t.addFieldOffset(1,e,0)}static createRadiusVector(t,e){t.startVector(8,e.length,8);for(let s=e.length-1;s>=0;s--)t.addFloat64(e[s]);return t.endVector()}static startRadiusVector(t,e){t.startVector(8,e,8)}static endSweptDisk(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),e}static createSweptDisk(t,e,s){return Qo.startSweptDisk(t),Qo.addAxes(t,e),Qo.addRadius(t,s),Qo.endSweptDisk(t)}}class $o{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat64(this.bb_pos)}mutate_x(t){return this.bb.writeFloat64(this.bb_pos+0,t),!0}y(){return this.bb.readFloat64(this.bb_pos+8)}mutate_y(t){return this.bb.writeFloat64(this.bb_pos+8,t),!0}z(){return this.bb.readFloat64(this.bb_pos+16)}mutate_z(t){return this.bb.writeFloat64(this.bb_pos+16,t),!0}static sizeOf(){return 24}static createVecd(t,e,s,i){return t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class Ko{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new $o).__init(this.bb_pos,this.bb)}xAxis(t){return(t||new Ro).__init(this.bb_pos+24,this.bb)}yAxis(t){return(t||new Ro).__init(this.bb_pos+36,this.bb)}static sizeOf(){return 48}static createTransform(t,e,s,i,n,r,o,a,h,l){return t.prep(8,48),t.prep(4,12),t.writeFloat32(l),t.writeFloat32(h),t.writeFloat32(a),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class ta{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometries(t,e){return(e||new ta).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometries(t,e){return t.setPosition(t.position()+4),(e||new ta).__init(t.readInt32(t.position())+t.position(),t)}coordinates(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new Ko).__init(this.bb_pos+e,this.bb):null}localTransforms(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new Ko).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}localTransformsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}globalTransforms(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Ko).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}globalTransformsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}materials(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new jo).__init(this.bb.__vector(this.bb_pos+s)+6*t,this.bb):null}materialsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}representations(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Zo).__init(this.bb.__vector(this.bb_pos+s)+32*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}instances(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?(e||new Ho).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}instancesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}shells(t,e){const s=this.bb.__offset(this.bb_pos,16);return s?(e||new Jo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}shellsLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}sweptDisks(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new Qo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}sweptDisksLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}geometriesItems(t){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}geometriesItemsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}geometriesItemsArray(){const t=this.bb.__offset(this.bb_pos,20);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startGeometries(t){t.startObject(9)}static addCoordinates(t,e){t.addFieldStruct(0,e,0)}static addLocalTransforms(t,e){t.addFieldOffset(1,e,0)}static startLocalTransformsVector(t,e){t.startVector(48,e,8)}static addGlobalTransforms(t,e){t.addFieldOffset(2,e,0)}static startGlobalTransformsVector(t,e){t.startVector(48,e,8)}static addMaterials(t,e){t.addFieldOffset(3,e,0)}static startMaterialsVector(t,e){t.startVector(6,e,1)}static addRepresentations(t,e){t.addFieldOffset(4,e,0)}static startRepresentationsVector(t,e){t.startVector(32,e,4)}static addInstances(t,e){t.addFieldOffset(5,e,0)}static startInstancesVector(t,e){t.startVector(16,e,4)}static addShells(t,e){t.addFieldOffset(6,e,0)}static createShellsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startShellsVector(t,e){t.startVector(4,e,4)}static addSweptDisks(t,e){t.addFieldOffset(7,e,0)}static createSweptDisksVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startSweptDisksVector(t,e){t.startVector(4,e,4)}static addGeometriesItems(t,e){t.addFieldOffset(8,e,0)}static createGeometriesItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGeometriesItemsVector(t,e){t.startVector(4,e,4)}static endGeometries(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,18),t.requiredField(e,20),e}static createGeometries(t,e,s,i,n,r,o,a,h,l){return ta.startGeometries(t),ta.addCoordinates(t,e),ta.addLocalTransforms(t,s),ta.addGlobalTransforms(t,i),ta.addMaterials(t,n),ta.addRepresentations(t,r),ta.addInstances(t,o),ta.addShells(t,a),ta.addSweptDisks(t,h),ta.addGeometriesItems(t,l),ta.endGeometries(t)}}var ea=(t=>(t[t.None=0]="None",t[t.Shell=1]="Shell",t[t.SweptDisk=2]="SweptDisk",t))(ea||{});class sa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}data1(){return this.bb.readUint32(this.bb_pos)}mutate_data1(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}data2(){return this.bb.readUint16(this.bb_pos+4)}mutate_data2(t){return this.bb.writeUint16(this.bb_pos+4,t),!0}data3(){return this.bb.readUint16(this.bb_pos+6)}mutate_data3(t){return this.bb.writeUint16(this.bb_pos+6,t),!0}data41(){return this.bb.readUint8(this.bb_pos+8)}mutate_data4_1(t){return this.bb.writeUint8(this.bb_pos+8,t),!0}data42(){return this.bb.readUint8(this.bb_pos+9)}mutate_data4_2(t){return this.bb.writeUint8(this.bb_pos+9,t),!0}data43(){return this.bb.readUint8(this.bb_pos+10)}mutate_data4_3(t){return this.bb.writeUint8(this.bb_pos+10,t),!0}data44(){return this.bb.readUint8(this.bb_pos+11)}mutate_data4_4(t){return this.bb.writeUint8(this.bb_pos+11,t),!0}data45(){return this.bb.readUint8(this.bb_pos+12)}mutate_data4_5(t){return this.bb.writeUint8(this.bb_pos+12,t),!0}data46(){return this.bb.readUint8(this.bb_pos+13)}mutate_data4_6(t){return this.bb.writeUint8(this.bb_pos+13,t),!0}data47(){return this.bb.readUint8(this.bb_pos+14)}mutate_data4_7(t){return this.bb.writeUint8(this.bb_pos+14,t),!0}data48(){return this.bb.readUint8(this.bb_pos+15)}mutate_data4_8(t){return this.bb.writeUint8(this.bb_pos+15,t),!0}static sizeOf(){return 16}static createGuid(t,e,s,i,n,r,o,a,h,l,c,u){return t.prep(4,16),t.writeInt8(u),t.writeInt8(c),t.writeInt8(l),t.writeInt8(h),t.writeInt8(a),t.writeInt8(o),t.writeInt8(r),t.writeInt8(n),t.writeInt16(i),t.writeInt16(s),t.writeInt32(e),t.offset()}}var ia=(t=>(t[t.Normal=0]="Normal",t[t.Border=1]="Border",t[t.Center=2]="Center",t[t.DashDot=3]="DashDot",t[t.Dashed=4]="Dashed",t[t.Divide=5]="Divide",t[t.Dot=6]="Dot",t[t.Hidden=7]="Hidden",t))(ia||{});class na{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRelation(t,e){return(e||new na).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRelation(t,e){return t.setPosition(t.position()+4),(e||new na).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startRelation(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endRelation(t){const e=t.endObject();return t.requiredField(e,4),e}static createRelation(t,e){return na.startRelation(t),na.addData(t,e),na.endRelation(t)}}class ra{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSpatialStructure(t,e){return(e||new ra).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSpatialStructure(t,e){return t.setPosition(t.position()+4),(e||new ra).__init(t.readInt32(t.position())+t.position(),t)}localId(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):null}mutate_local_id(t){const e=this.bb.__offset(this.bb_pos,4);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}category(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}children(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new ra).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSpatialStructure(t){t.startObject(3)}static addLocalId(t,e){t.addFieldInt32(0,e,null)}static addCategory(t,e){t.addFieldOffset(1,e,0)}static addChildren(t,e){t.addFieldOffset(2,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static endSpatialStructure(t){return t.endObject()}static createSpatialStructure(t,e,s,i){return ra.startSpatialStructure(t),null!==e&&ra.addLocalId(t,e),ra.addCategory(t,s),ra.addChildren(t,i),ra.endSpatialStructure(t)}}class oa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new oa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+4),(e||new oa).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("0001")}metadata(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guids(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new sa).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}guidsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItems(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}guidsItemsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItemsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}maxLocalId(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}mutate_max_local_id(t){const e=this.bb.__offset(this.bb_pos,10);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}localIds(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}localIdsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}localIdsArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}categories(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}categoriesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}geometries(t){const e=this.bb.__offset(this.bb_pos,16);return e?(t||new ta).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}attributes(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new No).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}attributesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}relations(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new na).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}relationsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItems(t){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}relationsItemsLength(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItemsArray(){const t=this.bb.__offset(this.bb_pos,22);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}guid(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}spatialStructure(t){const e=this.bb.__offset(this.bb_pos,26);return e?(t||new ra).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startModel(t){t.startObject(12)}static addMetadata(t,e){t.addFieldOffset(0,e,0)}static addGuids(t,e){t.addFieldOffset(1,e,0)}static startGuidsVector(t,e){t.startVector(16,e,4)}static addGuidsItems(t,e){t.addFieldOffset(2,e,0)}static createGuidsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGuidsItemsVector(t,e){t.startVector(4,e,4)}static addMaxLocalId(t,e){t.addFieldInt32(3,e,0)}static addLocalIds(t,e){t.addFieldOffset(4,e,0)}static createLocalIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startLocalIdsVector(t,e){t.startVector(4,e,4)}static addCategories(t,e){t.addFieldOffset(5,e,0)}static createCategoriesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCategoriesVector(t,e){t.startVector(4,e,4)}static addGeometries(t,e){t.addFieldOffset(6,e,0)}static addAttributes(t,e){t.addFieldOffset(7,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addRelations(t,e){t.addFieldOffset(8,e,0)}static createRelationsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startRelationsVector(t,e){t.startVector(4,e,4)}static addRelationsItems(t,e){t.addFieldOffset(9,e,0)}static createRelationsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRelationsItemsVector(t,e){t.startVector(4,e,4)}static addGuid(t,e){t.addFieldOffset(10,e,0)}static addSpatialStructure(t,e){t.addFieldOffset(11,e,0)}static endModel(t){const e=t.endObject();return t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,24),e}static finishModelBuffer(t,e){t.finish(e,"0001")}static finishSizePrefixedModelBuffer(t,e){t.finish(e,"0001",!0)}}var aa=(t=>(t[t.Line=0]="Line",t[t.PolyLine=1]="PolyLine",t[t.Arc=2]="Arc",t))(aa||{}),ha=(t=>(t[t.Single=0]="Single",t[t.Double=1]="Double",t[t.FrontFace=2]="FrontFace",t[t.BackFace=3]="BackFace",t))(ha||{});const la=class t{static set(e,s,i){const n=s.globalTransforms(e);t.serializeTransform(i,n)}};nt(la,"get",(()=>{const t=new Ko,e=new Ie,s=new Ie;return(i,n,r)=>{la.parseTransform(n.localTransforms(i.localTransformId(),t),e),la.parseTransform(n.globalTransforms(i.itemId()),s),r.multiplyMatrices(s,e)}})()),nt(la,"getBBox",(()=>{const t=new Do;return(e,s)=>{e.boundingBox(t),la.parseBBox(t,s)}})()),nt(la,"parseBBox",(()=>{const t=new Ro;return(e,s)=>{e.min(t),s.min.set(ua(t.x()),ua(t.y()),ua(t.z())),e.max(t),s.max.set(ua(t.x()),ua(t.y()),ua(t.z()))}})()),nt(la,"parseTransform",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new $o,r=new Ro;return(o,a)=>(o.position(n),t.set(ua(n.x()),ua(n.y()),ua(n.z())),o.xAxis(r),e.set(ua(r.x()),ua(r.y()),ua(r.z())),o.yAxis(r),s.set(ua(r.x()),ua(r.y()),ua(r.z())),i.crossVectors(e,s),a.set(e.x,s.x,i.x,t.x,e.y,s.y,i.y,t.y,e.z,s.z,i.z,t.z,0,0,0,1),a)})()),nt(la,"serializeTransform",(()=>{const t=new $o,e=new Ro;return(s,i)=>{const n=i.position(t);n.mutate_x(s.elements[12]),n.mutate_y(s.elements[13]),n.mutate_z(s.elements[14]);const r=i.xAxis(e);r.mutate_x(s.elements[0]),r.mutate_y(s.elements[1]),r.mutate_z(s.elements[2]);const o=i.yAxis(e);o.mutate_x(s.elements[4]),o.mutate_y(s.elements[5]),o.mutate_z(s.elements[6])}})()),nt(la,"getBBoxSize",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new gi;return r=>(t.copy(r.min),e.copy(r.max),s.addVectors(t,e).multiplyScalar(.5),r.getSize(i),i.x>=i.y&&i.x>=i.z?(t.set(t.x,s.y,s.z),e.set(e.x,s.y,s.z)):i.y>=i.z?(t.set(s.x,t.y,s.z),e.set(s.x,e.y,s.z)):(t.set(s.x,s.y,t.z),e.set(s.x,s.y,e.z)),n.start=t.clone(),n.end=e.clone(),n)})());let ca=la;function ua(t){return Number.isNaN(t)||!Number.isFinite(t)?0:t}class da{constructor(t,e,s,i){nt(this,"_geometries"),nt(this,"_instance",new Ho),nt(this,"_representation",new Zo),nt(this,"_plane",new Ks),nt(this,"linePick",(()=>{const t=new Ho,e=new Ae,s=new Ie,i=new Ie;return(n,r)=>{let o,a=1/0;for(const h of this.aabbController.getItemInstanceIds(n)){this._geometries.instances(h,t),ca.get(t,this._geometries,s),i.copy(s).invert(),e.copy(r).applyMatrix4(i);const l=this.geometryController.linePick(h,e);if(!l)continue;const c=e.distanceSqToPoint(l.point);c<a&&(a=c,o=l,o.instanceId=h,o.itemId=n,o.point.applyMatrix4(s),o.snapLineStart.applyMatrix4(s),o.snapLineEnd.applyMatrix4(s))}return o}})()),nt(this,"pickInstance",(()=>{const t=new Ae,e=new si,s=new Ie,i=new Ie,n=[];return(r,o,a,h,l,c,u)=>{ca.get(a,this._geometries,s),i.copy(s).invert(),t.copy(h).applyMatrix4(i),oo.transform(l,i,e),n.length=0,u&&u.length>0&&n.push(...this.transform(u,i));let d=this.geometryController.pick(o,a.itemId(),c,t,e,n);d&&n.length>0&&(d=d.filter((t=>oo.containedInIndependentPlanes(t.point,n))));const p=[];return d&&d.forEach((t=>{const e=t;e.point.applyMatrix4(s),e.normal&&e.normal.transformDirection(s),e.instanceId=r,e.itemId=a.itemId(),e.pickPriority=this.state.getPickPriority(e.itemId),e.cameraDistanceSq=h.origin.distanceToSquared(e.point),e.snapType||(e.snapType=c),e.snapLineStart&&e.snapLineStart.applyMatrix4(s),e.snapLineEnd&&e.snapLineEnd.applyMatrix4(s),p.push(e)})),p}})()),this.model=t,this.aabbController=e,this.geometryController=s,this.state=i,this._geometries=t.geometries()}getPickable(t){return t.filter((t=>(this._geometries.instances(t,this._instance),this.state.isVisible(this._instance.itemId())&&this.state.getPickPriority(this._instance.itemId())!==_i.IGNORE)))}pickArea(t,e,s){return this.getPickable(this.aabbController.testFrustum(t,e,s)).map((t=>(this._geometries.instances(t,this._instance),this._instance.itemId())))}pick(t,e,s){const i=this.aabbPick(e,s);if(0===i.length)return;const n=this.aabbPick(t,s),r=n.concat(i),o=this.aabbRaySort(t,Array.from(new Set(r)));let a=[];const h=performance.now();for(const i of o){this._geometries.instances(i,this._instance),this._geometries.representations(this._instance.representationId(),this._representation);if((!this.geometryController.isMesh(this._representation.type())||n.includes(i))&&(a=a.concat(this.pickInstance(i,this._representation,this._instance,t,e,void 0,s)),performance.now()-h>400))break}if(0===a.length)return;const l=a.filter((t=>this.state.getPickPriority(t.itemId)===_i.HIGH)),c=l.length>0?this.getNearest(l):this.getNearest(a);return this.addLocalIdToHit(c),c}snapPick(t,e,s,i){let n=[];const r=this.pick(t,e,i);if(!r)return this.snapPickEdges(t,e,s,i);this._geometries.instances(r.instanceId,this._instance),this._geometries.representations(this._instance.representationId(),this._representation),r.normal&&(r.normal.dot(r.point.clone().sub(t.origin))>0&&r.normal.negate(),this._plane.setFromNormalAndCoplanarPoint(r.normal,r.point.clone().sub(r.normal.clone().multiplyScalar(.001))));for(const o of s)n=n.concat(this.pickInstance(r.instanceId,this._representation,this._instance,t,e,o,i));const o=this.snapPickEdges(t,e,s,i);if(o&&(n=n.concat(o)),!r.normal)return n;const a=n.filter((t=>this._plane.distanceToPoint(t.point)>=0));for(const t of a)this.addLocalIdToHit(t);return a}snapPickEdges(t,e,s,i){let n=[];if(s.includes(wi.LINE)||s.includes(wi.POINT)){let r=this.aabbPick(e,i);r.length>10&&(r=this.aabbRaySort(t,r,10));const o=performance.now();for(const a of r){this._geometries.instances(a,this._instance),this._geometries.representations(this._instance.representationId(),this._representation);for(const r of s)r!==wi.LINE&&r!==wi.POINT||(n=n.concat(this.pickInstance(a,this._representation,this._instance,t,e,r,i)));if(performance.now()-o>400)break}}if(0!==n.length){for(const e of n)e.distanceSqToRay=t.distanceSqToPoint(e.point);return n}}aabbPick(t,e){const s=t instanceof Ae?this.aabbController.testBeam(t,e):this.aabbController.testFrustum(t,e);return this.getPickable(s)}aabbRaySort(t,e,s){const i=new Array(e.length),n=new Jt;for(let s=0;s<e.length;s++){const r=this.aabbController.getTransformedAABB(e[s]);t.intersectBox(r,n),i[s]=n.distanceToSquared(t.origin)}const r=this.dataSort(e,i);return s&&r.length>s&&r.splice(s),r}dataSort(t,e){return Array.from(t.keys()).sort(((t,s)=>e[t]-e[s])).map((e=>t[e]))}getNearest(t){return t.reduce(((t,e)=>t.distanceSqToRay&&e.distanceSqToRay?25*t.distanceSqToRay+t.cameraDistanceSq<25*e.distanceSqToRay+e.cameraDistanceSq?t:e:t.cameraDistanceSq<e.cameraDistanceSq?t:e))}transform(t,e){return t?t.map((t=>(new Ks).copy(t).applyMatrix4(e))):[]}addLocalIdToHit(t){if(!t)return;const e=this._geometries.geometriesItems(t.itemId);null!==e&&(t.localId=this.model.localIds(e))}}class pa{}nt(pa,"zero",Object.freeze(new Jt(0,0,0))),nt(pa,"one",Object.freeze(new Jt(1,1,1))),nt(pa,"up",Object.freeze(new Jt(0,0,1))),nt(pa,"down",Object.freeze(new Jt(0,0,-1))),nt(pa,"forward",Object.freeze(new Jt(0,1,0))),nt(pa,"back",Object.freeze(new Jt(0,-1,0))),nt(pa,"right",Object.freeze(new Jt(1,0,0))),nt(pa,"left",Object.freeze(new Jt(-1,0,0))),nt(pa,"threejsUp",Object.freeze(new Jt(0,1,0))),nt(pa,"threejsDown",Object.freeze(new Jt(0,-1,0))),nt(pa,"threejsForward",Object.freeze(new Jt(0,0,1))),nt(pa,"threejsBack",Object.freeze(new Jt(0,0,-1))),nt(pa,"threejsCameraForward",Object.freeze(new Jt(0,0,-1))),nt(pa,"threejsCameraBack",Object.freeze(new Jt(0,0,1)));const fa=class{static arc3Divisions(t){return this.splitArc(t,5,4)}static arc2Divisions(t){return this.splitArc(t,10,8)}static linesPick(t,e,s){this.traverseLines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static arcPick(t,e,s,i){this.traverseArcs(t,((t,s,n)=>{this.linePick(t,s[0],e,i),s.forEach(((t,n)=>{n>0&&this.linePick(s[n-1],t,e,i)})),this.linePick(s[s.length-1],n,e,i)}),s)}static polyLinePick(t,e,s){this.traversePolylines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static geometryLinePick(t,e,s){this.traverseSLines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static screenPointToCasterPoint(t,e,s=new zt){const i=e.getBoundingClientRect();return s.x=(t.x-i.left)/e.clientWidth*2-1,s.y=-(t.y-i.top)/e.clientHeight*2+1,s}static screenToCasterPoint(t,e,s,i=new Ae){return this.rayCaster.setFromCamera(this.screenPointToCasterPoint(t,e),s),i.copy(this.rayCaster.ray)}static splitArc(t,e,s){const i=Math.round(t.angle()*t.radius()*e);return Math.min(Math.max(i,s),30)}};nt(fa,"rayCaster",new class{constructor(t,e,s=0,i=1/0){this.ray=new Ae(t,e),this.near=s,this.far=i,this.camera=null,this.layers=new Ee,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return pi.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(pi),this}intersectObject(t,e=!0,s=[]){return mi(t,this,s,e),s.sort(fi),s}intersectObjects(t,e=!0,s=[]){for(let i=0,n=t.length;i<n;i++)mi(t[i],this,s,e);return s.sort(fi),s}}),nt(fa,"traverseLines",(()=>{const t=new Jt,e=new Jt,s=new Ro,i=new qo;return(n,r)=>{const o=n.linesLength();for(let a=0;a<o;a++)n.lines(a,i),i.start(s),t.set(s.x(),s.y(),s.z()),i.end(s),e.set(s.x(),s.y(),s.z()),r(t,e)}})()),nt(fa,"traverseArcs",(()=>{const t=new Jt,e=new Jt,s=[],i=new Jt,n=new Jt,r=new Uo;return(o,a,h)=>{const l=o.arcsLength();for(let c=0;c<l;c++){o.arcs(c,r);const l=h(r);i.set(r.center().x(),r.center().y(),r.center().z()),n.set(r.axis().x(),r.axis().y(),r.axis().z()),t.set(r.refDirection().x(),r.refDirection().y(),r.refDirection().z()),s.length=l-2;for(let e=0;e<s.length;e++)s[e]=new Jt,s[e].copy(t),s[e].applyAxisAngle(n,r.angle()*(e+1)/(l-1)),s[e].multiplyScalar(r.radius()),s[e].add(i);e.copy(t),e.applyAxisAngle(n,r.angle()),e.multiplyScalar(r.radius()),e.add(i),t.multiplyScalar(r.radius()),t.add(i),a(t,s,e)}}})()),nt(fa,"traversePolylines",(()=>{const t=new Jt,e=new Jt,s=new Go;return(i,n)=>{const r=i.polyLinesLength();for(let o=0;o<r;o++){i.polyLines(o,s);for(let i=0,r=s.pointsLength()-1;i<r;i++)t.set(s.points(i).x(),s.points(i).y(),s.points(i).z()),e.set(s.points(i+1).x(),s.points(i+1).y(),s.points(i+1).z()),n(t,e)}}})()),nt(fa,"traverseSLines",(()=>{const t=new Jt,e=new Jt;return(s,i)=>{if(s){const n=s.length/3;for(let r=1;r<n;r++)e.set(s[3*r],s[3*r+1],s[3*r+2]),t.set(s[3*(r-1)],s[3*(r-1)+1],s[3*(r-1)+2]),i(t,e)}}})()),nt(fa,"linePick",(()=>{const t=new Jt,e=new Jt;return(s,i,n,r)=>{const o=n.distanceSqToSegment(s,i,t,e);r(t,e,s,i,o)}})()),nt(fa,"cylinderHit",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Ie,n=new Ie,r=new Ae,o=new Jt,a=new Jt,h=new Jt,l=[],c=(()=>{const t=new Jt(0,0,1),e=new Jt(1,0,0);return(s,i)=>{Math.abs(s.dot(t))>.9?i.crossVectors(s,e).normalize():i.crossVectors(s,t).normalize()}})(),u=(t,e,s)=>{o.copy(r.direction).normalize().multiplyScalar(t).add(r.origin),o.z>=0&&o.z<=e/s&&(a.set(o.x,o.y,0).applyMatrix4(n).normalize(),o.applyMatrix4(i),l.push({point:o.clone()}))};return(o,a,d,p)=>{const f=a.distanceTo(o);t.copy(a).sub(o).normalize(),c(t,s),e.crossVectors(t,s),i.identity().makeBasis(s,e,t),i.setPosition(o),i.scale(h.set(p,p,p)),n.copy(i).invert(),r.copy(d).applyMatrix4(n);const m=r.direction.x*r.direction.x+r.direction.y*r.direction.y,b=2*r.origin.x*r.direction.x+2*r.origin.y*r.direction.y,y=r.origin.x*r.origin.x+r.origin.y*r.origin.y-1;if(4*m*y>b*b)return[];const g=(-b+Math.sqrt(b*b-4*m*y))/(2*m),x=(-b-Math.sqrt(b*b-4*m*y))/(2*m);return l.length=0,n.transpose(),u(g,f,p),u(x,f,p),l}})()),nt(fa,"sectionHit",(()=>{const t=new Ks,e=new Jt,s=new Jt;return(i,n,r,o)=>{if(e.copy(pa.up).applyQuaternion(n),t.setFromNormalAndCoplanarPoint(e,i),r.intersectsPlane(t)&&(r.intersectPlane(t,s),s.distanceTo(i)<=o))return{point:i.clone()}}})()),nt(fa,"screenRectToFrustum",(()=>{const t=new Ks,e=new Ks,s=new Ks,i=new Ks,n=new Ks,r=new Ks,o=new Jt,a=new Jt,h=new Jt,l=new Jt,c=new Jt,u=new Jt,d=new zt,p=new zt;return(f,m,b,y)=>(fa.screenPointToCasterPoint(f,b,d),fa.screenPointToCasterPoint(m,b,p),o.set(d.x,d.y,1).unproject(y),a.set(p.x,d.y,1).unproject(y),h.set(d.x,p.y,1).unproject(y),l.set(p.x,p.y,1).unproject(y),c.set(d.x,d.y,0).unproject(y),u.set(p.x,p.y,0).unproject(y),t.setFromCoplanarPoints(c,o,a),e.setFromCoplanarPoints(u,a,l),s.setFromCoplanarPoints(u,l,h),i.setFromCoplanarPoints(c,h,o),y.getWorldDirection(n.normal),n.constant=y.position.length(),r.normal=n.normal,r.constant=1/0,new si(t,s,i,e,r,n))})());let ma=fa;const ba=class t{constructor(){nt(this,"tempInt",new Int32Array(1)),nt(this,"tempFloat",new Float32Array(this.tempInt.buffer)),nt(this,"buffer",new Uint8Array(this.tempInt.buffer)),nt(this,"checksum",-1)}append(e){switch(typeof e){case"number":Number.isInteger(e)&&e<t.int32MaxValue&&e>t.int32MinValue?this.tempInt[0]=e:this.tempFloat[0]=e,this.update();break;case"boolean":this.tempInt[0]=e?1:0,this.update();break;case"string":for(let t=0;t<e.length;++t)this.tempInt[0]=e.codePointAt(t),this.update();break;case"object":for(const t in e)e.hasOwnProperty(t)&&this.append(e[t])}return this}value(){return~this.checksum}reset(){return this.checksum=-1,this}update(){for(let e=0;e<4;++e){this.checksum^=this.buffer[e];for(let e=0;e<8;++e)this.checksum=1&this.checksum?this.checksum>>1^t.polynomial:this.checksum>>1}}};nt(ba,"polynomial",2197175160),nt(ba,"int32MaxValue",2147483647),nt(ba,"int32MinValue",-2147483648);let ya=ba;const ga=class t{constructor(t,e){nt(this,"first"),this.first={start:0,count:t,prev:null,next:null,value:e}}getBufferData(t){let e=this.first;for(;;){if(null===e||e.start<=t&&t<e.start+e.count)return e;e=e.next}}add(e,s,i){if(!t.stash.length)return{start:e,count:s,prev:null,next:null,value:i};const n=t.stash.pop();return n.start=e,n.count=s,n.value=i,n}remove(e){e&&(e.next=null,e.prev=null,t.stash.push(e))}update(t,e){const s=this.getBufferData(t);if(s.value===e)return;const i=this.add(s.start,t-s.start,s.value),n=this.add(t,1,e),r=this.add(t+1,s.count-i.count-1,s.value);if(s.prev?(s.prev.next=i,i.prev=s.prev):this.first=i,s.next&&(s.next.prev=r,r.next=s.next),this.remove(s),i.next=n,n.prev=i,n.next=r,r.prev=n,i.count||(i.prev?i.prev.next=n:this.first=n,n.prev=i.prev,this.remove(i)),r.count||(r.next&&(r.next.prev=n),n.next=r.next,this.remove(r)),n.prev&&n.prev.value===n.value){n.count=n.prev.count+n.count,n.start=n.prev.start;const t=n.prev.prev;this.remove(n.prev),n.prev=t,n.prev?n.prev.next=n:this.first=n}if(n.next&&n.next.value===n.value){n.count=n.next.count+n.count;const t=n.next.next;this.remove(n.next),n.next=t,n.next&&(n.next.prev=n)}}getMinimal(t){const e=[];let s=this.first;for(;null!==s;)t&&!t(s.value)||e.push(s),s=s.next;return e}size(t){let e=0,s=this.first;for(;null!==s;)t&&!t(s.value)||++e,s=s.next;return e}allContain(t){return null===this.first.next&&this.first.value===t}static mapRange(t,e,s){s||(s={start:0,count:0});const i=t.start+t.count===e.length;return s.start=e[t.start],s.count=i?1/0:e[t.start+t.count]-s.start,s}};nt(ga,"stash",[]),nt(ga,"get",(()=>{const t={start:0,count:0};return(e,s,i,n)=>{const r=e.getMinimal(i),o=new Uint32Array(r.length),a=new Uint32Array(r.length);for(let e=0;e<r.length;++e){const i=r[e];ga.mapRange(i,s,t),o[e]=t.start,a[e]=t.count===1/0?4294967295:t.count,n&&n(e,i.value)}return{starts:o,counts:a}}})()),nt(ga,"getComplementary",((t,e)=>{let s=0;for(let i=0;i<t.starts.length;++i){const n=t.starts[i],r=4294967295===t.counts[i]?1/0:t.counts[i];n>s&&e(s,n-s),s=n+r}s!==1/0&&e(s,1/0)}));let xa=ga;class _a{constructor(){nt(this,"textDecoder",new TextDecoder)}decode(t,e){return t=t instanceof Uint8Array&&"undefined"!=typeof SharedArrayBuffer&&t.buffer instanceof SharedArrayBuffer?new Uint8Array(t):t,this.textDecoder.decode(t,e)}}const wa=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_","$"];class va{constructor({buffer:t,guid:e}){nt(this,"buffer"),t?this.buffer=t:e?this.setGuid(e):this.buffer=new Uint8Array(16)}parseJson({data:t}){this.buffer=new Uint8Array(JSON.parse(`[${t}]`))}isSameAs(t){for(let e=0;e<16;e++)if(this.buffer[e]!==t.buffer[e])return!1;return!0}serialize(){return this.guid}get guidNumbers(){const t=this.buffer.byteOffset,e=new DataView(this.buffer.buffer,t,16);return{b1:e.getUint32(0,!0),b2:e.getUint16(4,!0),b3:e.getUint16(6,!0),b4:e.getUint8(8),b5:e.getUint8(9),b6:e.getUint8(10),b44:e.getUint8(11),b45:e.getUint8(12),b46:e.getUint8(13),b47:e.getUint8(14),b48:e.getUint8(15)}}get guid(){const t=new Uint8Array(24),e=this.buffer;t[0]=e[15],t[1]=e[14],t[2]=e[13],t[3]=0,t[4]=e[12],t[5]=e[11],t[6]=e[10],t[7]=0,t[8]=e[9],t[9]=e[8],t[10]=e[6],t[11]=0,t[12]=e[7],t[13]=e[4],t[14]=e[5],t[15]=0,t[16]=e[0],t[17]=e[1],t[18]=e[2],t[19]=0,t[20]=e[3],t[21]=0,t[22]=0,t[23]=0;const s=new Uint32Array(t.buffer);return this.exportBase64(s[5],8)+this.exportBase64(s[4],24)+this.exportBase64(s[3],24)+this.exportBase64(s[2],24)+this.exportBase64(s[1],24)+this.exportBase64(s[0],24)}setGuid(t){this.buffer=new Uint8Array(16);const e=this.importBase64(t[0],6)+this.importBase64(t[1],0),s=this.importBase64(t[2],18)+this.importBase64(t[3],12)+this.importBase64(t[4],6)+this.importBase64(t[5],0),i=this.importBase64(t[6],18)+this.importBase64(t[7],12)+this.importBase64(t[8],6)+this.importBase64(t[9],0),n=this.importBase64(t[10],18)+this.importBase64(t[11],12)+this.importBase64(t[12],6)+this.importBase64(t[13],0),r=this.importBase64(t[14],18)+this.importBase64(t[15],12)+this.importBase64(t[16],6)+this.importBase64(t[17],0),o=this.importBase64(t[18],18)+this.importBase64(t[19],12)+this.importBase64(t[20],6)+this.importBase64(t[21],0),a=this.bytes(o),h=this.bytes(r),l=this.bytes(n),c=this.bytes(i),u=this.bytes(s),d=this.bytes(e);this.buffer[15]=a[0],this.buffer[14]=a[1],this.buffer[13]=a[2],this.buffer[12]=h[0],this.buffer[11]=h[1],this.buffer[10]=h[2],this.buffer[9]=l[0],this.buffer[8]=l[1],this.buffer[6]=l[2],this.buffer[7]=c[0],this.buffer[4]=c[1],this.buffer[5]=c[2],this.buffer[0]=u[0],this.buffer[1]=u[1],this.buffer[2]=u[2],this.buffer[3]=d[0]}fromBuffer(t,e){this.buffer=new Uint8Array(t,e,16)}exportBase64(t,e){let s="";if(e>0){s+=wa[63&t],s=this.exportBase64(t>>6,e-6)+s}return s}importBase64(t,e){let s=0;for(;s<64&&wa[s]!=t;)s++;return s<<e}bytes(t){const e=new ArrayBuffer(8);return new Int32Array(e)[0]=t,new Uint8Array(e)}}function Ma(t,e){if(Array.isArray(t))for(let s=0;s<t.length;s++)e(t[s],s);else e(t,0)}const Sa="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Aa=new Set,Ia="object"==typeof process&&process?process:{},Ba=(t,e,s,i)=>{"function"==typeof Ia.emitWarning?Ia.emitWarning(t,e,s,i):console.error(`[${s}] ${e}: ${t}`)};let Ta=globalThis.AbortController,za=globalThis.AbortSignal;if(void 0===Ta){za=class{constructor(){nt(this,"onabort"),nt(this,"_onabort",[]),nt(this,"reason"),nt(this,"aborted",!1)}addEventListener(t,e){this._onabort.push(e)}},Ta=class{constructor(){nt(this,"signal",new za),s()}abort(t){var e,s;if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);null==(s=(e=this.signal).onabort)||s.call(e,t)}}};let e="1"!==(null==(t=Ia.env)?void 0:t.LRU_CACHE_IGNORE_AC_WARNING);const s=()=>{e&&(e=!1,Ba("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const Ca=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),Pa=t=>Ca(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Fa:null:null;class Fa extends Array{constructor(t){super(t),this.fill(0)}}const La=class t{constructor(s,i){if(nt(this,"heap"),nt(this,"length"),!ot(t,e))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new i(s),this.length=0}static create(s){const i=Pa(s);if(!i)return[];ht(t,e,!0);const n=new t(s,i);return ht(t,e,!1),n}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};e=new WeakMap,at(La,e,!1);let ka=La;const Oa=class t{constructor(e){at(this,A),at(this,P),at(this,V),at(this,R),at(this,U),at(this,G),at(this,H),at(this,Z),at(this,X),at(this,Q),at(this,K),at(this,et),at(this,s,void 0),at(this,i,void 0),at(this,n,void 0),at(this,r,void 0),at(this,o,void 0),at(this,a,void 0),nt(this,"ttl"),nt(this,"ttlResolution"),nt(this,"ttlAutopurge"),nt(this,"updateAgeOnGet"),nt(this,"updateAgeOnHas"),nt(this,"allowStale"),nt(this,"noDisposeOnSet"),nt(this,"noUpdateTTL"),nt(this,"maxEntrySize"),nt(this,"sizeCalculation"),nt(this,"noDeleteOnFetchRejection"),nt(this,"noDeleteOnStaleGet"),nt(this,"allowStaleOnFetchAbort"),nt(this,"allowStaleOnFetchRejection"),nt(this,"ignoreFetchAbort"),at(this,h,void 0),at(this,l,void 0),at(this,c,void 0),at(this,u,void 0),at(this,d,void 0),at(this,p,void 0),at(this,f,void 0),at(this,m,void 0),at(this,b,void 0),at(this,y,void 0),at(this,g,void 0),at(this,x,void 0),at(this,_,void 0),at(this,w,void 0),at(this,v,void 0),at(this,M,void 0),at(this,S,void 0),at(this,B,(()=>{})),at(this,T,(()=>{})),at(this,z,(()=>{})),at(this,C,(()=>!1)),at(this,L,(t=>{})),at(this,k,((t,e,s)=>{})),at(this,O,((t,e,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0})),nt(this,q,"LRUCache");const{max:E=0,ttl:D,ttlResolution:N=1,ttlAutopurge:W,updateAgeOnGet:j,updateAgeOnHas:Y,allowStale:J,dispose:$,disposeAfter:tt,noDisposeOnSet:st,noUpdateTTL:it,maxSize:rt=0,maxEntrySize:lt=0,sizeCalculation:ut,fetchMethod:dt,memoMethod:pt,noDeleteOnFetchRejection:ft,noDeleteOnStaleGet:mt,allowStaleOnFetchRejection:bt,allowStaleOnFetchAbort:yt,ignoreFetchAbort:gt}=e;if(0!==E&&!Ca(E))throw new TypeError("max option must be a nonnegative integer");const xt=E?Pa(E):Array;if(!xt)throw new Error("invalid max value: "+E);if(ht(this,s,E),ht(this,i,rt),this.maxEntrySize=lt||ot(this,i),this.sizeCalculation=ut,this.sizeCalculation){if(!ot(this,i)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==pt&&"function"!=typeof pt)throw new TypeError("memoMethod must be a function if defined");if(ht(this,a,pt),void 0!==dt&&"function"!=typeof dt)throw new TypeError("fetchMethod must be a function if specified");if(ht(this,o,dt),ht(this,M,!!dt),ht(this,c,new Map),ht(this,u,new Array(E).fill(void 0)),ht(this,d,new Array(E).fill(void 0)),ht(this,p,new xt(E)),ht(this,f,new xt(E)),ht(this,m,0),ht(this,b,0),ht(this,y,ka.create(E)),ht(this,h,0),ht(this,l,0),"function"==typeof $&&ht(this,n,$),"function"==typeof tt?(ht(this,r,tt),ht(this,g,[])):(ht(this,r,void 0),ht(this,g,void 0)),ht(this,v,!!ot(this,n)),ht(this,S,!!ot(this,r)),this.noDisposeOnSet=!!st,this.noUpdateTTL=!!it,this.noDeleteOnFetchRejection=!!ft,this.allowStaleOnFetchRejection=!!bt,this.allowStaleOnFetchAbort=!!yt,this.ignoreFetchAbort=!!gt,0!==this.maxEntrySize){if(0!==ot(this,i)&&!Ca(ot(this,i)))throw new TypeError("maxSize must be a positive integer if specified");if(!Ca(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");ct(this,P,F).call(this)}if(this.allowStale=!!J,this.noDeleteOnStaleGet=!!mt,this.updateAgeOnGet=!!j,this.updateAgeOnHas=!!Y,this.ttlResolution=Ca(N)||0===N?N:1,this.ttlAutopurge=!!W,this.ttl=D||0,this.ttl){if(!Ca(this.ttl))throw new TypeError("ttl must be a positive integer if specified");ct(this,A,I).call(this)}if(0===ot(this,s)&&0===this.ttl&&0===ot(this,i))throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ot(this,s)&&!ot(this,i)){const e="LRU_CACHE_UNBOUNDED";if((t=>!Aa.has(t))(e)){Aa.add(e);Ba("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,t)}}}static unsafeExposeInternals(t){return{starts:ot(t,_),ttls:ot(t,w),sizes:ot(t,x),keyMap:ot(t,c),keyList:ot(t,u),valList:ot(t,d),next:ot(t,p),prev:ot(t,f),get head(){return ot(t,m)},get tail(){return ot(t,b)},free:ot(t,y),isBackgroundFetch:e=>{var s;return ct(s=t,Z,Y).call(s,e)},backgroundFetch:(e,s,i,n)=>{var r;return ct(r=t,H,j).call(r,e,s,i,n)},moveToTail:e=>{var s;return ct(s=t,Q,$).call(s,e)},indexes:e=>{var s;return ct(s=t,V,E).call(s,e)},rindexes:e=>{var s;return ct(s=t,R,D).call(s,e)},isStale:e=>{var s;return ot(s=t,C).call(s,e)}}}get max(){return ot(this,s)}get maxSize(){return ot(this,i)}get calculatedSize(){return ot(this,l)}get size(){return ot(this,h)}get fetchMethod(){return ot(this,o)}get memoMethod(){return ot(this,a)}get dispose(){return ot(this,n)}get disposeAfter(){return ot(this,r)}getRemainingTTL(t){return ot(this,c).has(t)?1/0:0}*entries(){for(const t of ct(this,V,E).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*rentries(){for(const t of ct(this,R,D).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*keys(){for(const t of ct(this,V,E).call(this)){const e=ot(this,u)[t];void 0===e||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield e)}}*rkeys(){for(const t of ct(this,R,D).call(this)){const e=ot(this,u)[t];void 0===e||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield e)}}*values(){for(const t of ct(this,V,E).call(this)){void 0===ot(this,d)[t]||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}*rvalues(){for(const t of ct(this,R,D).call(this)){void 0===ot(this,d)[t]||ct(this,Z,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const s of ct(this,V,E).call(this)){const i=ot(this,d)[s],n=ct(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0!==n&&t(n,ot(this,u)[s],this))return this.get(ot(this,u)[s],e)}}forEach(t,e=this){for(const s of ct(this,V,E).call(this)){const i=ot(this,d)[s],n=ct(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}rforEach(t,e=this){for(const s of ct(this,R,D).call(this)){const i=ot(this,d)[s],n=ct(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}purgeStale(){let t=!1;for(const e of ct(this,R,D).call(this,{allowStale:!0}))ot(this,C).call(this,e)&&(ct(this,K,tt).call(this,ot(this,u)[e],"expire"),t=!0);return t}info(t){const e=ot(this,c).get(t);if(void 0===e)return;const s=ot(this,d)[e],i=ct(this,Z,Y).call(this,s)?s.__staleWhileFetching:s;if(void 0===i)return;const n={value:i};if(ot(this,w)&&ot(this,_)){const t=ot(this,w)[e],s=ot(this,_)[e];if(t&&s){const e=t-(Sa.now()-s);n.ttl=e,n.start=Date.now()}}return ot(this,x)&&(n.size=ot(this,x)[e]),n}dump(){const t=[];for(const e of ct(this,V,E).call(this,{allowStale:!0})){const s=ot(this,u)[e],i=ot(this,d)[e],n=ct(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0===n||void 0===s)continue;const r={value:n};if(ot(this,w)&&ot(this,_)){r.ttl=ot(this,w)[e];const t=Sa.now()-ot(this,_)[e];r.start=Math.floor(Date.now()-t)}ot(this,x)&&(r.size=ot(this,x)[e]),t.unshift([s,r])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const t=Date.now()-s.start;s.start=Sa.now()-t}this.set(e,s.value,s)}}set(t,e,i={}){var o,a,l,m,x;if(void 0===e)return this.delete(t),this;const{ttl:_=this.ttl,start:B,noDisposeOnSet:C=this.noDisposeOnSet,sizeCalculation:P=this.sizeCalculation,status:F}=i;let{noUpdateTTL:V=this.noUpdateTTL}=i;const E=ot(this,O).call(this,t,e,i.size||0,P);if(this.maxEntrySize&&E>this.maxEntrySize)return F&&(F.set="miss",F.maxEntrySizeExceeded=!0),ct(this,K,tt).call(this,t,"set"),this;let R=0===ot(this,h)?void 0:ot(this,c).get(t);if(void 0===R)R=0===ot(this,h)?ot(this,b):0!==ot(this,y).length?ot(this,y).pop():ot(this,h)===ot(this,s)?ct(this,G,W).call(this,!1):ot(this,h),ot(this,u)[R]=t,ot(this,d)[R]=e,ot(this,c).set(t,R),ot(this,p)[ot(this,b)]=R,ot(this,f)[R]=ot(this,b),ht(this,b,R),lt(this,h)._++,ot(this,k).call(this,R,E,F),F&&(F.set="add"),V=!1;else{ct(this,Q,$).call(this,R);const s=ot(this,d)[R];if(e!==s){if(ot(this,M)&&ct(this,Z,Y).call(this,s)){s.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=s;void 0===e||C||(ot(this,v)&&(null==(o=ot(this,n))||o.call(this,e,t,"set")),ot(this,S)&&(null==(a=ot(this,g))||a.push([e,t,"set"])))}else C||(ot(this,v)&&(null==(l=ot(this,n))||l.call(this,s,t,"set")),ot(this,S)&&(null==(m=ot(this,g))||m.push([s,t,"set"])));if(ot(this,L).call(this,R),ot(this,k).call(this,R,E,F),ot(this,d)[R]=e,F){F.set="replace";const t=s&&ct(this,Z,Y).call(this,s)?s.__staleWhileFetching:s;void 0!==t&&(F.oldValue=t)}}else F&&(F.set="update")}if(0===_||ot(this,w)||ct(this,A,I).call(this),ot(this,w)&&(V||ot(this,z).call(this,R,_,B),F&&ot(this,T).call(this,F,R)),!C&&ot(this,S)&&ot(this,g)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(x=ot(this,r))||x.call(this,...e)}return this}pop(){var t;try{for(;ot(this,h);){const t=ot(this,d)[ot(this,m)];if(ct(this,G,W).call(this,!0),ct(this,Z,Y).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(ot(this,S)&&ot(this,g)){const e=ot(this,g);let s;for(;s=null==e?void 0:e.shift();)null==(t=ot(this,r))||t.call(this,...s)}}}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=e,n=ot(this,c).get(t);if(void 0!==n){const t=ot(this,d)[n];if(ct(this,Z,Y).call(this,t)&&void 0===t.__staleWhileFetching)return!1;if(!ot(this,C).call(this,n))return s&&ot(this,B).call(this,n),i&&(i.has="hit",ot(this,T).call(this,i,n)),!0;i&&(i.has="stale",ot(this,T).call(this,i,n))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,i=ot(this,c).get(t);if(void 0===i||!s&&ot(this,C).call(this,i))return;const n=ot(this,d)[i];return ct(this,Z,Y).call(this,n)?n.__staleWhileFetching:n}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,context:b,forceRefresh:y=!1,status:g,signal:x}=e;if(!ot(this,M))return g&&(g.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,status:g});const _={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,ttl:r,noDisposeOnSet:o,size:a,sizeCalculation:h,noUpdateTTL:l,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:m,ignoreFetchAbort:f,status:g,signal:x};let w=ot(this,c).get(t);if(void 0===w){g&&(g.fetch="miss");const e=ct(this,H,j).call(this,t,w,_,b);return e.__returned=e}{const e=ot(this,d)[w];if(ct(this,Z,Y).call(this,e)){const t=s&&void 0!==e.__staleWhileFetching;return g&&(g.fetch="inflight",t&&(g.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const n=ot(this,C).call(this,w);if(!y&&!n)return g&&(g.fetch="hit"),ct(this,Q,$).call(this,w),i&&ot(this,B).call(this,w),g&&ot(this,T).call(this,g,w),e;const r=ct(this,H,j).call(this,t,w,_,b),o=void 0!==r.__staleWhileFetching&&s;return g&&(g.fetch=n?"stale":"refresh",o&&n&&(g.returnedStale=!0)),o?r.__staleWhileFetching:r.__returned=r}}async forceFetch(t,e={}){const s=await this.fetch(t,e);if(void 0===s)throw new Error("fetch() returned undefined");return s}memo(t,e={}){const s=ot(this,a);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:n,...r}=e,o=this.get(t,r);if(!n&&void 0!==o)return o;const h=s(t,o,{options:r,context:i});return this.set(t,h,r),h}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:r}=e,o=ot(this,c).get(t);if(void 0!==o){const e=ot(this,d)[o],a=ct(this,Z,Y).call(this,e);return r&&ot(this,T).call(this,r,o),ot(this,C).call(this,o)?(r&&(r.get="stale"),a?(r&&s&&void 0!==e.__staleWhileFetching&&(r.returnedStale=!0),s?e.__staleWhileFetching:void 0):(n||ct(this,K,tt).call(this,t,"expire"),r&&s&&(r.returnedStale=!0),s?e:void 0)):(r&&(r.get="hit"),a?e.__staleWhileFetching:(ct(this,Q,$).call(this,o),i&&ot(this,B).call(this,o),e))}r&&(r.get="miss")}delete(t){return ct(this,K,tt).call(this,t,"delete")}clear(){return ct(this,et,st).call(this,"delete")}};q=Symbol.toStringTag,s=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,b=new WeakMap,y=new WeakMap,g=new WeakMap,x=new WeakMap,_=new WeakMap,w=new WeakMap,v=new WeakMap,M=new WeakMap,S=new WeakMap,A=new WeakSet,I=function(){const t=new Fa(ot(this,s)),e=new Fa(ot(this,s));ht(this,w,t),ht(this,_,e),ht(this,z,((s,i,n=Sa.now())=>{if(e[s]=0!==i?n:0,t[s]=i,0!==i&&this.ttlAutopurge){const t=setTimeout((()=>{ot(this,C).call(this,s)&&ct(this,K,tt).call(this,ot(this,u)[s],"expire")}),i+1);t.unref&&t.unref()}})),ht(this,B,(s=>{e[s]=0!==t[s]?Sa.now():0})),ht(this,T,((s,r)=>{if(t[r]){const o=t[r],a=e[r];if(!o||!a)return;s.ttl=o,s.start=a,s.now=i||n();const h=s.now-a;s.remainingTTL=o-h}}));let i=0;const n=()=>{const t=Sa.now();if(this.ttlResolution>0){i=t;const e=setTimeout((()=>i=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const r=ot(this,c).get(s);if(void 0===r)return 0;const o=t[r],a=e[r];if(!o||!a)return 1/0;return o-((i||n())-a)},ht(this,C,(s=>{const r=e[s],o=t[s];return!!o&&!!r&&(i||n())-r>o}))},B=new WeakMap,T=new WeakMap,z=new WeakMap,C=new WeakMap,P=new WeakSet,F=function(){const t=new Fa(ot(this,s));ht(this,l,0),ht(this,x,t),ht(this,L,(e=>{ht(this,l,ot(this,l)-t[e]),t[e]=0})),ht(this,O,((t,e,s,i)=>{if(ct(this,Z,Y).call(this,e))return 0;if(!Ca(s)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(e,t),!Ca(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s})),ht(this,k,((e,s,n)=>{if(t[e]=s,ot(this,i)){const s=ot(this,i)-t[e];for(;ot(this,l)>s;)ct(this,G,W).call(this,!0)}ht(this,l,ot(this,l)+t[e]),n&&(n.entrySize=s,n.totalCalculatedSize=ot(this,l))}))},L=new WeakMap,k=new WeakMap,O=new WeakMap,V=new WeakSet,E=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,b);ct(this,U,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,m));)e=ot(this,f)[e]},R=new WeakSet,D=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,m);ct(this,U,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,b));)e=ot(this,p)[e]},U=new WeakSet,N=function(t){return void 0!==t&&ot(this,c).get(ot(this,u)[t])===t},G=new WeakSet,W=function(t){var e,s;const i=ot(this,m),r=ot(this,u)[i],o=ot(this,d)[i];return ot(this,M)&&ct(this,Z,Y).call(this,o)?o.__abortController.abort(new Error("evicted")):(ot(this,v)||ot(this,S))&&(ot(this,v)&&(null==(e=ot(this,n))||e.call(this,o,r,"evict")),ot(this,S)&&(null==(s=ot(this,g))||s.push([o,r,"evict"]))),ot(this,L).call(this,i),t&&(ot(this,u)[i]=void 0,ot(this,d)[i]=void 0,ot(this,y).push(i)),1===ot(this,h)?(ht(this,m,ht(this,b,0)),ot(this,y).length=0):ht(this,m,ot(this,p)[i]),ot(this,c).delete(r),lt(this,h)._--,i},H=new WeakSet,j=function(t,e,s,i){const n=void 0===e?void 0:ot(this,d)[e];if(ct(this,Z,Y).call(this,n))return n;const r=new Ta,{signal:a}=s;null==a||a.addEventListener("abort",(()=>r.abort(a.reason)),{signal:r.signal});const h={signal:r.signal,options:s,context:i},l=(i,n=!1)=>{const{aborted:o}=r.signal,a=s.ignoreFetchAbort&&void 0!==i;if(s.status&&(o&&!n?(s.status.fetchAborted=!0,s.status.fetchError=r.signal.reason,a&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),o&&!a&&!n)return u(r.signal.reason);const l=p;return ot(this,d)[e]===p&&(void 0===i?l.__staleWhileFetching?ot(this,d)[e]=l.__staleWhileFetching:ct(this,K,tt).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,i,h.options))),i},u=i=>{const{aborted:n}=r.signal,o=n&&s.allowStaleOnFetchAbort,a=o||s.allowStaleOnFetchRejection,h=a||s.noDeleteOnFetchRejection,l=p;if(ot(this,d)[e]===p){!h||void 0===l.__staleWhileFetching?ct(this,K,tt).call(this,t,"fetch"):o||(ot(this,d)[e]=l.__staleWhileFetching)}if(a)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw i};s.status&&(s.status.fetchDispatched=!0);const p=new Promise(((e,i)=>{var a;const c=null==(a=ot(this,o))?void 0:a.call(this,t,n,h);c&&c instanceof Promise&&c.then((t=>e(void 0===t?void 0:t)),i),r.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(e(void 0),s.allowStaleOnFetchAbort&&(e=t=>l(t,!0)))}))})).then(l,(t=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=t),u(t)))),f=Object.assign(p,{__abortController:r,__staleWhileFetching:n,__returned:void 0});return void 0===e?(this.set(t,f,{...h.options,status:void 0}),e=ot(this,c).get(t)):ot(this,d)[e]=f,f},Z=new WeakSet,Y=function(t){if(!ot(this,M))return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof Ta},X=new WeakSet,J=function(t,e){ot(this,f)[e]=t,ot(this,p)[t]=e},Q=new WeakSet,$=function(t){t!==ot(this,b)&&(t===ot(this,m)?ht(this,m,ot(this,p)[t]):ct(this,X,J).call(this,ot(this,f)[t],ot(this,p)[t]),ct(this,X,J).call(this,ot(this,b),t),ht(this,b,t))},K=new WeakSet,tt=function(t,e){var s,i,o,a;let l=!1;if(0!==ot(this,h)){const r=ot(this,c).get(t);if(void 0!==r)if(l=!0,1===ot(this,h))ct(this,et,st).call(this,e);else{ot(this,L).call(this,r);const o=ot(this,d)[r];if(ct(this,Z,Y).call(this,o)?o.__abortController.abort(new Error("deleted")):(ot(this,v)||ot(this,S))&&(ot(this,v)&&(null==(s=ot(this,n))||s.call(this,o,t,e)),ot(this,S)&&(null==(i=ot(this,g))||i.push([o,t,e]))),ot(this,c).delete(t),ot(this,u)[r]=void 0,ot(this,d)[r]=void 0,r===ot(this,b))ht(this,b,ot(this,f)[r]);else if(r===ot(this,m))ht(this,m,ot(this,p)[r]);else{const t=ot(this,f)[r];ot(this,p)[t]=ot(this,p)[r];const e=ot(this,p)[r];ot(this,f)[e]=ot(this,f)[r]}lt(this,h)._--,ot(this,y).push(r)}}if(ot(this,S)&&(null==(o=ot(this,g))?void 0:o.length)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(a=ot(this,r))||a.call(this,...e)}return l},et=new WeakSet,st=function(t){var e,s,i;for(const i of ct(this,R,D).call(this,{allowStale:!0})){const r=ot(this,d)[i];if(ct(this,Z,Y).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=ot(this,u)[i];ot(this,v)&&(null==(e=ot(this,n))||e.call(this,r,o,t)),ot(this,S)&&(null==(s=ot(this,g))||s.push([r,o,t]))}}if(ot(this,c).clear(),ot(this,d).fill(void 0),ot(this,u).fill(void 0),ot(this,w)&&ot(this,_)&&(ot(this,w).fill(0),ot(this,_).fill(0)),ot(this,x)&&ot(this,x).fill(0),ht(this,m,0),ht(this,b,0),ot(this,y).length=0,ht(this,l,0),ht(this,h,0),ot(this,S)&&ot(this,g)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(i=ot(this,r))||i.call(this,...e)}};let Va=Oa;const Ea=32767;var Ra=(t=>(t[t.NONE=0]="NONE",t[t.AABB=1]="AABB",t[t.CUSTOM=2]="CUSTOM",t))(Ra||{});const Da=class t{constructor(t,e){nt(this,"geometryType"),nt(this,"snapGeometryType"),nt(this,"lodType",Ra.NONE),nt(this,"geometryPrototypes",new Map),nt(this,"geometryKeys",new Set),nt(this,"checksum",new ya),nt(this,"modelIdHash"),this.geometry=e,this.modelIdHash=this.checksum.reset().append(t).value()}static createCache(t){return new Va({maxSize:Math.max(t??this.calculateMemoryCacheSize(),1),sizeCalculation:t=>{const e=Array.isArray(t)?t.reduce(((t,e)=>t+e.usedMemory),0):t.usedMemory;return Math.max(e,1)}})}static calculateMemoryCacheSize(){return Math.trunc(104857600*(navigator.deviceMemory??2))}static set maxCacheSize(e){t._maxCacheSize!==e&&(t.geometries.clear(),t.geometries=t.createCache(e),t._maxCacheSize=e)}setGeometryPrototype(t,e,s=Si.Full){this.geometryPrototypes.set(this.getCacheKey(t,s),Object.seal(e))}getCachedGeometryData(t,e=Si.Full){return this.getCachedGeometry(t,e)}getCachedGeometryDatas(t,e=Si.Full){return this.getCachedGeometry(t,e)}getCachedGeometry(e,s=Si.Full){const i=this.getCacheKey(e,s);let n=t.geometries.get(i);if(!n){const t=this.geometryPrototypes.get(i);n=Array.isArray(t)?t.map((t=>({...t}))):{...t}}return n}getCacheKey(t,e){return this.checksum.reset().append(this.modelIdHash).append(this.geometryType).append(e).append(t).value()}calculateMemSizeAndCache(e,s,i=Si.Full){Ma(s,(t=>{t.usedMemory=t.positionBuffer.byteLength,t.indexBuffer&&(t.usedMemory+=t.indexBuffer.byteLength),t.normalBuffer&&(t.usedMemory+=t.normalBuffer.byteLength),Object.seal(t)}));const n=this.getCacheKey(e,i);t.geometries.set(n,s),this.geometryKeys.add(n)}dispose(){for(const e of this.geometryKeys)t.geometries.delete(e)}};nt(Da,"pickableAngleInRadian",Math.PI/36),nt(Da,"SMOOTH_LIMIT",Math.cos(Math.PI/10)),nt(Da,"geometries",Da.createCache()),nt(Da,"_maxCacheSize");let Ua=Da;function Na(t,e,s,i,n,r){s=s||2;var o=e&&e.length,a=o?e[0]*s:t.length,h=qa(t,0,a,s,!0,i,n);if(h&&h.next!==h.prev){var l,c,u,d,p,f,m;if(o&&(h=function(t,e,s,i,n,r){var o,a,h,l=[];for(o=0,a=e.length;o<a;o++)(h=qa(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i,!1,n,r))===h.next&&(h.steiner=!0),l.push(Ka(h));for(l.sort(Xa),o=0;o<l.length;o++)s=Ga(s=Ja(l[o],s),s.next);return s}(t,e,h,s,i,n)),t.length>80*s){l=u=t[i],c=d=t[n];for(var b=s;b<a;b+=s)(p=t[b+i])<l&&(l=p),(f=t[b+n])<c&&(c=f),p>u&&(u=p),f>d&&(d=f);m=0!==(m=Math.max(u-l,d-c))?1/m:0}Wa(h,r,s,l,c,m)}}function qa(t,e,s,i,n,r,o){var a,h,l;if(n===function(t,e,s,i,n,r){for(var o=0,a=e,h=s-i;a<s;a+=i)o+=(t[h+n]-t[a+n])*(t[a+r]+t[h+r]),h=a;return o}(t,e,s,i,r,o)>0)for(a=e;a<s;a+=i)h=lh(a,t[a+r],t[a+o],h);else for(a=s-i;a>=e;a-=i)h=lh(a,t[a+r],t[a+o],h);return h&&ih(h,h.next)&&(l=h.next,ch(h),h=l),h}function Ga(t,e){if(!t)return t;e||(e=t);var s,i,n=t;do{if(s=!1,n.steiner||!ih(n,n.next)&&0!==sh(n.prev,n,n.next))n=n.next;else{if(i=n.prev,ch(n),(n=e=i)===n.next)break;s=!0}}while(s||n!==e);return e}function Wa(t,e,s,i,n,r,o){if(t){!o&&r&&function(t,e,s,i){var n=t;do{null===n.z&&(n.z=$a(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,o,a,h,l=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,i=s,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,a--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,r);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?ja(t,i,n,r):Ha(t))e(a.i/s,t.i/s,h.i/s),ch(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?Wa(t=Za(Ga(t),e,s),e,s,i,n,r,2):2===o&&Ya(t,e,s,i,n,r):Wa(Ga(t),e,s,i,n,r,1);break}}}function Ha(t){var e=t.prev,s=t,i=t.next;if(sh(e,s,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(th(e.x,e.y,s.x,s.y,i.x,i.y,n.x,n.y)&&sh(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ja(t,e,s,i){var n=t.prev,r=t,o=t.next;if(sh(n,r,o)>=0)return!1;for(var a=n.x<r.x?n.x<o.x?n.x:o.x:r.x<o.x?r.x:o.x,h=n.y<r.y?n.y<o.y?n.y:o.y:r.y<o.y?r.y:o.y,l=n.x>r.x?n.x>o.x?n.x:o.x:r.x>o.x?r.x:o.x,c=n.y>r.y?n.y>o.y?n.y:o.y:r.y>o.y?r.y:o.y,u=$a(a,h,e,s,i),d=$a(l,c,e,s,i),p=t.prevZ,f=t.nextZ;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&th(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&sh(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&th(n.x,n.y,r.x,r.y,o.x,o.y,f.x,f.y)&&sh(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&th(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&sh(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&th(n.x,n.y,r.x,r.y,o.x,o.y,f.x,f.y)&&sh(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Za(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!ih(n,r)&&nh(n,i,i.next,r)&&ah(n,r)&&ah(r,n)&&(e(n.i/s,i.i/s,r.i/s),ch(i.next),ch(i),i=t=r),i=i.next}while(i!==t);return Ga(i)}function Ya(t,e,s,i,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&eh(o,a)){var h=hh(o,a);return o=Ga(o,o.next),h=Ga(h,h.next),Wa(o,e,s,i,n,r),void Wa(h,e,s,i,n,r)}a=a.next}o=o.next}while(o!==t)}function Xa(t,e){return t.x-e.x}function Ja(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;var h,l=s,c=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=c&&n!==i.x&&th(r<u?n:o,r,c,u,r<u?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),ah(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&Qa(s,i)))&&(s=i,d=h)),i=i.next}while(i!==l);return s}(t,e);if(!s)return e;var i=hh(s,t),n=Ga(s,s.next);return Ga(i,i.next),e===e.next||e===s?n:e}function Qa(t,e){return sh(t.prev,t,e.prev)<0&&sh(e.next,t,t.next)<0}function $a(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ka(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function th(t,e,s,i,n,r,o,a){return(n-o)*(e-a)-(t-o)*(r-a)>=0&&(t-o)*(i-a)-(s-o)*(e-a)>=0&&(s-o)*(r-a)-(n-o)*(i-a)>=0}function eh(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&nh(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(ah(t,e)&&ah(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(sh(t.prev,t,e.prev)||sh(t,e.prev,e))||ih(t,e)&&sh(t.prev,t,t.next)>0&&sh(e.prev,e,e.next)>0)}function sh(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function ih(t,e){return t.x===e.x&&t.y===e.y}function nh(t,e,s,i){var n=oh(sh(t,e,s)),r=oh(sh(t,e,i)),o=oh(sh(s,i,t)),a=oh(sh(s,i,e));return n!==r&&o!==a||(!(0!==n||!rh(t,s,e))||(!(0!==r||!rh(t,i,e))||(!(0!==o||!rh(s,t,i))||!(0!==a||!rh(s,e,i)))))}function rh(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function oh(t){return t>0?1:t<0?-1:0}function ah(t,e){return sh(t.prev,t,t.next)<0?sh(t,e,t.next)>=0&&sh(t,t.prev,e)>=0:sh(t,e,t.prev)<0||sh(t,t.next,e)<0}function hh(t,e){var s=new uh(t.i,t.x,t.y),i=new uh(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function lh(t,e,s,i){var n=new uh(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ch(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t.next=t,t.prev=t}function uh(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class dh extends Ua{constructor(){super(...arguments),nt(this,"snapGeometryType",vi.MESH),nt(this,"lodType",Ra.AABB),nt(this,"maxVertexLength",xi),nt(this,"v0",new Jt),nt(this,"v1",new Jt),nt(this,"v2",new Jt),nt(this,"n1",new Jt),nt(this,"createGeometryPrototype",(()=>{const t=new Yo,e=new Xo;let s,i=0,n=0,r=0;const o=()=>{const t={objectType:vi.MESH,indexCount:3*r,positionCount:3*(i+n),normalCount:3*(i+n)};s?Array.isArray(s)?s.push(t):s=[s,t]:s=t,r=0,i=0,n=0};return a=>{if(0===a.profilesLength())return{objectType:vi.MESH};i=0,n=0,r=0,s=void 0;for(let s=0,h=a.profilesLength();s<h;s++){a.profiles(s,e);const h=e.indicesLength();n+=h;let l=!1;for(let e=0;e<a.holesLength();e++)a.holes(e,t),t.profile()===s&&(i+=t.indicesLength(),r+=t.indicesLength(),l&&(r+=2),l=!0);l?r+=e.indicesLength():e.indicesLength()>2&&(r+=e.indicesLength()-2),i+n+h>this.maxVertexLength&&o()}(r>0||i>0||n>0)&&o();const h=s;return s=void 0,h}})()),nt(this,"build",(()=>{const t=new Xo;let e,s=0;const i=[];let n,r;const o={vertex_count:0,index_count:0,vertex_length:0,uv_length:0,normal_length:0,normal_count:0},a=t=>{e=Array.isArray(t)?t[s]:t,e.indexBuffer=new Uint16Array(e.indexCount),e.positionBuffer=new Float32Array(e.positionCount),e.normalBuffer=new Int16Array(e.normalCount),o.vertex_count=0,o.index_count=0,o.vertex_length=0,o.uv_length=0,o.normal_length=0,o.normal_count=0,s++};return(h,l)=>{s=0,e=void 0,a(l),i.length=0,h instanceof Jo&&(this.getShellProfileNormals(h,i),n=this.getWiresForVertices(h));const c=this.getShellData(h,this.getVertexDataSize(this.geometryType)),u=this.buildHoles(h,i,n);for(let s=0,d=h.profilesLength();s<d;s++){h.profiles(s,t);const d=t.indicesArray();h instanceof Jo&&(r=this.getVertexAveragedNormals(d,s,i,n)),3!==t.indicesLength()||u.has(s)?4!==t.indicesLength()||u.has(s)?bh(d,c,r,s,this.geometryType,e,u,o):fh(d,c,r,s,this.geometryType,e,o):mh(d,c,r,this.geometryType,e,o),o.vertex_length/3+t.indicesLength()>this.maxVertexLength&&a(l)}e=void 0}})()),nt(this,"buildHoles",(()=>{const t=new Ro,e=new Yo,s=new Map;let i;return(n,r,o)=>{s.clear();for(let a=0,h=n.holesLength();a<h;a++){const h=n.holes(a,e).profile();if(s.has(h)){const t=s.get(h);t.indices.push(t.vertices.length/3),s.set(h,t)}else s.set(h,{indices:[0],vertices:[],normals:[]});const l=s.get(h);i=this.getVertexAveragedNormals(e.indicesArray(),h,r,o);for(let s=0,r=e.indicesLength();s<r;s++)this.geometryType===ea.Shell&&n instanceof Jo&&(n.vertices(e.indices(s),t),l.vertices.push(t.x(),t.y(),t.z()),l.normals.push(i[3*s],i[3*s+1],i[3*s+2]))}return s}})()),nt(this,"isCircularFace",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new Jt;let r;return(o,a,h,l)=>{let c;const u=h?h.indicesLength():l.length;for(let e=0;e<u;e++){const s=h?h.indices(e):l[e];if(this.getVertex(o,s,t),c){if(Math.abs(1-c/t.sub(a).length())>.01){r=!1;break}}else c=t.sub(a).length();e===u-1&&(r=!0)}if(r){if(u>50)return r;if(h)for(let a=0;a<u;a++){const l=h.indices(a),c=0===a?h.indices(u-1):h.indices(a-1),d=a===u-1?h.indices(0):h.indices(a+1);if(this.getVertex(o,l,t),this.getVertex(o,c,e),this.getVertex(o,d,s),Math.abs(1-i.subVectors(t,e).length()/n.subVectors(t,s).length())>.01){r=!1;break}}else for(let s=0;s<u;s++){const n=[];this.getVertex(o,l[s],t);for(let r=0;r<u;r++)r!==s&&(this.getVertex(o,l[r],e),n.push(i.subVectors(t,e).length()));if(n.sort(((t,e)=>t-e)),Math.abs(1-n[0]/n[1])>.01){r=!1;break}}}return r}})()),nt(this,"getFaceCenter",(()=>{const t=new Jt,e=new Jt;return(s,i,n)=>{const r=i?i.indicesLength():n.length;if(!(r<4)){t.set(0,0,0);for(let o=0;o<r;o++){const r=i?i.indices(o):n[o];this.getVertex(s,r,e),t.addVectors(t,e)}return t.multiplyScalar(1/r),t.clone()}}})()),nt(this,"isTubeLikeShape",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new Jt,r=new Jt,o=new Xo,a=new Ks,h=[],l=[],c=[],u=[],d=[];let p;return f=>{const m=this.getShell(f);l.length=0,c.length=0;for(let t=0,e=m.profilesLength();t<e;t++){if(m.profiles(t,o),o.indicesLength()<4)return!1;4===o.indicesLength()&&c.push(t),o.indicesLength()>4&&l.push(t)}if(0!==l.length&&2!==l.length||c.length<7)return!1;h.length=0,p=this.getWiresForVertices(m);for(let t=0,i=c.length;t<i;t++){m.profiles(c[t],o);for(let i=0,n=o.indicesLength();i<n;i++){const r=o.indices(i),a=i===n-1?o.indices(0):o.indices(i+1);this.getVertex(m,r,e),this.getVertex(m,a,s);const c=p.get(r).filter((t=>!l.includes(t))),u=p.get(a).filter((t=>!l.includes(t)));if(h.filter((t=>t.includes(r)&&t.includes(a))).length)continue;c.filter((t=>-1!==u.indexOf(t))).filter((e=>e!==t)).length&&h.push([r,a])}}this.getVertex(m,h[0][0],e),this.getVertex(m,h[0][1],s),n.subVectors(e,s).normalize();for(let t=1,i=h.length;t<i;t++){if(this.getVertex(m,h[t][0],e),this.getVertex(m,h[t][1],s),r.subVectors(e,s).normalize(),Math.abs(n.dot(r))<=.999)return!1;n.dot(r)<-.999&&(h[t]=[h[t][1],h[t][0]])}u.length=0,u.push(h[0][0]),u.push(h[1][0]),u.push(h[2][0]),this.getVertex(m,h[0][0],e),this.getVertex(m,h[1][0],s),this.getVertex(m,h[2][0],i),a.setFromCoplanarPoints(e,s,i);for(let e=3,s=h.length;e<s;e++)if(this.getVertex(m,h[e][0],t),u.push(h[e][0]),a.distanceToPoint(t)>.001)return!1;const b=this.getFaceCenter(m,void 0,u);if(!this.isCircularFace(m,b,void 0,u))return!1;d.length=0,d.push(h[0][1]),d.push(h[1][1]),d.push(h[2][1]),this.getVertex(m,h[0][1],e),this.getVertex(m,h[1][1],s),this.getVertex(m,h[2][1],i),a.setFromCoplanarPoints(e,s,i);for(let e=3,s=h.length;e<s;e++)if(this.getVertex(m,h[e][1],t),d.push(h[e][1]),a.distanceToPoint(t)>.001)return!1;const y=this.getFaceCenter(m,void 0,d);if(!this.isCircularFace(m,y,void 0,d))return!1;if(2===l.length){u.sort(((t,e)=>t-e)),d.sort(((t,e)=>t-e));for(const t of l){m.profiles(t,o);const e=Array.from(o.indicesArray()).sort(((t,e)=>t-e));if(!u.every(((t,s)=>e[s]===t))&&!d.every(((t,s)=>e[s]===t)))return!1}}return!0}})()),nt(this,"pickFace",(()=>{const t=new Ks,e=[],s=new Map,i=new Jt,n=new Jt,r=new Jt;return(o,a)=>{const h=this.getShell(o);e.length=0,s.clear();for(let t=0;t<h.holesLength();t++){const e=h.holes(t).profile();s.has(e)?s.get(e).push(t):s.set(h.holes(t).profile(),[t])}const l=this.getVertexDataSize(this.geometryType),c=this.getShellData(h,l);for(let o=0,u=h.profilesLength();o<u;o++){const u=h.profiles(o).indicesArray();this.v0.set(0,0,0),this.v1.set(0,0,0),this.v2.set(0,0,0),this.n1.set(0,0,0);if(3===u.length){let t=u[0],s=u[1],o=u[2];t*=l,s*=l,o*=l,i.set(c[t],c[t+1],c[t+2]),n.set(c[s],c[s+1],c[s+2]),r.set(c[o],c[o+1],c[o+2]);const h=this.intersectTriangle(a,i,n,r);h&&e.push(h);continue}const d=u[0]*l;if(this.v0.set(c[d],c[d+1],c[d+2]),gh(this.n1,c,u,l),t.setFromNormalAndCoplanarPoint(this.n1,this.v0),a.intersectPlane(t,this.v1)){if(s.has(o)){const e=s.get(o);if(this.insideHole(this.v1,t,e,h,c))continue}this.pointInsidePolygon(this.v1,c,u,l,t)&&e.push({point:this.v1.clone(),normal:t.normal.clone()})}}return e}})()),nt(this,"pickLine",(()=>{const t=new Xo,e=new Jt,s=new Jt,i=new Jt,n=[];let r;return(o,a,h)=>{const l=this.getShell(o);n.length=0,this.getShellProfileNormals(l,n),r=this.getWiresForVertices(l);const c=[];for(let o=0,u=l.profilesLength();o<u;o++){l.profiles(o,t);for(let u=0,d=t.indicesLength();u<d;u++){const p=t.indices(u),f=u===d-1?t.indices(0):t.indices(u+1);if(this.getVertex(l,p,e),this.getVertex(l,f,s),a.distanceSqToSegment(e,s,void 0,i),h.containsPoint(i)){const t=r.get(p),a=r.get(f),h=t.filter((t=>-1!==a.indexOf(t))).filter((t=>t!==o));if(h.length&&n[h[0]].dot(n[o])>Math.cos(Ua.pickableAngleInRadian))continue;c.push({point:i.clone(),normal:n[o],snapLineStart:e.clone(),snapLineEnd:s.clone()})}}}return c}})()),nt(this,"pickSectionLine",(()=>{const t=new Xo,e=new Jt,s=new Jt,i=new Jt,n=new gi,r=[];return(o,a,h,l)=>{const c=this.getShell(o),u=[];for(let o=0,d=c.profilesLength();o<d;o++){c.profiles(o,t),this.getVertex(c,t.indices(t.indicesLength()-1),s);for(const o of l){r.length=0;for(let a=0,h=t.indicesLength();a<h;a++)this.getVertex(c,t.indices(a),e),n.set(e,s),o.intersectsLine(n)&&(o.intersectLine(n,i),r.some((t=>t.equals(i)))||r.push(i.clone())),s.copy(e);2===r.length&&(a.distanceSqToSegment(r[0],r[1],void 0,i),h.containsPoint(i)&&u.push({point:i.clone(),snapLineStart:r[0].clone(),snapLineEnd:r[1].clone()}))}}return u}})()),nt(this,"pickSectionPoint",(()=>{const t=new Xo,e=new Jt,s=new Jt,i=new Jt,n=new gi,r=[];return(o,a,h)=>{const l=this.getShell(o),c=[];r.length=0;for(let o=0,a=l.profilesLength();o<a;o++){l.profiles(o,t),this.getVertex(l,t.indices(t.indicesLength()-1),s);for(const o of h)for(let a=0,h=t.indicesLength();a<h;a++)this.getVertex(l,t.indices(a),e),n.set(e,s),o.intersectsLine(n)&&(o.intersectLine(n,i),r.some((t=>t.equals(i)))||r.push(i.clone())),s.copy(e)}return r.forEach((t=>{a.containsPoint(t)&&c.push({point:t.clone()})})),c}})()),nt(this,"pickPoint",(()=>{const t=new Jt;return(e,s,i)=>{const n=this.getShell(e),r=[];for(let e=0,s=n.verticesLength();e<s;e++)this.getVertex(n,e,t),i.containsPoint(t)&&r.push({point:t.clone()});return r}})()),nt(this,"getShellProfileNormals",(()=>(t,e)=>{const s=t.profilesLength();for(let i=0;i<s;i++){const s=t.profiles(i);e.push(this.calculateWireNormal(t,s))}return e})()),nt(this,"calculateWireNormal",(()=>{const t=new Jt,e=new Jt,s=new Jt;return(i,n)=>{const r=n.indicesLength();if(i.verticesLength()<=2||r<=2)return new Jt(1,0,0);s.set(0,0,0);for(let o=0;o<r;o++){const a=(o+1)%r;this.getVertex(i,n.indices(o),t),this.getVertex(i,n.indices(a),e),s.x+=(t.y-e.y)*(t.z+e.z),s.y+=(t.z-e.z)*(t.x+e.x),s.z+=(t.x-e.x)*(t.y+e.y)}return s.clone().normalize()}})()),nt(this,"getWiresForVertices",(()=>{const t=new Xo,e=new Yo,s=new Map;return i=>{s.clear();const n=i.profilesLength();for(let e=0;e<n;e++){i.profiles(e,t);for(let i=0,n=t.indicesLength();i<n;i++){const n=t.indices(i);s.has(n)?s.get(n).push(e):s.set(n,[e])}}for(let t=0;t<i.holesLength();t++){const n=i.holes(t).profile();i.holes(t,e);for(let t=0,i=e.indicesLength();t<i;t++){const i=e.indices(t);s.has(i)?s.get(i).push(n):s.set(i,[n])}}return s}})()),nt(this,"getVertexAveragedNormals",(()=>{let t,e=new Jt;return(s,i,n,r)=>{(!t||t.length<3*s.length)&&(t=new Int16Array(3*s.length));const o=n[i];for(let i=0;i<s.length;i++){const a=r.get(s[i]);if(e.set(0,0,0),a&&a.length)if(1===a.length)e=n[a[0]].clone();else for(const t of a){const s=n[t];o.dot(s)>Ua.SMOOTH_LIMIT&&e.add(s)}else e.set(1,0,0);e.normalize().multiplyScalar(Ea),e.toArray(t,3*i)}return t}})()),nt(this,"getVertex",(()=>{const t=new Ro;return(e,s,i)=>{e instanceof Jo&&e.vertices(s,t),i.set(t.x(),t.y(),t.z())}})()),nt(this,"insideHole",(()=>(t,e,s,i,n)=>{for(let r=0,o=s.length;r<o;r++){const o=i.holes(s[r]).indicesArray();if(this.pointInsidePolygon(t,n,o,3,e))return!0}return!1})()),nt(this,"intersectTriangle",(()=>{const t=new ps,e=new Jt;return(s,i,n,r)=>{if(t.a=i,t.b=n,t.c=r,s.intersectTriangle(i,n,r,!1,e))return{point:e.clone(),normal:t.getNormal(new Jt)}}})()),nt(this,"pointInsidePolygon",(()=>{const t=new Jt,e=new Jt,s=new Jt;return(i,n,r,o,a)=>{this.createOrthonormalBasis(a.normal,e,t);const h=r.length,l=r[h-1]*o,c=s.set(n[l],n[l+1],n[l+2]).sub(i);let u=c.dot(t),d=c.dot(e),p=!1;for(let a=0;a<h;a++){const h=r[a]*o,l=s.set(n[h],n[h+1],n[h+2]).sub(i),c=l.dot(t),f=l.dot(e);f>0!=d>0&&(u-c)*-f/(d-f)+c>0&&(p=!p),u=c,d=f}return p}})())}getGeometries(t,e=!0){const s=this.getCachedGeometry(t);if((Array.isArray(s)&&!s[0].positionBuffer||!s.positionBuffer)&&e){const e=this.getShell(t);this.build(e,s),this.calculateMemSizeAndCache(t,s)}return s}getVertexDataSize(t){return 3}getShellData(t,e){const s=t.bb.__offset(t.bb_pos,8);return new Float32Array(t.bb.bytes().buffer,t.bb.__vector(t.bb_pos+s),t.verticesLength()*e)}pick(t,e,s){return this.pickFace(t,e)}createOrthonormalBasis(t,e,s){if(Math.abs(t.x)>=Math.abs(t.y)){const i=1/Math.sqrt(t.x*t.x+t.z*t.z);e.set(-t.z*i,0,t.x*i),s.set(t.y*e.z,t.z*e.x-t.x*e.z,-t.y*e.x)}else{const i=1/Math.sqrt(t.y*t.y+t.z*t.z);e.set(0,t.z*i,-t.y*i),s.set(t.y*e.z-t.z*e.y,-t.x*e.z,t.x*e.y)}e.normalize(),s.normalize()}}class ph extends dh{constructor(){super(...arguments),nt(this,"geometryType",ea.Shell),nt(this,"getShell",(()=>{const t=new Jo;return e=>this.geometry.shells(e,t)})())}setupGeometryTemplates(){for(let t=0,e=this.geometry.shellsLength();t<e;t++){const e=this.getShell(t);this.setGeometryPrototype(t,this.createGeometryPrototype(e))}}}const fh=(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new Jt,r=new Jt,o=new Jt,a=new Jt,h=new Jt;let l=0,c=0,u=0,d=0;return(p,f,m,b,y,g,x)=>{l=p[0],c=p[1],u=p[2],d=p[3],y===ea.Shell&&(l*=3,c*=3,u*=3,d*=3),t.set(f[l],f[l+1],f[l+2]),e.set(f[c],f[c+1],f[c+2]),s.set(f[u],f[u+1],f[u+2]),i.set(f[d],f[d+1],f[d+2]),n.copy(e),r.copy(s),o.copy(i),n.sub(t),r.sub(t),o.sub(t),a.crossVectors(n,r),h.crossVectors(r,o),a.dot(h)>0?(g.indexBuffer[x.index_count]=x.vertex_count,g.indexBuffer[x.index_count+1]=x.vertex_count+1,g.indexBuffer[x.index_count+2]=x.vertex_count+3,g.indexBuffer[x.index_count+3]=x.vertex_count+3,g.indexBuffer[x.index_count+4]=x.vertex_count+1,g.indexBuffer[x.index_count+5]=x.vertex_count+2,x.index_count+=6,g.positionBuffer[x.vertex_length]=t.x,g.positionBuffer[x.vertex_length+1]=t.y,g.positionBuffer[x.vertex_length+2]=t.z,g.positionBuffer[x.vertex_length+3]=e.x,g.positionBuffer[x.vertex_length+4]=e.y,g.positionBuffer[x.vertex_length+5]=e.z,g.positionBuffer[x.vertex_length+6]=s.x,g.positionBuffer[x.vertex_length+7]=s.y,g.positionBuffer[x.vertex_length+8]=s.z,g.positionBuffer[x.vertex_length+9]=i.x,g.positionBuffer[x.vertex_length+10]=i.y,g.positionBuffer[x.vertex_length+11]=i.z,g.normalBuffer[x.normal_length]=m[0],g.normalBuffer[x.normal_length+1]=m[1],g.normalBuffer[x.normal_length+2]=m[2],g.normalBuffer[x.normal_length+3]=m[3],g.normalBuffer[x.normal_length+4]=m[4],g.normalBuffer[x.normal_length+5]=m[5],g.normalBuffer[x.normal_length+6]=m[6],g.normalBuffer[x.normal_length+7]=m[7],g.normalBuffer[x.normal_length+8]=m[8],g.normalBuffer[x.normal_length+9]=m[9],g.normalBuffer[x.normal_length+10]=m[10],g.normalBuffer[x.normal_length+11]=m[11],x.normal_length+=12,x.vertex_count+=4,x.vertex_length+=12):bh(p,f,m,b,y,g,void 0,x)}})(),mh=(()=>(t,e,s,i,n,r)=>{let o=t[0],a=t[1],h=t[2];i===ea.Shell&&(o*=3,a*=3,h*=3),n.indexBuffer[r.index_count]=r.vertex_count,n.indexBuffer[r.index_count+1]=r.vertex_count+1,n.indexBuffer[r.index_count+2]=r.vertex_count+2,r.index_count+=3,n.positionBuffer[r.vertex_length]=e[o+0],n.positionBuffer[r.vertex_length+1]=e[o+1],n.positionBuffer[r.vertex_length+2]=e[o+2],n.positionBuffer[r.vertex_length+3]=e[a+0],n.positionBuffer[r.vertex_length+4]=e[a+1],n.positionBuffer[r.vertex_length+5]=e[a+2],n.positionBuffer[r.vertex_length+6]=e[h+0],n.positionBuffer[r.vertex_length+7]=e[h+1],n.positionBuffer[r.vertex_length+8]=e[h+2],n.normalBuffer[r.normal_length]=s[0],n.normalBuffer[r.normal_length+1]=s[1],n.normalBuffer[r.normal_length+2]=s[2],n.normalBuffer[r.normal_length+3]=s[3],n.normalBuffer[r.normal_length+4]=s[4],n.normalBuffer[r.normal_length+5]=s[5],n.normalBuffer[r.normal_length+6]=s[6],n.normalBuffer[r.normal_length+7]=s[7],n.normalBuffer[r.normal_length+8]=s[8],r.normal_length+=9,r.vertex_count+=3,r.vertex_length+=9})(),bh=(()=>{const t=new Jt;return(e,s,i,n,r,o,a,h)=>{const l=e.length,c=h.vertex_length;if(r===ea.Shell)for(let t=0;t<l;t++){const n=3*e[t];o.positionBuffer[h.vertex_length]=s[n],o.positionBuffer[h.vertex_length+1]=s[n+1],o.positionBuffer[h.vertex_length+2]=s[n+2],o.normalBuffer.set([i[3*t],i[3*t+1],i[3*t+2]],h.normal_length),h.vertex_count+=1,h.vertex_length+=3,h.normal_length+=3}let u;if(yh(o.positionBuffer,t,(h.vertex_length-c)/3,c),a&&a.has(n)){const t=a.get(n);u=t.indices.map((t=>t+l)),o.positionBuffer.set(t.vertices,h.vertex_length),h.vertex_length+=t.vertices.length,h.vertex_count+=t.vertices.length/3,o.normalBuffer.set(t.normals,h.normal_length),h.normal_length+=t.vertices.length}const d=new Float32Array(o.positionBuffer.buffer,4*c,h.vertex_length-c),p=function(t,e){const s=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(e.z);return n>s&&n>i?e.z>0?[0,1]:[1,0]:i>s&&i>n?e.y>0?[2,0]:[0,2]:e.x>0?[1,2]:[2,1]}(0,t);Na(d,u,3,p[0],p[1],((t,e,s)=>{o.indexBuffer[h.index_count++]=t+c/3,o.indexBuffer[h.index_count++]=e+c/3,o.indexBuffer[h.index_count++]=s+c/3}))}})(),yh=(t,e,s,i=0)=>{e.set(0,0,0);let n=0;for(let r=0,o=s;r<o;r++)n=(r+1)%s,e.x+=(t[i+3*r+1]-t[i+3*n+1])*(t[i+3*r+2]+t[i+3*n+2]),e.y+=(t[i+3*r+2]-t[i+3*n+2])*(t[i+3*r]+t[i+3*n]),e.z+=(t[i+3*r]-t[i+3*n])*(t[i+3*r+1]+t[i+3*n+1]);e.normalize()},gh=(t,e,s,i)=>{t.set(0,0,0);for(let n=0,r=s.length;n<r;n++){const o=(n+1)%r,a=s[n]*i,h=s[o]*i;t.x+=(e[a+1]-e[h+1])*(e[a+2]+e[h+2]),t.y+=(e[a+2]-e[h+2])*(e[a]+e[h]),t.z+=(e[a]-e[h])*(e[a+1]+e[h+1])}t.normalize()};class xh extends Ua{constructor(){super(...arguments),nt(this,"pickLine",(()=>{const t=[];return(e,s,i)=>{t.length=0;return this.pickLineWithCallback(e,s,((e,s,n,r,o)=>{i.containsPoint(s)&&t.push({point:s.clone(),distanceSqToRay:o,snapLineStart:n.clone(),snapLineEnd:r.clone()})})),t}})())}}function _h(t,e){const s=new Jt,i=new Jt,n=new Jt,r=new Jt,o=[],a=[];s.set(t.center().x(),t.center().y(),t.center().z()),i.set(t.axis().x(),t.axis().y(),t.axis().z()),n.set(t.refDirection().x(),t.refDirection().y(),t.refDirection().z());for(let r=0;r<e-2;r++)o[r]=new Jt,o[r].copy(n),o[r].applyAxisAngle(i,t.angle()*(r+1)/(e-1)),o[r].multiplyScalar(t.radius()),o[r].add(s);return r.copy(n),r.applyAxisAngle(i,t.angle()),r.multiplyScalar(t.radius()),r.add(s),n.multiplyScalar(t.radius()),n.add(s),a.push(n),a.push(...o),a.push(r),a}class wh extends xh{constructor(){super(...arguments),nt(this,"geometryType",ea.SweptDisk),nt(this,"snapGeometryType",vi.LINE),nt(this,"lodType",Ra.CUSTOM),nt(this,"sds",new Qo),nt(this,"directrix",new Wo),nt(this,"arc",new Uo),nt(this,"polyline",new Go),nt(this,"positionPointer"),nt(this,"indexPointer"),nt(this,"pointer",0),nt(this,"buildLineLOD",(()=>(t,e)=>{this.pointer=0,e.positionBuffer=new Float32Array(e.positionCount);for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.directrix);for(let t=0;t<i.indexesLength();t++)this.buildSegmentLineLOD(i,t,e)}return e})()),nt(this,"calculateSegmentSize",(()=>{const t={verticesLength:0,indicesLength:0};return(e,s,i)=>{const n=e.types(s),r=e.indexes(s);let o=0,a=0,h=0,l=0;switch(n){case aa.Line:o=2*i,a=6*i,h=2;break;case aa.PolyLine:{e.polyLines(r,this.polyline);const t=this.polyline.pointsLength()-1;o=2*t*i,a=6*t*i,h=2*t}break;case aa.Arc:{e.arcs(r,this.arc);const t=ma.arc3Divisions(this.arc);o=i*t,a=6*i*(t-1),h=2,l=2}}const c=h*(i-2)*3,u=l*i*6;return t.verticesLength=o,t.indicesLength=a+c+u,t}})()),nt(this,"arcCrossSections",[]),nt(this,"lineStart",new Jt),nt(this,"lineEnd",new Jt),nt(this,"lineQuaternion",new Xt),nt(this,"crossSectionPoints"),nt(this,"tmp",new Jt),nt(this,"getVertex",(()=>(t,e,s)=>s.set(e.positionBuffer[3*t],e.positionBuffer[3*t+1],e.positionBuffer[3*t+2]))()),nt(this,"getMatchCrossSectionPoint",(()=>{const t=new Jt,e=new Jt,s=new Jt,i=new Jt,n=new gi;let r,o,a;return(h,l,c)=>{o=1/0;for(let u=0;u<c;u++){r=0;for(let o=h;o<h+c;o++){this.getVertex(o,l,t);const a=o-c+u;this.getVertex(a>=h?a-c:a,l,e),this.getVertex(a+1>=h?a+1-c:a+1,l,s),n.set(e,s),n.closestPointToPoint(t,!0,i),r+=i.distanceTo(t)}r<o&&(o=r,a=h-c+u+1)}return a}})()),nt(this,"pick",(()=>{const t=[],e=new Qo,s=new Wo;return(i,n)=>{t.length=0,this.geometry.sweptDisks(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i);ma.traverseLines(s,((e,s)=>{t.push(...ma.cylinderHit(e,s,n,r))})),ma.traverseArcs(s,((e,s,i)=>{t.push(...ma.cylinderHit(e,s[0],n,r)),s.forEach(((e,i)=>{i>0&&t.push(...ma.cylinderHit(s[i-1],e,n,r))})),t.push(...ma.cylinderHit(s[s.length-1],i,n,r))}),ma.arc3Divisions),ma.traversePolylines(s,((e,s)=>{t.push(...ma.cylinderHit(e,s,n,r))}))}return t}})()),nt(this,"pickLine",(()=>{const t=[],e=new Qo,s=new Wo;return(i,n,r)=>{t.length=0;const o=(e,s,i,n,r)=>{t.push({point:s.clone(),distanceSqToRay:r,snapLineStart:i.clone(),snapLineEnd:n.clone()})};this.geometry.sweptDisks(i,e);for(let t=0,i=e.axesLength();t<i;t++){e.axes(t,s);const i=e.radius(t);Ih(s,n,o,i),Bh(s,n,ma.arc3Divisions,o,i),Th(s,n,o,i)}return t}})()),nt(this,"pickLineWithCallback",(()=>{const t=new Qo,e=new Wo;return(s,i,n)=>{this.geometry.sweptDisks(s,t);for(let s=0,r=t.axesLength();s<r;s++)t.axes(s,e),ma.linesPick(e,i,n),ma.arcPick(e,i,ma.arc3Divisions,n),ma.polyLinePick(e,i,n)}})()),nt(this,"pickPoint",(()=>{const t=[],e=new Qo,s=new Wo;return(i,n,r)=>{t.length=0,this.geometry.sweptDisks(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i),o=this.getCrossSectionsPointCount(r);this.updateCrossSectionsPoints(o),ma.traverseLines(s,((e,s)=>{this.tmp.copy(e).sub(s).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),t.push(ma.sectionHit(e,this.lineQuaternion,n,r)),t.push(ma.sectionHit(s,this.lineQuaternion,n,r))})),ma.traverseArcs(s,((e,s,i)=>{this.tmp.copy(e).sub(s[0]).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),t.push(ma.sectionHit(e,this.lineQuaternion,n,r)),this.tmp.copy(s[s.length-1]).sub(i).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),t.push(ma.sectionHit(i,this.lineQuaternion,n,r))}),ma.arc3Divisions),ma.traversePolylines(s,((e,s)=>{this.tmp.copy(e).sub(s).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),t.push(ma.sectionHit(e,this.lineQuaternion,n,r)),t.push(ma.sectionHit(s,this.lineQuaternion,n,r))}))}return t.filter((t=>void 0!==t))}})())}getCrossSectionsPointCount(t,e=200){const s=Math.round(t*e);return Math.min(Math.max(s,6),30)}getGeometries(t,e){const s=this.getCachedGeometryDatas(t);return e&&s.length&&!s[0].positionBuffer&&(this.geometry.sweptDisks(t,this.sds),this.build(this.sds,s),this.calculateMemSizeAndCache(t,s)),s}lodGeometry(t,e){const s=this.getCachedGeometryData(t,Si.Line);return e&&!s.positionBuffer&&(this.geometry.sweptDisks(t,this.sds),this.buildLineLOD(this.sds,s),this.calculateMemSizeAndCache(t,s,Si.Line)),s}buildSegmentLineLOD(t,e,s){const i=t.types(e),n=t.indexes(e);switch(i){case aa.Line:const e=t.lines(n),i=e.start(),r=e.end();s.positionBuffer[this.pointer]=i.x(),s.positionBuffer[this.pointer+1]=i.y(),s.positionBuffer[this.pointer+2]=i.z(),s.positionBuffer[this.pointer+3]=r.x(),s.positionBuffer[this.pointer+4]=r.y(),s.positionBuffer[this.pointer+5]=r.z(),this.pointer+=6;break;case aa.PolyLine:const o=t.polyLines(n);for(let t=1,e=o.pointsLength();t<e;t++)s.positionBuffer[this.pointer]=o.points(t-1).x(),s.positionBuffer[this.pointer+1]=o.points(t-1).y(),s.positionBuffer[this.pointer+2]=o.points(t-1).z(),s.positionBuffer[this.pointer+3]=o.points(t).x(),s.positionBuffer[this.pointer+4]=o.points(t).y(),s.positionBuffer[this.pointer+5]=o.points(t).z(),this.pointer+=6;break;case aa.Arc:const a=t.arcs(n),h=ma.arc3Divisions(a);this.arcCrossSections=_h(a,h);for(let t=1;t<h;t++)s.positionBuffer[this.pointer]=this.arcCrossSections[t-1].x,s.positionBuffer[this.pointer+1]=this.arcCrossSections[t-1].y,s.positionBuffer[this.pointer+2]=this.arcCrossSections[t-1].z,s.positionBuffer[this.pointer+3]=this.arcCrossSections[t].x,s.positionBuffer[this.pointer+4]=this.arcCrossSections[t].y,s.positionBuffer[this.pointer+5]=this.arcCrossSections[t].z,this.pointer+=6}}createLineLODPrototype(t){const e={objectType:vi.LINE,lod:Si.Line,lodThickness:0,positionCount:0};for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.directrix);for(let t=0;t<i.indexesLength();t++)this.calculateSegmentPositionLength(i,t,e);e.lodThickness=Math.max(e.lodThickness,t.radius(s))}return e}calculateSegmentPositionLength(t,e,s){const i=t.types(e),n=t.indexes(e);switch(i){case aa.Line:s.positionCount+=6;break;case aa.PolyLine:const e=t.polyLines(n,this.polyline).pointsLength()-1;s.positionCount+=6*e;break;case aa.Arc:const i=t.arcs(n,this.arc),r=ma.arc3Divisions(i);s.positionCount+=6*(r-1)}}setupGeometryTemplates(){for(let t=0,e=this.geometry.sweptDisksLength();t<e;t++)this.geometry.sweptDisks(t,this.sds),this.setGeometryPrototype(t,this.createGeometryPrototype(this.sds),Si.Full),this.setGeometryPrototype(t,this.createLineLODPrototype(this.sds),Si.Line)}createDirectrixPrototypes(t,e,s){const i=t.radius(e),n=t.axes(e,this.directrix),r=this.getCrossSectionsPointCount(i);let o=s[s.length-1];for(let t=0;t<n.indexesLength();t++){const e=this.calculateSegmentSize(n,t,r),i=!o;!i&&Sh(o.positionCount/3,e.verticesLength,r)||(o={objectType:vi.MESH,indexCount:0,positionCount:0,normalCount:0},s.push(o),i||0===t||(o.positionCount+=3*r,o.normalCount+=3*r,o.indexCount+=3*(r-2))),o.positionCount+=3*e.verticesLength,o.normalCount+=3*e.verticesLength,o.indexCount+=e.indicesLength}}createGeometryPrototype(t){const e=[];for(let s=0,i=t.axesLength();s<i;s++)this.createDirectrixPrototypes(t,s,e);return e}build(t,e){let s,i=0,n=0;const r={};for(let o=0,a=t.axesLength();o<a;o++){const a=t.radius(o),h=t.axes(o,this.directrix),l=this.getCrossSectionsPointCount(a);for(let t=0;t<h.indexesLength();t++){const o=this.calculateSegmentSize(h,t,l),c=!s;if(0===t&&(r.isStartSegment=!0),t===h.indexesLength()-1&&(r.isEndSegment=!0),c||!Sh(n,o.verticesLength,l)){s=e[i++],s.positionBuffer=new Float32Array(s.positionCount),s.normalBuffer=new Int16Array(s.normalCount),s.indexBuffer=new Uint16Array(s.indexCount);const r=this.positionPointer;if(this.positionPointer=0,this.indexPointer=0,n=0,!c&&0!==t){const t=e[i-2];this.copyLastCrossSection(t,s,r,l),n+=l}}this.buildDirectrixSegment(h,t,s,a,l,r),n+=o.verticesLength}}}copyLastCrossSection(t,e,s,i){for(let n=3*-i;n<0;++n)e.positionBuffer[this.positionPointer]=t.positionBuffer[s+n],e.normalBuffer[this.positionPointer]=t.normalBuffer[s+n],this.positionPointer++}buildDirectrixSegment(t,e,s,i,n,r){const o=t.types(e),a=t.indexes(e);switch(o){case aa.Line:this.buildLineSegment(t.lines(a),i,s,n,r);break;case aa.PolyLine:this.buildPolyLine(t.polyLines(a),i,s,n,r);break;case aa.Arc:this.buildArc(t.arcs(a),i,s,n,r)}r.isStartSegment=!1,r.isEndSegment=!1}buildPolyLine(t,e,s,i,n){for(let r=1,o=t.pointsLength();r<o;r++)this.lineStart.set(t.points(r-1).x(),t.points(r-1).y(),t.points(r-1).z()),this.lineEnd.set(t.points(r).x(),t.points(r).y(),t.points(r).z()),this.tmp.copy(this.lineEnd).sub(this.lineStart).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),this.buildCrossSection(this.lineStart,e,this.lineQuaternion,s,i),1===r?this.connectFirstCrossSection(s,i,n,this.lineStart,aa.PolyLine):this.buildCrossSectionIndices(s,i),this.buildCrossSection(this.lineEnd,e,this.lineQuaternion,s,i),r!==o-1||n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.lineEnd,n.type=aa.PolyLine),this.connectCrossSections(s,i)}connectFirstCrossSection(t,e,s,i,n){s.isStartSegment?this.buildCrossSectionIndices(t,e):Mh(s.type,n)&&vh(s.position,i)?this.connectCrossSections(t,e,!0):(this.buildCrossSectionIndices(t,e,!0,!0),this.buildCrossSectionIndices(t,e))}buildStartCrossSection(t,e,s,i,n){this.tmp.copy(e).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),this.buildCrossSection(t,s,this.lineQuaternion,i,n)}buildMidCrossSection(t,e,s,i,n,r){this.tmp.copy(s).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),this.buildCrossSection(e,i,this.lineQuaternion,n,r),this.connectCrossSections(n,r,!0)}buildEndCrossSection(t,e,s,i,n){this.tmp.copy(e).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),this.buildCrossSection(e,s,this.lineQuaternion,i,n)}buildArc(t,e,s,i,n){const r=ma.arc3Divisions(t);this.arcCrossSections=_h(t,r),this.buildStartCrossSection(this.arcCrossSections[0],this.arcCrossSections[1],e,s,i),this.connectFirstCrossSection(s,i,n,this.arcCrossSections[0],aa.Arc);for(let t=0;t<r-2;t++)this.buildMidCrossSection(this.arcCrossSections[t],this.arcCrossSections[t+1],this.arcCrossSections[t+2],e,s,i);this.buildEndCrossSection(this.arcCrossSections[r-2],this.arcCrossSections[r-1],e,s,i),n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.arcCrossSections[r-1],n.type=aa.Arc),this.connectCrossSections(s,i,!0)}buildLineSegment(t,e,s,i,n){const r=t.start(),o=t.end();this.lineStart.set(r.x(),r.y(),r.z()),this.lineEnd.set(o.x(),o.y(),o.z()),this.tmp.copy(this.lineEnd).sub(this.lineStart).normalize(),this.lineQuaternion.setFromUnitVectors(pa.up,this.tmp),this.buildCrossSection(this.lineStart,e,this.lineQuaternion,s,i),this.connectFirstCrossSection(s,i,n,this.lineStart,aa.Line),this.buildCrossSection(this.lineEnd,e,this.lineQuaternion,s,i),n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.lineEnd,n.type=aa.Line),this.connectCrossSections(s,i)}buildCrossSection(t,e,s,i,n){this.updateCrossSectionsPoints(n);for(let r=0;r<n;r++)this.tmp.copy(this.crossSectionPoints[r]).multiplyScalar(e).applyQuaternion(s).add(t),i.positionBuffer[this.positionPointer]=this.tmp.x,i.positionBuffer[this.positionPointer+1]=this.tmp.y,i.positionBuffer[this.positionPointer+2]=this.tmp.z,this.tmp.copy(this.crossSectionPoints[r]).applyQuaternion(s),i.normalBuffer[this.positionPointer]=this.tmp.x*Ea,i.normalBuffer[this.positionPointer+1]=this.tmp.y*Ea,i.normalBuffer[this.positionPointer+2]=this.tmp.z*Ea,this.positionPointer+=3}updateCrossSectionsPoints(t){if(!this.crossSectionPoints||this.crossSectionPoints.length!==t){this.crossSectionPoints=[];for(let e=0;e<t;e++){const s=2*Math.PI*e/t;this.crossSectionPoints.push(new Jt(Math.sin(s),Math.cos(s),0))}}}buildCrossSectionIndices(t,e,s=!1,i=!1){for(let n=0;n<e-2;n++)t.indexBuffer[this.indexPointer++]=this.positionPointer/3-e*(i?2:1),t.indexBuffer[this.indexPointer++]=this.positionPointer/3+n+(s?2:1)-e*(i?2:1),t.indexBuffer[this.indexPointer++]=this.positionPointer/3+n+(s?1:2)-e*(i?2:1)}connectCrossSections(t,e,s=!1){const i=this.positionPointer/3-e,n=i;let r=i-e;s&&(r=this.getMatchCrossSectionPoint(i,t,e));for(let s=0;s<e;s++){const o=(s+1)%e,a=r+s>=i?r+s-e:r+s,h=r+o>=i?r+o-e:r+o,l=n+s>=i+e?n+s-e:n+s,c=n+o>=i+e?n+o-e:n+o;t.indexBuffer[this.indexPointer++]=l,t.indexBuffer[this.indexPointer++]=c,t.indexBuffer[this.indexPointer++]=a,t.indexBuffer[this.indexPointer++]=a,t.indexBuffer[this.indexPointer++]=c,t.indexBuffer[this.indexPointer++]=h}}pickFace(t,e){}}const vh=(t,e)=>t.distanceToSquared(e)<1e-8,Mh=(t,e)=>t===aa.Arc||e===aa.Arc,Sh=(t,e,s)=>t+e+s<=xi,Ah=(()=>{const t=new Jt;return(e,s,i,n,r)=>{ma.cylinderHit(e,s,i,r).forEach((r=>{r.point&&(i.distanceSqToSegment(e,s,void 0,t),n(void 0,t,e,s,void 0))}))}})();function Ih(t,e,s,i){ma.traverseLines(t,((t,n)=>{Ah(t,n,e,s,i)}))}function Bh(t,e,s,i,n){ma.traverseArcs(t,((t,s,r)=>{Ah(t,s[0],e,i,n),s.forEach(((t,r)=>{r>0&&Ah(s[r-1],t,e,i,n)})),Ah(s[s.length-1],r,e,i,n)}),s)}function Th(t,e,s,i){ma.traversePolylines(t,((t,n)=>{Ah(t,n,e,s,i)}))}class zh{constructor(t,e){nt(this,"list",[]),nt(this,"interval"),this.modelId=t,this.messenger=e,this.interval=setInterval((()=>this.refresh()),50)}process(t){this.list.push(t),this.list.length>20&&this.refresh()}refresh(){if(0===this.list.length)return;const t={type:Ai.UPDATE_GEOMETRY,modelId:this.modelId,actions:this.list};this.list=[],this.messenger.fetch(t,zh.getData(t))}static getData(t){const e=[];for(const s of t.actions){if(s.actionType===Mi.ADD_BATCH){const t=s;t.positions&&e.push(t.positions.buffer),t.indices&&e.push(t.indices.buffer),t.normals&&e.push(t.normals.buffer),t.uvs&&e.push(t.uvs.buffer),t.pointUvs&&e.push(t.pointUvs.buffer),t.pointSizes&&e.push(t.pointSizes.buffer),t.ids&&e.push(t.ids.buffer)}if(s.actionType===Mi.ADD_BATCH||s.actionType===Mi.SET_BATCH_STATE){const t=s;t.state.visible&&(e.push(t.state.visible.starts.buffer),e.push(t.state.visible.counts.buffer)),t.state.hovered&&(e.push(t.state.hovered.starts.buffer),e.push(t.state.hovered.counts.buffer)),t.state.selected&&(e.push(t.state.selected.starts.buffer),e.push(t.state.selected.counts.buffer)),t.state.customMaterialRanges&&(e.push(t.state.customMaterialRanges.starts.buffer),e.push(t.state.customMaterialRanges.counts.buffer),e.push(t.state.customMaterialIds.buffer))}}return e}cleanUpRemainingTasks(){this.list=this.list.filter((t=>t.actionType!==Mi.UPDATE_FINISHED))}dispose(){clearInterval(this.interval)}}class Ch{constructor(t){nt(this,"pickPriorityMask",3<<Ii.PICK_PRIORITY),nt(this,"state"),nt(this,"customMaterialIds"),this.length=t,this.state=new Uint8Array(t),this.customMaterialIds=new Uint16Array(t)}initialize(){this.state.fill(1<<Ii.VISIBILITY)}isVisible(t){return this.is(t,Ii.VISIBILITY)}isSelected(t){return this.is(t,Ii.SELECTION)}isHovered(t){return this.is(t,Ii.HOVER)}is(t,e){const s=1<<e;return!!(this.state[t]&s)}set(t,e,s){const i=1<<e;this.state[t]=s?this.state[t]|i:this.state[t]&~i}getPickPriority(t){return(this.state[t]&this.pickPriorityMask)>>Ii.PICK_PRIORITY}resetVisibility(){for(let t=0,e=this.state.length;t<e;t++)this.setVisible(t,!0)}setPickPriority(t,e){const s=e<<Ii.PICK_PRIORITY,i=this.state[t];this.state[t]=i&~this.pickPriorityMask|s}resetPickPriority(){for(let t=0,e=this.state.length;t<e;t++)this.setPickPriority(t,_i.NORMAL)}setVisible(t,e){this.set(t,Ii.VISIBILITY,e)}setSelected(t,e){this.set(t,Ii.SELECTION,e)}setHovered(t,e){this.set(t,Ii.HOVER,e)}clearSelection(){for(let t=0,e=this.state.length;t<e;t++)this.setSelected(t,!1)}resetHovered(){for(let t=0,e=this.state.length;t<e;t++)this.setHovered(t,!1)}resetMaterialIds(){this.customMaterialIds.fill(0)}setCustomMaterialId(t,e){if(e>65535)throw new Error("Material ID 16 bit overflow");this.customMaterialIds[t]=e}getCustomMaterialId(t){return this.customMaterialIds[t]}}class Ph{constructor(t,e,s,i,n,r,o){nt(this,"virtualGeometries",new Map),nt(this,"geometries"),nt(this,"meshConnection"),nt(this,"virtualCamera"),nt(this,"virtualPlanes"),nt(this,"lastCameraRotation",new Jt),nt(this,"lastCameraLocation",new Jt),nt(this,"updatedInstances",0),nt(this,"currentInstance",0),nt(this,"allInstancesUpdated",!1),nt(this,"instancesData"),nt(this,"tempInstance",new Ho),nt(this,"tempRepresentation",new Zo),nt(this,"instanceCount"),nt(this,"instancesByDimension"),nt(this,"validator",new ya),nt(this,"dimensionInPixels",(()=>{let t,e;return(s,i)=>{let n;this.virtualCamera.orthoSize?n=this.virtualCamera.orthoSize:(this.virtualCamera.fieldOfView!==e&&(t=this.getWorldSizeOfPerspective(this.virtualCamera.fieldOfView,1),e=this.virtualCamera.fieldOfView),n=t*i);return s/n*this.virtualCamera.resolution}})()),nt(this,"instanceTemplate",(()=>{const t=new Ie,e=new Kt,s={};return(i,n,r)=>(ca.get(n,this.geometries,t),ca.getBBox(r,e),s.instance=i,s.material=this.materialMap[n.materialId()],s.transform=t,s.aabb=e,delete s.geometries,s)})()),nt(this,"pick",(()=>{const t=[];return(e,s,i,n,r,o)=>{t.length=0;const a=e.type(),h=e.index(),l=this.virtualGeometries.get(a);if(void 0===l)return[];try{const e=i===wi.POINT?l.pickPoint(h,n,r):i===wi.LINE?l.pickLine(h,n,r):i===wi.FACE?l.pickFace(h,n,r):void 0===i?l.pick(h,n,r):void 0;e&&e.length&&t.push(...e),this.pickClippedGeometry(l,h,i,n,r,o,t);for(const e of t)e.snapGeometryType=l.snapGeometryType;return t}catch(t){this.manageError(t)}}})()),this.modelId=t,this.connection=e,this.model=s,this.aabbController=i,this.itemsData=n,this.propertyController=r,this.materialMap=o,this.meshConnection=new zh(t,e),this.geometries=s.geometries(),this.instanceCount=this.geometries.instancesLength(),this.instancesData=new Ch(this.instanceCount),this.instancesByDimension=new Int32Array(this.instanceCount),this.setupVirtualGeometries(),this.orderInstancesByDimension()}get currentGeometryData(){return{starts:new Uint32Array([0]),counts:new Uint32Array([4294967295])}}setupVirtualGeometries(){this.setupVirtualGeometry(new ph(this.modelId,this.geometries)),this.setupVirtualGeometry(new wh(this.modelId,this.geometries))}async setupGeometryTemplates(){for(const t of this.virtualGeometries.values())await t.setupGeometryTemplates()}setupVirtualGeometry(t){this.virtualGeometries.set(t.geometryType,t)}orderInstancesByDimension(){for(let t=0;t<this.instanceCount;t++)this.instancesByDimension[t]=t;this.instancesByDimension.sort(((t,e)=>this.aabbController.size(e)-this.aabbController.size(t)))}update(t){try{if(this.updatedInstances<this.instanceCount&&this.virtualCamera)for(let e=0;e<this.instanceCount&&(performance.now()-t<10||e<50);e++)this.updateGeometry(this.instancesByDimension[this.currentInstance]),this.currentInstance++,this.currentInstance>=this.instanceCount&&(this.currentInstance=0),this.updatedInstances++;this.updatedInstances>=this.instanceCount&&!this.allInstancesUpdated&&(this.meshConnection.process({actionType:Mi.UPDATE_FINISHED,modelId:this.modelId}),this.allInstancesUpdated=!0)}catch(t){this.manageError(t)}}updateInstance(t,e,s=!1){const i=this.itemId(t),n=this.itemsData.isVisible(i),r=this.instancesData.isVisible(t),o=this.itemsData.isSelected(i),a=this.instancesData.isSelected(t),h=this.itemsData.isHovered(i),l=this.instancesData.isHovered(t),c=this.itemsData.getCustomMaterialId(i),u=this.instancesData.getCustomMaterialId(t);(n!==r||o!==a||h!==l||c!==u||s)&&this.setInstanceData(t,n,o,h,c,e)}visible(t){return this.cameraVisible(t)&&this.dataVisible(t)}cameraVisible(t){const e=this.aabbController.getTransformedAABB(t);return this.planesVisible(e)&&this.distanceVisible(t,e)}planesVisible(t){return oo.isHitting(this.virtualPlanes,t)}distanceVisible(t,e){const s=this.aabbController.size(t),i=e.distanceToPoint(this.virtualCamera.position),n=this.dimensionInPixels(s,i);return s>2?n>5:n>20}dataVisible(t){return this.geometries.instances(t,this.tempInstance),this.itemsData.isVisible(this.tempInstance.itemId())}setupVirtualCamera(t){this.virtualCamera=t,Ua.maxCacheSize=t.settings.geometryCacheSize,this.updateAll(),this.resetCurrentInstance(),this.virtualCamera.clipPlanes?(this.virtualPlanes=[...this.virtualCamera.frustum.planes],this.virtualPlanes.push(...this.virtualCamera.clipPlanes)):this.virtualPlanes=this.virtualCamera.frustum.planes}resetCurrentInstance(){const t=this.virtualCamera.frustum.planes[4].normal;t.angleTo(this.lastCameraRotation)>10*Tt&&(this.currentInstance=0,this.lastCameraRotation.copy(t)),this.virtualCamera.position.distanceToSquared(this.lastCameraLocation)>400&&(this.currentInstance=0,this.lastCameraLocation.copy(this.virtualCamera.position))}updateAll(){this.allInstancesUpdated=!1,this.updatedInstances=0,this.meshConnection.cleanUpRemainingTasks()}updateAllVirtualData(t){if(t&&this.virtualCamera)for(const e of t){const t=this.aabbController.getItemInstanceIds(e);if(t)for(const e of t)this.updateGeometry(e)}this.updateAll()}transformItem(t,e){for(let e=0;e<this.instanceCount&&(this.geometries.instances(e,this.tempInstance),this.tempInstance.itemId()!==t);e++);const s=this.geometries.localTransforms(this.tempInstance.localTransformId()),i=ca.parseTransform(s,new Ie);e.multiply(i.invert()),ca.set(t,this.geometries,e);for(let e=0;e<this.instanceCount;e++)this.tempInstance.itemId()===t&&this.aabbController.computeTransformedAABB(e)}geometryId(t,e,s){return this.validator.reset().append(t).append(e).append(s).value()}updateGeometry(t){this.visible(t)?this.instancesData.isVisible(t)?this.updateInstance(t,0):this.makeInstanceVisible(t,0):this.instancesData.isVisible(t)&&this.makeInstanceInvisible(t,0)}makeInstanceVisible(t,e){const s=this.fetchGeometry(t,e);if(s.geometries){const i=this.itemId(t),n=this.itemsData.isVisible(i),r=this.itemsData.isSelected(i),o=this.itemsData.isHovered(i),a=this.itemsData.getCustomMaterialId(i),h=this.newTileData(t,n,r,o,a);Ma(s.geometries,((n,r)=>{this.addTile(this.geometryId(t,r,e),n,void 0,s.material,s.transform,s.aabb,h,e,i,!0)}))}}geometryData(t,e,s,i){return t.lodType===Ra.CUSTOM&&i===Si.Line?t.lodGeometry(e,s):t.getGeometries(e,s)}fetchGeometry(t,e){this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation);const s=this.instanceTemplate(t,this.tempInstance,this.tempRepresentation),i=this.virtualGeometries.get(this.tempRepresentation.type());if(i)try{s.geometries=this.geometryData(i,this.tempRepresentation.index(),!0,e)}catch(t){this.manageError(t)}return s}instancePlacement(t){this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation);return this.instanceTemplate(t,this.tempInstance,this.tempRepresentation).transform}setInstanceData(t,e,s,i,n,r){const o=this.newTileData(t,e,s,i,n),a=this.geometries.instances(t,this.tempInstance).representationId();this.geometries.representations(a,this.tempRepresentation);Ma(this.geometryData(this.virtualGeometries.get(this.tempRepresentation.type()),this.tempRepresentation.index(),!1,r),((e,s)=>{this.connectGeometryData(this.geometryId(t,s,r),e.objectType,this.materialMap[this.tempInstance.materialId()],o,r)}))}newTileData(t,e,s,i,n){return this.instancesData.setVisible(t,e),this.instancesData.setSelected(t,s),this.instancesData.setHovered(t,i),this.instancesData.setCustomMaterialId(t,n),{visible:e&&0===n?this.currentGeometryData:void 0,selected:s?this.currentGeometryData:void 0,hovered:i?this.currentGeometryData:void 0,customMaterialRanges:0!==n?this.currentGeometryData:void 0,customMaterialIds:0!==n?new Uint16Array([n]):void 0}}itemId(t){return this.geometries.instances(t,this.tempInstance).itemId()}connectGeometryData(t,e,s,i,n){this.meshConnection.process({actionType:Mi.SET_BATCH_STATE,modelId:this.modelId,batchId:t,objectType:e,materialId:s,state:i,lodLevel:n})}addTile(t,e,s,i,n,r,o,a,h,l=!1){const c=l&&e.positionBuffer?new Float32Array(e.positionBuffer):e.positionBuffer,u=l&&e.normalBuffer?new Int16Array(e.normalBuffer):e.normalBuffer,d=l&&e.indexBuffer?e.indexBuffer.slice():e.indexBuffer,p=l&&s?new Float32Array(s):s;this.meshConnection.process({actionType:Mi.ADD_BATCH,modelId:this.modelId,objectType:e.objectType,batchId:t,userData:{id:t,itemId:h},state:o,indices:d,positions:c,normals:u,ids:p,materialId:i,transform:n.clone(),boundingBox:r.clone(),lodLevel:a})}makeInstanceInvisible(t,e){this.instancesData.setVisible(t,!1);const s=this.geometries.instances(t,this.tempInstance).representationId();this.geometries.representations(s,this.tempRepresentation);Ma(this.geometryData(this.virtualGeometries.get(this.tempRepresentation.type()),this.tempRepresentation.index(),!1,e),((s,i)=>{this.deleteGeometry(this.geometryId(t,i,e))}))}deleteGeometry(t){this.meshConnection.process({actionType:Mi.REMOVE_BATCH,modelId:this.modelId,batchId:t,userData:{id:t}})}isMesh(t){return this.virtualGeometries.has(t)&&(this.virtualGeometries.get(t).snapGeometryType===vi.MESH||t===ea.SweptDisk)}pickClippedGeometry(t,e,s,i,n,r,o){const a=t;r.length&&a.pickSectionLine&&(s===wi.LINE&&o.push(...a.pickSectionLine(e,i,n,r)),s===wi.POINT&&o.push(...a.pickSectionPoint(e,n,r)))}manageError(t){console.error(t),this.connection.fetch({type:Ai.ERROR,modelId:this.modelId,errorMessage:t.toString(),stackTrace:t.stack})}linePick(t,e){let s;this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation);const i=this.virtualGeometries.get(this.tempRepresentation.type());if(i instanceof xh){let t=1/0;return i.pickLineWithCallback(this.tempRepresentation.index(),e,((e,i,n,r,o)=>{s||(s={point:void 0}),o<t&&(t=o,s.point=i.clone(),s.snapLineStart=n.clone(),s.snapLineEnd=r.clone())})),s}}getItemsThatHaveGeometry(){const t=new Set;for(let e=0;e<this.instanceCount;e++)this.geometries.instances(e,this.tempInstance),t.add(this.tempInstance.itemId());return Array.from(t)}dispose(){this.meshConnection.dispose();for(const t of this.virtualGeometries.values())t.dispose()}getWorldSizeOfPerspective(t,e){return Math.tan(.5*t*Tt)*e}}let Fh=0;const Lh=class t extends Ph{constructor(e,s,i,n,r,o,a){super(e,s,i,n,r,o,a),nt(this,"tileSize"),nt(this,"tiles",new Map),nt(this,"instanceToTileId"),nt(this,"instanceToLodTileId"),nt(this,"tilesToUpdate",new Set),nt(this,"tileCodeToClusterSize",new Map),nt(this,"tempVector",new Jt),nt(this,"tempMatrix",new Ie),nt(this,"instanceSupportsLod"),nt(this,"instanceToLod"),nt(this,"instanceToLodWidth"),nt(this,"createLod",(()=>{const t={objectType:vi.LINE,positionCount:6,positionBuffer:new Float32Array(6)};return e=>{const s=ca.getBBoxSize(e);return s.start.toArray(t.positionBuffer,0),s.end.toArray(t.positionBuffer,3),t}})()),nt(this,"getTileCode",(()=>{const e=new Jt;return(s,i,n,r)=>{const o=this.aabbController.getTransformedAABB(s);o.getCenter(e);const a=r===Si.Full?this.tileSize:10*this.tileSize,h=t.getDimensionClassification(o);return this.validator.reset().append(n.objectType).append(i).append(e.x-e.x%a).append(e.y-e.y%a).append(e.z-e.z%a).append(h).append(r),this.validator.value()}})()),nt(this,"lodTileAppendInstance",(()=>{const e={objectType:vi.LINE,positionCount:6};return(s,i)=>{const n=this.getTileCode(s,i,e,Si.Line);let r=this.tiles.get(n);return r||(r=this.newTile(e.objectType,i,Si.Line),this.tiles.set(n,r)),t.tileAppend(r,e,s,0),n}})()),this.instanceSupportsLod=new Uint8Array(this.instanceCount),this.instanceToLod=new Uint8Array(this.instanceCount),this.instanceToLodWidth=new Float32Array(this.instanceCount);const h=new Kt,l=new Jt;for(let t=0;t<this.instanceCount;t++)this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation),this.instanceSupportsLod[t]=this.geometrySupportsLod(this.tempRepresentation.type()),this.instanceToLod[t]=Si.Hidden,ca.getBBox(this.tempRepresentation,h),h.getSize(l),l.x>l.y&&l.set(l.y,l.x,l.z),l.y>l.z&&l.set(l.x,l.z,l.y),l.x>l.y&&l.set(l.y,l.x,l.z),this.instanceToLodWidth[t]=l.y;this.tileSize=this.computeTileSize(),this.instanceToTileId=new Array(this.instanceCount),this.instanceToLodTileId=new Array(this.instanceCount)}geometrySupportsLod(t){const e=this.virtualGeometries.get(t);return e?e.lodType:Ra.NONE}fetchGeometry(t,e){if(e===Si.Line){this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation);if(this.virtualGeometries.get(this.tempRepresentation.type()).lodType===Ra.AABB){const e=this.instanceTemplate(t,this.tempInstance,this.tempRepresentation);return e.geometries=this.createLod(e.aabb),e}}return super.fetchGeometry(t,e)}updateGeometry(t){let e=this.lodLevel(t);const s=this.instanceToLod[t];if(e===Si.Line&&this.instancesData.getCustomMaterialId(t)&&(e=Si.Hidden),e===s)return void(e!==Si.Hidden&&this.updateInstance(t,e));s!==Si.Hidden&&this.makeInstanceInvisible(t,s);const i=e!==Si.Hidden;i&&this.makeInstanceVisible(t,e),this.instancesData.setVisible(t,i),this.instanceToLod[t]=e}updateInstance(t,e){const s=this.instanceToLod[t];super.updateInstance(t,e,e!==s)}lodLevel(t){const e=this.aabbController.getTransformedAABB(t);if(!this.planesVisible(e))return Si.Hidden;const s=this.lodLevelAccordingToCamera(t,e);return s!==Si.Hidden&&this.dataVisible(t)?s:Si.Hidden}lodLevelAccordingToCamera(t,e){const s=this.virtualCamera.settings.lodSetting,i=this.aabbController.size(t),n=e.distanceToPoint(this.virtualCamera.position),r=this.dimensionInPixels(i,n);if(this.virtualCamera.xr)return i<2&&r<40||i>=2&&r<2?Si.Hidden:Si.Full;if(i<2&&r<5*s)return Si.Hidden;if(i<2&&r<15*s&&this.instanceSupportsLod[t]===Ra.NONE)return Si.Hidden;if(i>=2&&r<2*s)return Si.Hidden;if(this.instanceSupportsLod[t]===Ra.NONE)return Si.Full;if(i<2&&r<15*s)return Si.Line;if(i>=2&&r<5*s)return Si.Line;const o=this.instanceToLodWidth[t];return this.dimensionInPixels(o,n)<Math.max(4*s,4)?Si.Line:Si.Full}async setupGeometryTemplates(){await super.setupGeometryTemplates(),await this.generateTiles()}async update(t){await super.update(t),this.postTilesData()}makeInstanceVisible(t,e){this.updateInstance(t,e)}makeInstanceInvisible(t,e){const s=this.getTileIds(t,e);void 0!==s&&Ma(s,(e=>this.makeInvisibleFromTile(e,t)))}getTileIds(t,e){return e===Si.Full?this.instanceToTileId[t]:this.instanceToLodTileId[t]}setInstanceData(t,e,s,i,n,r){this.instancesData.setVisible(t,!0),this.instancesData.setHovered(t,i),this.instancesData.setSelected(t,s),this.instancesData.setCustomMaterialId(t,n);const o=i,a=n,h=0===n,l=s,c=this.getTileIds(t,r);void 0!==c&&Ma(c,(e=>{this.updateTile(e,t,a,h,o,l)}))}updateTile(e,s,i,n,r,o){const a=this.tiles.get(e),h=a.instanceToIndex.get(s);a.visibilities.update(h,n),a.hovers.update(h,r),a.selections.update(h,o),a.materials.update(h,i),a.notVirtual?this.tilesToUpdate.add(e):(this.constructTile(a),this.loadTile(e,a),a.notVirtual=!0,t.emptyTileMemory(a))}makeInvisibleFromTile(t,e){const s=this.tiles.get(t),i=s.instanceToIndex.get(e);s.visibilities.update(i,!1),s.hovers.update(i,!1),s.selections.update(i,!1),s.materials.update(i,0),s.visibilities.allContain(!1)&&s.materials.allContain(0)&&Fh>this.virtualCamera.settings.gpuMemoryUsage?(this.deleteGeometry(t),s.notVirtual=!1,Fh-=s.usedMemory):this.tilesToUpdate.add(t)}computeTileSize(){const t=this.aabbController.modelAABB.getSize(this.tempVector);return Math.max(40,Math.ceil(Math.max(t.x,t.y,t.z)/8))}postTilesData(){for(const e of this.tilesToUpdate){const s=this.tiles.get(e),i=t.getTileState(s);this.connectGeometryData(e,s.objectType,s.materialId,i,s.lod)}this.tilesToUpdate.clear()}newTileId(t,e,s){s.positionCount/3>xi&&console.warn(`Geometry of instance ${t} does not fit in 16-bit index (position size ${s.positionCount}), and will be truncated.`);const i=this.getTileCode(t,e,s,void 0===s.lod?Si.Full:s.lod),n=this.tileCodeToClusterSize.get(i)||1;let r=i+n-1;const o=this.tiles.get(r);return(o?o.positionCount:0)+s.positionCount>xi&&(r++,this.tileCodeToClusterSize.set(i,n+1)),r}newTile(t,e,s){return{lod:s,objectType:t,materialId:e,indexCount:0,positionCount:0,normalCount:0,notVirtual:!1,aabb:new Kt,instanceCount:0,instanceToIndex:new Map,geometriesIndex:[],indexPositions:[],vertexPositions:[]}}static tileAppend(t,e,s,i){t.instanceToIndex.set(s,t.instanceCount),t.instanceCount++,t.geometriesIndex.push(i),t.indexPositions.push(t.indexCount||0),t.vertexPositions.push((t.positionCount||0)/3),e.indexCount&&(t.indexCount+=e.indexCount),e.positionCount&&(t.positionCount+=e.positionCount),e.normalCount&&(t.normalCount+=e.normalCount),void 0!==e.materialId&&(t.materialId=e.materialId)}tileAppendInstance(e,s,i){let n;return Ma(i,((i,r)=>{const o=this.newTileId(e,s,i);void 0===n?n=o:"number"==typeof n?n!==o&&(n=[n,o]):n.includes(o)||n.push(o);let a=this.tiles.get(o);a||(a=this.newTile(i.objectType,s,void 0===i.lod?Si.Full:i.lod),this.tiles.set(o,a)),t.tileAppend(a,i,e,r)})),n}generateTiles(){for(let t=0;t<this.instanceCount;++t){this.geometries.instances(t,this.tempInstance),this.geometries.representations(this.tempInstance.representationId(),this.tempRepresentation);const e=this.materialMap[this.tempInstance.materialId()],s=this.virtualGeometries.get(this.tempRepresentation.type());if(!s)continue;const i=this.geometryData(s,this.tempRepresentation.index(),!1,Si.Full);if(this.instanceToTileId[t]=this.tileAppendInstance(t,e,i),s.lodType===Ra.AABB)this.instanceToLodTileId[t]=this.lodTileAppendInstance(t,e);else if(s.lodType===Ra.CUSTOM){const i=this.geometryData(s,this.tempRepresentation.index(),!1,Si.Line);this.instanceToLodWidth[t]=i.lodThickness,this.instanceToLodTileId[t]=this.tileAppendInstance(t,e,i)}}for(const t of this.tiles.values())t.visibilities=new xa(t.instanceCount,!1),t.hovers=new xa(t.instanceCount,!1),t.selections=new xa(t.instanceCount,!1),t.materials=new xa(t.instanceCount,0)}constructTile(e){e.positionBuffer||t.setupTileBuffers(e);const s=!e.position;for(const[t,i]of e.instanceToIndex){const n=this.fetchGeometry(t,e.lod);n&&n.geometries&&(this.tileLoadInstance(e,n,e.geometriesIndex[i]),s&&this.extendTileAABB(e,t))}}tileLoadInstance(t,e,s){const i=t.instanceToIndex.get(e.instance),n=Array.isArray(e.geometries)?e.geometries[s]:e.geometries;n.positionBuffer||console.log("hey"),t.position||(t.position=(new Jt).fromArray(n.positionBuffer).applyMatrix4(e.transform));const r=this.tempVector.copy(t.position).negate();if(this.tempMatrix.identity().setPosition(r).multiply(e.transform),this.applyTransformToPositions(this.tempMatrix,n.positionBuffer,t.positionBuffer,3*t.vertexPositions[i],n.positionBuffer.length),t.normalBuffer&&this.applyTransformToNormals(this.tempMatrix,n.normalBuffer,t.normalBuffer,3*t.vertexPositions[i],n.normalBuffer.length),t.indexBuffer){const e=t.indexPositions[i],s=t.vertexPositions[i];for(let i=0;i<n.indexCount;i++)t.indexBuffer[i+e]=n.indexBuffer[i]+s}n.objectType===vi.MESH&&t.ids.fill(this.itemId(e.instance),t.vertexPositions[i],t.vertexPositions[i]+n.positionCount/3)}extendTileAABB(t,e){const s=this.aabbController.getTransformedAABB(e),i=this.tempVector.copy(t.position).negate();s.translate(i),t.aabb.union(s)}applyTransformToPositions(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.tempVector.fromArray(e,r),this.tempVector.applyMatrix4(t),this.tempVector.toArray(s,i+r)}applyTransformToNormals(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.tempVector.fromArray(e,r),this.tempVector.transformDirection(t),this.tempVector.multiplyScalar(Ea),this.tempVector.toArray(s,i+r)}loadTile(e,s){const i=t.getTileState(s);s.position&&this.tempMatrix.identity().setPosition(s.position),this.addTile(e,s,s.ids,s.materialId,this.tempMatrix,s.aabb,i,s.lod),Fh+=s.usedMemory}static getDimensionClassification(t){const e=t.min.distanceToSquared(t.max);return e<.25?0:e<4?1:2}static setupTileBuffers(t){t.positionBuffer=new Float32Array(t.positionCount),t.usedMemory=t.positionBuffer.byteLength,t.indexCount>0&&(t.indexBuffer=new Uint16Array(t.indexCount),t.usedMemory+=t.indexBuffer.byteLength),t.normalCount>0&&(t.normalBuffer=new Int16Array(t.normalCount),t.usedMemory+=t.normalBuffer.byteLength),t.objectType===vi.MESH&&(t.ids=new Float32Array(t.positionCount/3),t.usedMemory+=t.ids.byteLength)}static emptyTileMemory(t){delete t.indexBuffer,delete t.positionBuffer,delete t.normalBuffer,delete t.ids}};nt(Lh,"getTileState",(()=>t=>{const e=t.indexCount?t.indexPositions:t.vertexPositions,s=t.visibilities.allContain(!1)?void 0:xa.get(t.visibilities,e,(t=>t)),i=t.hovers.allContain(!1)?void 0:xa.get(t.hovers,e,(t=>t)),n=t.selections.allContain(!1)?void 0:xa.get(t.selections,e,(t=>t));let r,o;const a=t.materials.size((t=>0!==t));return a>0&&(o=new Uint16Array(a),r=xa.get(t.materials,e,(t=>0!==t),((t,e)=>{o[t]=e}))),{visible:s,hovered:i,selected:n,customMaterialRanges:r,customMaterialIds:o}})());let kh=Lh;class Oh{constructor(t,e){nt(this,"materials"),this.modelId=t,this.onTransfer=e,this.materials=[]}get(t){return this.materials[t]}update(t){const e=[],s=t.geometries(),i=s.materialsLength();for(let t=0;t<i;t++){const i=s.materials(t),n={color:new gs(i.r()/255,i.g()/255,i.b()/255),side:i.sidedness(),lineType:i.lineType(),opacity:i.a()/255,transparent:i.a()<255};e.push(n)}return this.transfer(e)}transfer(t){const e=[],s=[];t:for(const i of t){for(let t=0,s=this.materials.length;t<s;t++)if(this.isSameMaterial(i,this.materials[t])){e.push(t);continue t}this.materials.push(i),s.push(i),e.push(this.materials.length-1)}return this.onTransfer({type:Ai.ADD_MATERIAL,modelId:this.modelId,materials:s}),e}isSameMaterial(t,e){return(t.color===e.color||t.color&&e.color&&t.color.r===e.color.r&&t.color.g===e.color.g&&t.color.b===e.color.b)&&this.isSame(t.opacity,e.opacity,1)&&this.isSame(t.side,e.side,ha.Single)&&this.isSame(t.lineType,e.lineType,ia.Normal)&&t.lineWidth===e.lineWidth}isSame(t,e,s){return t===e||void 0===t&&e===s||t===s&&void 0===e}}const Vh=class t{constructor(t,e){nt(this,"localIdsToGeometryIds"),this.model=t,this.aabbController=e,this.localIdsToGeometryIds=new Map;const s=this.model.geometries(),i=s.geometriesItemsLength();for(let t=0;t<i;t++){const e=s.geometriesItems(t),i=this.model.localIds(e);null!==i&&(this.localIdsToGeometryIds.has(i)||this.localIdsToGeometryIds.set(i,[]),this.localIdsToGeometryIds.get(i).push(t))}}getItemIdsFromLocalIds(t){if(!t)return;const e=[];for(const s of t){const t=this.localIdsToGeometryIds.get(s);if(t)for(const s of t)e.push(s)}return e}getAABB(t,e){t.forEach((t=>{const s=this.aabbController.getItemInstanceIds(t);s&&s.forEach((t=>{e.union(this.aabbController.getTransformedAABB(t))}))}))}getItemsLength(){return this.model.localIdsLength()}getItemCategory(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;return this.model.categories(i)}getItemGuid(e){var s,i;const n=null==(s=this.model.localIdsArray())?void 0:s.indexOf(e);if(void 0===n||-1===n)return null;const r=null==(i=this.model.guidsItemsArray())?void 0:i.indexOf(n);if(void 0===r||-1===n)return null;const o=this.model.guids(r);return null===o?null:t.newGuid(o).guid}getLocalIdByGuid(e){let s=-1;for(let i=0;i<this.model.guidsLength();i++){const n=this.model.guids(i);if(null!==n&&t.newGuid(n).guid===e){s=i;break}}if(-1===s)return null;const i=this.model.guidsItems(s);return null===i?null:this.model.localIds(i)}getItemAttributes(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.attributes(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,i,o]=JSON.parse(e);r[s]={value:i,type:o}}return r}getItemRelations(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.relationsItemsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.relations(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,...i]=JSON.parse(e);r[s]=i}return r}getMaxLocalId(){return this.model.maxLocalId()}getAllCategories(){const t=new Set;for(let e=0;e<this.model.categoriesLength();e++){const s=this.model.categories(e);s&&t.add(s)}return[...t]}getMetadata(){const t=this.model.metadata();return t?JSON.parse(t):null}};nt(Vh,"newGuid",(t=>new va({buffer:t.bb.bytes().slice(t.bb_pos,t.bb_pos+16)})));let Eh=Vh;class Rh{constructor(t=new Float64Array(6),e=0){this.aabb=t,this.offset=e}get minX(){return this.aabb[this.offset]}get maxX(){return this.aabb[this.offset+1]}get minY(){return this.aabb[this.offset+2]}get maxY(){return this.aabb[this.offset+3]}get minZ(){return this.aabb[this.offset+4]}get maxZ(){return this.aabb[this.offset+5]}copy(t){this.aabb[this.offset]=t.minX,this.aabb[this.offset+1]=t.maxX,this.aabb[this.offset+2]=t.minY,this.aabb[this.offset+3]=t.maxY,this.aabb[this.offset+4]=t.minZ,this.aabb[this.offset+5]=t.maxZ}merge(t,e){this.aabb[this.offset]=Math.min(t.minX,e.minX),this.aabb[this.offset+1]=Math.max(t.maxX,e.maxX),this.aabb[this.offset+2]=Math.min(t.minY,e.minY),this.aabb[this.offset+3]=Math.max(t.maxY,e.maxY),this.aabb[this.offset+4]=Math.min(t.minZ,e.minZ),this.aabb[this.offset+5]=Math.max(t.maxZ,e.maxZ)}}class Dh{constructor(t,e){nt(this,"aabb"),nt(this,"dataOrSize"),this.aabb=new Rh(t,e)}isLeaf(){return this.dataOrSize>=0}getAABB(){return this.aabb}getBranchSize(){return-this.dataOrSize}getLeafData(){return this.dataOrSize}makeBranch(t,e){this.dataOrSize=-t,this.aabb.copy(e)}setSize(t){this.dataOrSize=-t}makeLeaf(t,e){this.dataOrSize=t,this.aabb.copy(e)}setData(t){this.dataOrSize=t}overlaps(t){return!(this.aabb.minX>t.maxX||this.aabb.maxX<t.minX||this.aabb.minY>t.maxY||this.aabb.maxY<t.minY||this.aabb.minZ>t.maxZ||this.aabb.maxZ<t.minZ)}}class Uh{constructor(t){if(nt(this,"nodes",[]),nt(this,"primaryLimits",[]),nt(this,"secondaryLimits",[]),nt(this,"divideX",(()=>{const t=new Jt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).x>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideY",(()=>{const t=new Jt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).y>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideZ",(()=>{const t=new Jt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).z>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"computeAveragePosition",(()=>{const t=new Jt;return(e,s,i,n)=>{let r=this.boundingBoxManager.getTransformedAABB(e[s]);r.getCenter(n);for(let o=s+1;o<i;o++)r=this.boundingBoxManager.getTransformedAABB(e[o]),n.add(r.getCenter(t));const o=i-s;return n.divideScalar(o)}})()),nt(this,"quantize",(()=>{const t=new Jt,e=new Jt;return(s,i)=>{t.subVectors(s.min,this.boundingBoxManager.modelAABB.min),e.subVectors(s.max,this.boundingBoxManager.modelAABB.min),i.aabb[i.offset]=t.x,i.aabb[i.offset+1]=e.x,i.aabb[i.offset+2]=t.y,i.aabb[i.offset+3]=e.y,i.aabb[i.offset+4]=t.z,i.aabb[i.offset+5]=e.z}})()),nt(this,"constructHierarchy",(()=>(t,e,s,i,n,r)=>{if(n-i==1){const t=this.boundingBoxManager.getTransformedAABB(s[i]);return this.quantize(t,r),this.createLeaf(e,r,s[i]),1}if(n-i==2){const t=this.nodes[e+1].getAABB();let n=this.boundingBoxManager.getTransformedAABB(s[i]);this.quantize(n,t),this.setAsDataNode(e+1,s[i]);const o=this.nodes[e+2].getAABB();return n=this.boundingBoxManager.getTransformedAABB(s[i+1]),this.quantize(n,o),this.setAsDataNode(e+2,s[i+1]),r.merge(t,o),this.createBranch(e,r,3),3}const o=this.divideOnAxis(s,i,n),a=this.constructHierarchy(t+1,e+1,s,i,o,this.primaryLimits[t]),h=this.constructHierarchy(t+1,e+a+1,s,o,n,this.secondaryLimits[t]);r.merge(this.primaryLimits[t],this.secondaryLimits[t]);const l=a+h+1;return this.createBranch(e,r,l),l})()),nt(this,"divideOnAxis",(()=>{const t=new Jt,e=new Jt,s=new Jt;return(i,n,r)=>{this.computeAveragePosition(i,n,r,s),t.set(0,0,0);for(let o=n;o<r;o++){this.boundingBoxManager.getTransformedAABB(i[o]).getCenter(e).sub(s);const n=e.multiply(e);t.add(n)}let o;o=t.x>t.y?t.x>t.z?this.divideX(i,n,r,s.x):this.divideZ(i,n,r,s.z):t.y>t.z?this.divideY(i,n,r,s.y):this.divideZ(i,n,r,s.z);const a=(r-n)/3;return(o<=n+a||o>=r-1-a)&&(o=(n+r)/2),Math.round(o)}})()),this.boundingBoxManager=t,0===t.count)return;const e=new Uint32Array(t.count);for(let t=0;t<e.length;t++)e[t]=t;const s=2*e.length-1,i=new Float64Array(6*s);for(let t=0;t<s;t++)this.nodes.push(new Dh(i,6*t));const n=new Rh;for(let t=0;t<32;t++)this.primaryLimits.push(new Rh),this.secondaryLimits.push(new Rh);this.constructHierarchy(0,0,e,0,e.length,n)}count(){return this.nodes.length}getItemsInRegion(t){const e=[],s=new Rh;this.quantize(t,s);let i=0;for(;i<this.nodes.length;){const t=this.testRegionCollision(i,s),n=this.isLeaf(i);n&&t?(e.push(this.getLeafData(i)),i++):n||t?i++:i+=this.getBranchSize(i)}return e}testBeam(t,e){const s=e&&e.length>0?t=>oo.isHitting(e,t):()=>!0;return this.test((e=>t.intersectsBox(e)),(()=>!1),s)}testFrustum(t,e,s){const i=[...t.planes];e&&i.push(...e);return this.test((t=>oo.isHitting(i,t)),(t=>oo.isIncluded(i,t)),(()=>!0),s)}test(t,e,s,i=!1){const n=[];let r=0;const o=this.nodes.length;for(;r<o;){const o=this.getBounds(r),a=this.isLeaf(r),h=e(o),l=h||t(o);if(a&&l&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r))),l||a){if(r++,h&&!a){const t=r+this.getBranchSize(r);for(;r<t;r++)this.isLeaf(r)&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r)))}}else r+=this.getBranchSize(r)}return n}exchange(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}testRegionCollision(t,e){return this.nodes[t].overlaps(e)}isLeaf(t){return this.nodes[t].isLeaf()}getBounds(t){const e=this.nodes[t].getAABB();return this.reverseQuantize(e)}createLeaf(t,e,s){this.nodes[t].makeLeaf(s,e)}setAsDataNode(t,e){this.nodes[t].setData(e)}createBranch(t,e,s){this.nodes[t].makeBranch(s,e)}getLeafData(t){return this.nodes[t].getLeafData()}getBranchSize(t){return this.nodes[t].getBranchSize()}reverseQuantize(t){const e=this.boundingBoxManager.modelAABB,s=new Jt(t.minX+e.min.x,t.minY+e.min.y,t.minZ+e.min.z),i=new Jt(t.maxX+e.min.x,t.maxY+e.min.y,t.maxZ+e.min.z);return new Kt(s,i)}}class Nh{constructor(t){nt(this,"modelAABB",new Kt),nt(this,"geometries"),nt(this,"transformedAABBs"),nt(this,"instanceDimensions"),nt(this,"box",new Kt),nt(this,"instance",new Ho),nt(this,"representation",new Zo),nt(this,"vector",new Jt),nt(this,"transform",new Ie),nt(this,"itemToInstance"),this.geometries=t.geometries(),this.transformedAABBs=new Float64Array(6*this.geometries.instancesLength()),this.instanceDimensions=new Float32Array(this.geometries.instancesLength()),this.computeAABBs(),this.evaluateInstances()}evaluateInstances(){this.itemToInstance=new Array(this.geometries.globalTransformsLength());const t=this.geometries.instancesLength(),e=new Ho,s=new Zo;for(let i=0;i<t;i++){this.geometries.instances(i,e),this.geometries.representations(e.representationId(),s);const t=e.itemId();let n=this.itemToInstance[t];n||(n=[],this.itemToInstance[t]=n),n.push(i)}}computeAABBs(){for(let t=0;t<this.geometries.instancesLength();t++){this.geometries.instances(t,this.instance),this.geometries.representations(this.instance.representationId(),this.representation),ca.getBBox(this.representation,this.box);const e=this.box.getSize(this.vector);this.instanceDimensions[t]=e.length(),this.computeTransformedAABB(t)}}getItemInstanceIds(t){return this.itemToInstance[t]}computeTransformedAABB(t){this.geometries.instances(t,this.instance),this.geometries.representations(this.instance.representationId(),this.representation),ca.get(this.instance,this.geometries,this.transform),ca.getBBox(this.representation,this.box),this.box.applyMatrix4(this.transform),this.modelAABB.union(this.box),this.setTransformedAABB(t,this.box)}setTransformedAABB(t,e){e.min.toArray(this.transformedAABBs,6*t),e.max.toArray(this.transformedAABBs,6*t+3)}getTransformedAABB(t){return this.box.min.fromArray(this.transformedAABBs,6*t),this.box.max.fromArray(this.transformedAABBs,6*t+3),this.box}size(t){return this.instanceDimensions[t]}testBeam(t,e){const s=e&&e.length>0?t=>oo.isHitting(e,t):()=>!0;return this.test((e=>t.intersectsBox(e)),s)}testFrustum(t,e,s=!1){const i=[...t.planes];e&&i.push(...e);const n=s?t=>oo.isIncluded(i,t):t=>oo.isHitting(i,t);return this.test(n,(()=>!0))}test(t,e){const s=[];for(let i=0;i<this.count;i++){const n=this.getTransformedAABB(i);t(n)&&e(n)&&s.push(i)}return s}get count(){return this.transformedAABBs.length/6}}class qh extends Nh{constructor(t){super(t),nt(this,"lookup"),this.lookup=new Uh(this)}computeTransformedAABB(t){if(this.lookup)throw new Error("Unable to recalculate bounding box when tree has already been built");super.computeTransformedAABB(t)}testBeam(t,e){return this.lookup.testBeam(t,e)}testFrustum(t,e,s=!1){return this.lookup.testFrustum(t,e,s)}}class Gh{constructor(t,e,s){nt(this,"_sectionGenerator",new Eo),nt(this,"model"),nt(this,"geometryManager"),nt(this,"materialManager"),nt(this,"boundingBoxManager"),nt(this,"pickManager"),nt(this,"itemState"),nt(this,"queryManager"),nt(this,"camera"),nt(this,"editing",!1),this.modelId=t,this.messenger=s;const i=new Li(new Uint8Array(e));this.replaceTextDecoder(i),this.model=oa.getRootAsModel(i),this.editing?this.boundingBoxManager=new Nh(this.model):this.boundingBoxManager=new qh(this.model),this.materialManager=new Oh(t,((t,e)=>s.fetch(t,e)));const n=this.model.localIdsLength();this.itemState=new Ch(n),this.itemState.initialize(),this.setupBVH()}replaceTextDecoder(t){if(void 0===t.text_decoder_)throw new Error("ByteBuffer text_decoder_ can not be replaced");t.text_decoder_=new _a}async createCaches(){const t=this.materialManager.update(this.model);this.editing?this.geometryManager=new Ph(this.modelId,this.messenger,this.model,this.boundingBoxManager,this.itemState,this.queryManager,t):this.geometryManager=new kh(this.modelId,this.messenger,this.model,this.boundingBoxManager,this.itemState,this.queryManager,t),this.queryManager=new Eh(this.model,this.boundingBoxManager),this.pickManager=new da(this.model,this.boundingBoxManager,this.geometryManager,this.itemState),await this.geometryManager.setupGeometryTemplates()}updateLoop(t){return this.geometryManager.update(t),this.geometryManager.allInstancesUpdated}pick(t,e){if(this.camera)return this.pickManager.pick(t,e,this.camera.clipPlanes)}pickSnapped(t,e,s){if(this.camera)return this.pickManager.snapPick(t,e,s,this.camera.clipPlanes)}areaPick(t,e){if(this.camera)return this.pickManager.pickArea(t,this.camera.clipPlanes,e)}getCoordinates(){const t=this.model.geometries().coordinates(),e=t.position(),s=t.xAxis(),i=t.yAxis();return[e.x(),e.y(),e.z(),s.x(),s.y(),s.z(),i.x(),i.y(),i.z()]}getSelection(){const t=[];for(let e=0;e<this.itemState.length;e++)this.itemState.isSelected(e)&&t.push(e);return t}forEachItem(t,e){if(t)for(let s=0;s<t.length;s++)e(t[s],s);else for(let t=0;t<this.itemState.length;t++)e(t,t)}setCustomMaterial(t,e){const s=this.queryManager.getItemIdsFromLocalIds(t),i=[];this.forEachItem(s,(t=>{const s=this.itemState.getCustomMaterialId(t);if(void 0!==s){const t=this.materialManager.get(s),n={...e};void 0===n.color&&void 0!==t.color&&(n.color=t.color),void 0===n.opacity&&void 0!==t.opacity&&(n.opacity=t.opacity),void 0===n.transparent&&void 0!==t.transparent&&(n.transparent=t.transparent),void 0===n.side&&void 0!==t.side&&(n.side=t.side),i.push(n)}else i.push(e)}));const n=this.materialManager.transfer(i);this.forEachItem(s,((t,e)=>{this.itemState.setCustomMaterialId(t,n[e])})),this.geometryManager.updateAllVirtualData(s)}getCustomMaterials(t){const e=[];return this.forEachItem(t,(t=>{const s=this.itemState.getCustomMaterialId(t);e.push(s?this.materialManager.get(s):void 0)})),e}getCustomMaterialItemIds(){const t=[];for(let e=0;e<this.itemState.length;e++)this.itemState.getCustomMaterialId(e)&&t.push(e);return t}setVisibility(t,e){this.forEachItem(t,(t=>this.itemState.setVisible(t,e))),this.geometryManager.updateAllVirtualData(t)}getVisibility(t){return t.map((t=>this.itemState.isVisible(t)))}getItemsLength(){return this.model.localIdsLength()}getItemGeometry(t){const e=this.boundingBoxManager.getItemInstanceIds(t),s=new Array;for(const t of e){const e=this.geometryManager.fetchGeometry(t,Si.Full);Ma(e.geometries,(t=>{s.push({transform:e.transform,indices:t.indexBuffer,positions:t.positionBuffer,normals:t.normalBuffer})}))}return s}async getSection(t){const e=new Ks(new Jt(0,0,1),1.5);this._sectionGenerator.plane=e,performance.now();const s=this.queryManager.getItemsLength(),i=new Map,n=[];for(let t=0;t<s;t++){const s=this.boundingBoxManager.getItemInstanceIds(t);if(s)for(const r of s){const s=this.boundingBoxManager.getTransformedAABB(r);if(!e.intersectsBox(s))continue;const o=this.geometryManager.geometries.geometriesItems(t);if("IFCSPACE"===this.model.categories(o))continue;const a=this.geometryManager.geometries.instances(r);if(!a)continue;const h=a.representationId();if(!i.has(h)){const t=[];Ma(this.geometryManager.fetchGeometry(r,Si.Full).geometries,(e=>{if(!e.indexBuffer||!e.positionBuffer)return;const s=new Vs;s.setIndex(Array.from(e.indexBuffer)),s.setAttribute("position",new As(e.positionBuffer,3)),t.push(s)})),i.set(h,t)}const l=i.get(h);if(l)for(const t of l){const e=new Ys(t),s=this.geometryManager.instancePlacement(r);e.applyMatrix4(s),e.updateWorldMatrix(!0,!0),n.push(e)}}}const r=new Float32Array(6e5),o=new As(r,3,!1),{index:a,indexes:h}=this._sectionGenerator.createEdges({meshes:n,posAttr:o}),l=this._sectionGenerator.createFills(r,h);for(const[,t]of i)for(const e of t)e.dispose();return t.buffer=r,t.index=a,t.fillsIndices=l,t}setCamera(t){this.camera=t,this.geometryManager.setupVirtualCamera(t)}getBoundingBox(){return this.boundingBoxManager.modelAABB}getItemsBoundingBox(t){const e=new Kt,s=this.queryManager.getItemIdsFromLocalIds(t);return this.queryManager.getAABB(s,e),e}resetCustomMaterials(t){const e=this.queryManager.getItemIdsFromLocalIds(t);if(e)for(const t of e)this.itemState.setCustomMaterialId(t,0);else this.itemState.resetMaterialIds();this.geometryManager.updateAll()}_clearSelection(){this.itemState.clearSelection(),this.geometryManager.updateAll()}resetVisibility(){this.itemState.resetVisibility(),this.geometryManager.updateAll()}resetPickPriority(){this.itemState.resetPickPriority()}getVisibleItemIds(t){return this.getItemIdsByState((e=>this.itemState.isVisible(e)===t))}getItemIdsByPickPriority(t){return this.getItemIdsByState((e=>this.itemState.getPickPriority(e)===t))}getItemIdsByState(t){const e=[];for(let s=0,i=this.model.localIdsLength();s<i;s++)t(s)&&e.push(s);return e}setItemTransform(t,e){this.geometryManager.transformItem(t,e)}getBuffer(){return this.model.bb.bytes().buffer}dispose(){this.geometryManager.dispose()}getItemCategory(t){return this.queryManager.getItemCategory(t)}getItemGuid(t){return this.queryManager.getItemGuid(t)}getLocalIdByGuid(t){return this.queryManager.getLocalIdByGuid(t)}getItemAttributes(t){return this.queryManager.getItemAttributes(t)}getItemRelations(t){return this.queryManager.getItemRelations(t)}getMaxLocalId(){return this.queryManager.getMaxLocalId()}getAllCategories(){return this.queryManager.getAllCategories()}getMetadata(){return this.queryManager.getMetadata()}setupBVH(){Vs.prototype.computeBoundsTree=io,Vs.prototype.disposeBoundsTree=no,Ys.prototype.raycast=so}}class Wh{constructor(t){nt(this,"communicationKey",0),nt(this,"handlers",new Map),nt(this,"handleInput"),nt(this,"onInput",(t=>{t.data.isResponse?this.onOutput(t.data):this.manageInput(t.data)})),this.handleInput=t}initConnection(t){t.onmessage=this.onInput}fetch(t,e){return t.messageId=this.communicationKey++,new Promise((async(s,i)=>{this.handlers.set(t.messageId,(t=>{t.error?i(t.error):s(t)}));(await this.fetchConnection(t)).postMessage(t,e)}))}onOutput(t){const e=this.handlers.get(t.messageId);this.handlers.delete(t.messageId),e(t)}async manageInput(t){try{await this.handleInput(t)}catch(e){console.error(e),t.error=e.toString()}t.isResponse=!0,(await this.fetchConnection(t)).postMessage(t)}}class Hh extends Wh{constructor(t,e){super(e),nt(this,"port"),this.port=t,this.initConnection(t)}async fetchConnection(t){return this.port}}class jh{constructor(){nt(this,"handlers",this),nt(this,"connection")}useConnection(t){this.connection=new Hh(t,(async t=>{const e=this.handlers[t.type];e?await e(t):console.warn(`Handler not found for worker message type ${t.type}`)}))}}async function Zh(t,e){for(let e=0;e<t.args.length;e++)t.args[e]&&t.args[e].elements&&(t.args[e]=$h(t.args[e])),t.args[e]&&t.args[e].origin&&t.args[e].direction&&(t.args[e]=Qh(t.args[e]));const s=e.get(t.modelId);t.result=await s[t.methodName].apply(s,t.args),t.args=void 0}function Yh(t){return(new Jt).copy(t)}function Xh(t){return t?t.map((t=>new Ks(Yh(t.normal),t.constant))):t}function Jh(t){if(!t)return;const e=Xh(t.planes);return new si(e[0],e[1],e[2],e[3],e[4],e[5])}function Qh(t){return new Ae(Yh(t.origin),Yh(t.direction))}function $h(t){return(new Ie).copy(t)}const Kh=new class extends jh{constructor(){super(),nt(this,"list",new Map),nt(this,"shared"),this.handlers[Ai.LOAD]=async t=>{const e=new Gh(t.modelId,t.buffer,this.connection);await e.createCaches(),this.list.set(t.modelId,e),t.buffer=void 0,t.boundingBox=e.getBoundingBox()},this.handlers[Ai.UNLOAD]=t=>{this.list.get(t.modelId).dispose(),this.list.delete(t.modelId)},this.handlers[Ai.PICK]=t=>{if(t.snapTypes)t.hits=this.list.get(t.modelId).pickSnapped(Qh(t.ray),Jh(t.frustum),t.snapTypes);else if(t.ray){const e=this.list.get(t.modelId).pick(Qh(t.ray),Jh(t.frustum));e&&(t.hits=[e])}else t.childrenItemIds=this.list.get(t.modelId).areaPick(Jh(t.frustum),t.frustumPickContainedOnly)},this.handlers[Ai.CAMERA_UPDATE]=t=>{t.camera.frustum=Jh(t.camera.frustum),t.camera.position=Yh(t.camera.position),t.camera.clipPlanes=Xh(t.camera.clipPlanes);const e=this.list.get(t.modelId);e&&e.setCamera(t.camera)},this.handlers[Ai.GET_BOUNDINGBOXES]=t=>{t.boundingBoxes=[];const e=this.list.get(t.modelId);if(t.itemIdGroups)for(const s of t.itemIdGroups){const i=e.getItemsBoundingBox(s);t.boundingBoxes.push(i)}else{const s=[0];for(let i=0,n=e.getItemsLength();i<n;i++){s[0]=i;const n=e.getItemsBoundingBox(s);t.boundingBoxes.push(n)}}t.itemIdGroups=void 0},this.handlers[Ai.CALL]=async t=>{await Zh(t,this.list)},this.init()}init(){const t=()=>{let e=!0;const s=performance.now();for(const t of this.list.values())if(e=e&&t.updateLoop(s),performance.now()-s>15)break;setTimeout(t,e?100:0)};t()}useShared(t){this.shared=t}};globalThis.onmessage=t=>{if(t.data instanceof MessagePort)Kh.useConnection(t.data);else{if(!crossOriginIsolated)return void console.log("SharedArrayBuffers are not enabled. This generally means worse performance. To enable them: https://stackoverflow.com/a/65675390");t.data instanceof SharedArrayBuffer&&Kh.useShared(t.data)}};export{Jh as importFrustum,$h as importMatrix,Xh as importPlanes,Qh as importRay,Yh as importVector,Zh as manageInvokeRequest};
